<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Silicon Labs EZR32 emlib Peripheral Library: release/EM_CMSIS_P1_4.1.0/emlib/src/em_gpio.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="classes.html"><span>Data&nbsp;Structures</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="dirs.html"><span>Directories</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>Globals</span></a></li>
  </ul></div>
<div class="nav">
<a class="el" href="dir_99634199317e4752b1934502e0d836c4.html">release</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_382a31a6d951115af2a1e7624d96c391.html">EM_CMSIS_P1_4.1.0</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_2bb29a122c859e975fa16e4cc28d11d7.html">emlib</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_f09ea23800c86a7e4fd7d642f3adf232.html">src</a></div>
<h1>em_gpio.c</h1><a href="em__gpio_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/***************************************************************************/</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include "<a class="code" href="em__gpio_8h.html">em_gpio.h</a>"</span>
<a name="l00036"></a>00036 
<a name="l00037"></a>00037 <span class="preprocessor">#if defined(GPIO_COUNT) &amp;&amp; (GPIO_COUNT &gt; 0)</span>
<a name="l00038"></a>00038 <span class="preprocessor"></span>
<a name="l00039"></a>00039 <span class="comment">/***************************************************************************/</span>
<a name="l00044"></a>00044 <span class="comment">/***************************************************************************/</span>
<a name="l00050"></a>00050 <span class="comment">/*******************************************************************************</span>
<a name="l00051"></a>00051 <span class="comment"> *******************************   DEFINES   ***********************************</span>
<a name="l00052"></a>00052 <span class="comment"> ******************************************************************************/</span>
<a name="l00053"></a>00053 
<a name="l00057"></a>00057 <span class="preprocessor">#define GPIO_DRIVEMODE_VALID(mode)    ((mode) &lt;= 3)</span>
<a name="l00058"></a>00058 <span class="preprocessor"></span>
<a name="l00062"></a>00062 <span class="comment">/*******************************************************************************</span>
<a name="l00063"></a>00063 <span class="comment"> **************************   GLOBAL FUNCTIONS   *******************************</span>
<a name="l00064"></a>00064 <span class="comment"> ******************************************************************************/</span>
<a name="l00065"></a>00065 
<a name="l00066"></a>00066 <span class="comment">/***************************************************************************/</span>
<a name="l00076"></a><a class="code" href="group__GPIO.html#g2e5db302df7c3695b41b582094ca6c15">00076</a> <span class="keywordtype">void</span> <a class="code" href="group__GPIO.html#g2e5db302df7c3695b41b582094ca6c15">GPIO_DbgLocationSet</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> location)
<a name="l00077"></a>00077 {
<a name="l00078"></a>00078 <span class="preprocessor">#if defined ( _GPIO_ROUTE_SWLOCATION_MASK )</span>
<a name="l00079"></a>00079 <span class="preprocessor"></span>  EFM_ASSERT(location &lt; AFCHANLOC_MAX);
<a name="l00080"></a>00080 
<a name="l00081"></a>00081   GPIO-&gt;ROUTE = (GPIO-&gt;ROUTE &amp; ~_GPIO_ROUTE_SWLOCATION_MASK) |
<a name="l00082"></a>00082                 (location &lt;&lt; _GPIO_ROUTE_SWLOCATION_SHIFT);
<a name="l00083"></a>00083 <span class="preprocessor">#else</span>
<a name="l00084"></a>00084 <span class="preprocessor"></span>  (void)location;
<a name="l00085"></a>00085 <span class="preprocessor">#endif</span>
<a name="l00086"></a>00086 <span class="preprocessor"></span>}
<a name="l00087"></a>00087 
<a name="l00088"></a>00088 <span class="preprocessor">#if defined (_GPIO_P_CTRL_DRIVEMODE_MASK)</span>
<a name="l00089"></a>00089 <span class="preprocessor"></span><span class="comment">/***************************************************************************/</span>
<a name="l00099"></a><a class="code" href="group__GPIO.html#g74243df78de8e19283d234307fd96259">00099</a> <span class="keywordtype">void</span> <a class="code" href="group__GPIO.html#g74243df78de8e19283d234307fd96259">GPIO_DriveModeSet</a>(<a class="code" href="group__GPIO.html#gfe496583dfd425fc03c413d49459efe6">GPIO_Port_TypeDef</a> port, <a class="code" href="group__GPIO.html#g0a984b2fd4eedd92d814e512555e10c5">GPIO_DriveMode_TypeDef</a> mode)
<a name="l00100"></a>00100 {
<a name="l00101"></a>00101   EFM_ASSERT(<a class="code" href="group__GPIO.html#g47b9b4ec83222ba574f639a320c81cf6">GPIO_PORT_VALID</a>(port) &amp;&amp; GPIO_DRIVEMODE_VALID(mode));
<a name="l00102"></a>00102 
<a name="l00103"></a>00103   GPIO-&gt;P[port].CTRL = (GPIO-&gt;P[port].CTRL &amp; ~(_GPIO_P_CTRL_DRIVEMODE_MASK))
<a name="l00104"></a>00104                        | (mode &lt;&lt; _GPIO_P_CTRL_DRIVEMODE_SHIFT);
<a name="l00105"></a>00105 }
<a name="l00106"></a>00106 <span class="preprocessor">#endif</span>
<a name="l00107"></a>00107 <span class="preprocessor"></span>
<a name="l00108"></a>00108 
<a name="l00109"></a>00109 <span class="preprocessor">#if defined (_GPIO_P_CTRL_DRIVESTRENGTH_MASK)</span>
<a name="l00110"></a>00110 <span class="preprocessor"></span><span class="comment">/***************************************************************************/</span>
<a name="l00120"></a>00120 <span class="keywordtype">void</span> GPIO_DriveStrengthSet(<a class="code" href="group__GPIO.html#gfe496583dfd425fc03c413d49459efe6">GPIO_Port_TypeDef</a> port,
<a name="l00121"></a>00121                            GPIO_DriveStrength_TypeDef strength)
<a name="l00122"></a>00122 {
<a name="l00123"></a>00123   EFM_ASSERT(<a class="code" href="group__GPIO.html#g47b9b4ec83222ba574f639a320c81cf6">GPIO_PORT_VALID</a>(port) &amp;&amp; GPIO_DRIVEMODE_VALID(strength));
<a name="l00124"></a>00124 
<a name="l00125"></a>00125   GPIO-&gt;P[port].CTRL = (GPIO-&gt;P[port].CTRL &amp; ~(_GPIO_P_CTRL_DRIVESTRENGTH_MASK))
<a name="l00126"></a>00126                        | (strength &lt;&lt; _GPIO_P_CTRL_DRIVESTRENGTH_SHIFT);
<a name="l00127"></a>00127 }
<a name="l00128"></a>00128 <span class="preprocessor">#endif</span>
<a name="l00129"></a>00129 <span class="preprocessor"></span>
<a name="l00130"></a>00130 <span class="comment">/***************************************************************************/</span>
<a name="l00166"></a><a class="code" href="group__GPIO.html#g42f6d22ce3a60ac994a5f663c18c0785">00166</a> <span class="keywordtype">void</span> <a class="code" href="group__GPIO.html#g42f6d22ce3a60ac994a5f663c18c0785">GPIO_IntConfig</a>(<a class="code" href="group__GPIO.html#gfe496583dfd425fc03c413d49459efe6">GPIO_Port_TypeDef</a> port,
<a name="l00167"></a>00167                     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pin,
<a name="l00168"></a>00168                     <span class="keywordtype">bool</span> risingEdge,
<a name="l00169"></a>00169                     <span class="keywordtype">bool</span> fallingEdge,
<a name="l00170"></a>00170                     <span class="keywordtype">bool</span> enable)
<a name="l00171"></a>00171 {
<a name="l00172"></a>00172   uint32_t tmp;
<a name="l00173"></a>00173 
<a name="l00174"></a>00174   EFM_ASSERT(<a class="code" href="group__GPIO.html#g585bd8a0e930f77b81f5968d1efa1c77">GPIO_PORT_PIN_VALID</a>(port, pin));
<a name="l00175"></a>00175 
<a name="l00176"></a>00176   <span class="comment">/* There are two registers controlling the interrupt configuration:</span>
<a name="l00177"></a>00177 <span class="comment">   * The EXTIPSELL register controls pins 0-7 and EXTIPSELH controls</span>
<a name="l00178"></a>00178 <span class="comment">   * pins 8-15. */</span>
<a name="l00179"></a>00179   <span class="keywordflow">if</span> (pin &lt; 8)
<a name="l00180"></a>00180   {
<a name="l00181"></a>00181     GPIO-&gt;EXTIPSELL = (GPIO-&gt;EXTIPSELL &amp; ~(0xF &lt;&lt; (4 * pin))) |
<a name="l00182"></a>00182                       (port &lt;&lt; (4 * pin));
<a name="l00183"></a>00183   }
<a name="l00184"></a>00184   <span class="keywordflow">else</span>
<a name="l00185"></a>00185   {
<a name="l00186"></a>00186     tmp             = pin - 8;
<a name="l00187"></a>00187     GPIO-&gt;EXTIPSELH = (GPIO-&gt;EXTIPSELH &amp; ~(0xF &lt;&lt; (4 * tmp))) |
<a name="l00188"></a>00188                       (port &lt;&lt; (4 * tmp));
<a name="l00189"></a>00189   }
<a name="l00190"></a>00190 
<a name="l00191"></a>00191   <span class="comment">/* Enable/disable rising edge */</span>
<a name="l00192"></a>00192   <a class="code" href="group__BUS.html#gf8574f14855448ecae32c5a9dd0c7164">BUS_RegBitWrite</a>(&amp;(GPIO-&gt;EXTIRISE), pin, risingEdge);
<a name="l00193"></a>00193 
<a name="l00194"></a>00194   <span class="comment">/* Enable/disable falling edge */</span>
<a name="l00195"></a>00195   <a class="code" href="group__BUS.html#gf8574f14855448ecae32c5a9dd0c7164">BUS_RegBitWrite</a>(&amp;(GPIO-&gt;EXTIFALL), pin, fallingEdge);
<a name="l00196"></a>00196 
<a name="l00197"></a>00197   <span class="comment">/* Clear any pending interrupt */</span>
<a name="l00198"></a>00198   GPIO-&gt;IFC = 1 &lt;&lt; pin;
<a name="l00199"></a>00199 
<a name="l00200"></a>00200   <span class="comment">/* Finally enable/disable interrupt */</span>
<a name="l00201"></a>00201   <a class="code" href="group__BUS.html#gf8574f14855448ecae32c5a9dd0c7164">BUS_RegBitWrite</a>(&amp;(GPIO-&gt;IEN), pin, enable);
<a name="l00202"></a>00202 }
<a name="l00203"></a>00203 
<a name="l00204"></a>00204 
<a name="l00205"></a>00205 <span class="comment">/***************************************************************************/</span>
<a name="l00222"></a><a class="code" href="group__GPIO.html#gb6751992334a136efe8750a1d01a850d">00222</a> <span class="keywordtype">void</span> <a class="code" href="group__GPIO.html#gb6751992334a136efe8750a1d01a850d">GPIO_PinModeSet</a>(<a class="code" href="group__GPIO.html#gfe496583dfd425fc03c413d49459efe6">GPIO_Port_TypeDef</a> port,
<a name="l00223"></a>00223                      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pin,
<a name="l00224"></a>00224                      <a class="code" href="group__GPIO.html#g93ff740308e5b31729d8593a89967cda">GPIO_Mode_TypeDef</a> mode,
<a name="l00225"></a>00225                      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> out)
<a name="l00226"></a>00226 {
<a name="l00227"></a>00227   EFM_ASSERT(<a class="code" href="group__GPIO.html#g585bd8a0e930f77b81f5968d1efa1c77">GPIO_PORT_PIN_VALID</a>(port, pin));
<a name="l00228"></a>00228 
<a name="l00229"></a>00229   <span class="comment">/* If disabling pin, do not modify DOUT in order to reduce chance for */</span>
<a name="l00230"></a>00230   <span class="comment">/* glitch/spike (may not be sufficient precaution in all use cases) */</span>
<a name="l00231"></a>00231   <span class="keywordflow">if</span> (mode != <a class="code" href="group__GPIO.html#gg93ff740308e5b31729d8593a89967cda690ce16290ecc7613e1ae11aa339330b">gpioModeDisabled</a>)
<a name="l00232"></a>00232   {
<a name="l00233"></a>00233     <span class="keywordflow">if</span> (out)
<a name="l00234"></a>00234     {
<a name="l00235"></a>00235       <a class="code" href="group__GPIO.html#gb08f054efbb07aaff57d616974c9c536">GPIO_PinOutSet</a>(port, pin);
<a name="l00236"></a>00236     }
<a name="l00237"></a>00237     <span class="keywordflow">else</span>
<a name="l00238"></a>00238     {
<a name="l00239"></a>00239       <a class="code" href="group__GPIO.html#g607f3a5f3d881bb145101566f1664aba">GPIO_PinOutClear</a>(port, pin);
<a name="l00240"></a>00240     }
<a name="l00241"></a>00241   }
<a name="l00242"></a>00242 
<a name="l00243"></a>00243   <span class="comment">/* There are two registers controlling the pins for each port. The MODEL</span>
<a name="l00244"></a>00244 <span class="comment">   * register controls pins 0-7 and MODEH controls pins 8-15. */</span>
<a name="l00245"></a>00245   <span class="keywordflow">if</span> (pin &lt; 8)
<a name="l00246"></a>00246   {
<a name="l00247"></a>00247     GPIO-&gt;P[port].MODEL = (GPIO-&gt;P[port].MODEL &amp; ~(0xF &lt;&lt; (pin * 4))) |
<a name="l00248"></a>00248                           (mode &lt;&lt; (pin * 4));
<a name="l00249"></a>00249   }
<a name="l00250"></a>00250   <span class="keywordflow">else</span>
<a name="l00251"></a>00251   {
<a name="l00252"></a>00252     GPIO-&gt;P[port].MODEH = (GPIO-&gt;P[port].MODEH &amp; ~(0xF &lt;&lt; ((pin - 8) * 4))) |
<a name="l00253"></a>00253                           (mode &lt;&lt; ((pin - 8) * 4));
<a name="l00254"></a>00254   }
<a name="l00255"></a>00255 
<a name="l00256"></a>00256   <span class="keywordflow">if</span> (mode == <a class="code" href="group__GPIO.html#gg93ff740308e5b31729d8593a89967cda690ce16290ecc7613e1ae11aa339330b">gpioModeDisabled</a>)
<a name="l00257"></a>00257   {
<a name="l00258"></a>00258     <span class="keywordflow">if</span> (out)
<a name="l00259"></a>00259     {
<a name="l00260"></a>00260       <a class="code" href="group__GPIO.html#gb08f054efbb07aaff57d616974c9c536">GPIO_PinOutSet</a>(port, pin);
<a name="l00261"></a>00261     }
<a name="l00262"></a>00262     <span class="keywordflow">else</span>
<a name="l00263"></a>00263     {
<a name="l00264"></a>00264       <a class="code" href="group__GPIO.html#g607f3a5f3d881bb145101566f1664aba">GPIO_PinOutClear</a>(port, pin);
<a name="l00265"></a>00265     }
<a name="l00266"></a>00266   }
<a name="l00267"></a>00267 }
<a name="l00268"></a>00268 
<a name="l00269"></a>00269 <span class="preprocessor">#if defined( _GPIO_EM4WUEN_MASK )</span>
<a name="l00270"></a>00270 <span class="preprocessor"></span><span class="comment">/**************************************************************************/</span>
<a name="l00286"></a><a class="code" href="group__GPIO.html#gd65109dacead0351fa390749d8682137">00286</a> <span class="keywordtype">void</span> <a class="code" href="group__GPIO.html#gd65109dacead0351fa390749d8682137">GPIO_EM4EnablePinWakeup</a>(uint32_t pinmask, uint32_t polaritymask)
<a name="l00287"></a>00287 {
<a name="l00288"></a>00288   EFM_ASSERT((pinmask &amp; ~_GPIO_EM4WUEN_MASK) == 0);
<a name="l00289"></a>00289 
<a name="l00290"></a>00290 <span class="preprocessor">#if defined( _GPIO_EM4WUPOL_MASK )</span>
<a name="l00291"></a>00291 <span class="preprocessor"></span>  EFM_ASSERT((polaritymask &amp; ~_GPIO_EM4WUPOL_MASK) == 0);
<a name="l00292"></a>00292   GPIO-&gt;EM4WUPOL &amp;= ~pinmask;               <span class="comment">/* Set wakeup polarity */</span>
<a name="l00293"></a>00293   GPIO-&gt;EM4WUPOL |= pinmask &amp; polaritymask;
<a name="l00294"></a>00294 <span class="preprocessor">#elif defined( _GPIO_EXTILEVEL_MASK )</span>
<a name="l00295"></a>00295 <span class="preprocessor"></span>  EFM_ASSERT((polaritymask &amp; ~_GPIO_EXTILEVEL_MASK) == 0);
<a name="l00296"></a>00296   GPIO-&gt;EXTILEVEL &amp;= ~pinmask;
<a name="l00297"></a>00297   GPIO-&gt;EXTILEVEL |= pinmask &amp; polaritymask;
<a name="l00298"></a>00298 <span class="preprocessor">#endif</span>
<a name="l00299"></a>00299 <span class="preprocessor"></span>  GPIO-&gt;EM4WUEN  |= pinmask;                <span class="comment">/* Enable wakeup */</span>
<a name="l00300"></a>00300 
<a name="l00301"></a>00301   <a class="code" href="group__GPIO.html#g9373299464cb309d7251c73de17d0d66">GPIO_EM4SetPinRetention</a>(<span class="keyword">true</span>);            <span class="comment">/* Enable pin retention */</span>
<a name="l00302"></a>00302 
<a name="l00303"></a>00303 <span class="preprocessor">#if defined( _GPIO_CMD_EM4WUCLR_MASK )</span>
<a name="l00304"></a>00304 <span class="preprocessor"></span>  GPIO-&gt;CMD = GPIO_CMD_EM4WUCLR;            <span class="comment">/* Clear wake-up logic */</span>
<a name="l00305"></a>00305 <span class="preprocessor">#elif defined( _GPIO_IFC_EM4WU_MASK )</span>
<a name="l00306"></a>00306 <span class="preprocessor"></span>  <a class="code" href="group__GPIO.html#g1c840f8a9d9ee23d76f3f51000f9cc5d">GPIO_IntClear</a>(pinmask);
<a name="l00307"></a>00307 <span class="preprocessor">#endif</span>
<a name="l00308"></a>00308 <span class="preprocessor"></span>}
<a name="l00309"></a>00309 <span class="preprocessor">#endif</span>
<a name="l00310"></a>00310 <span class="preprocessor"></span>
<a name="l00314"></a>00314 <span class="preprocessor">#endif </span><span class="comment">/* defined(GPIO_COUNT) &amp;&amp; (GPIO_COUNT &gt; 0) */</span>
</pre></div><div id="footer">
<hr size="1"><address style="text-align: right;"><small>
Generated on Thu Sep 10 08:15:31 2015</small> for Silicon Labs EZR32 emlib Peripheral Library by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a><small> 1.4.7 </small></address></div>
</body>
</html>
