<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Board Support Package: common/drivers/ksz8851snl.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_c5ab7d5005c5f96afef39cd6ff9e2484.html">common</a>&nbsp;&raquo;&nbsp;<a class="el" href="dir_640347b79a58de25a4e6f9b018e8e1be.html">drivers</a>
  </div>
</div>
<div class="contents">
<h1>ksz8851snl.c</h1><a href="ksz8851snl_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/**************************************************************************/</span>
<a name="l00015"></a>00015 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00016"></a>00016 
<a name="l00017"></a>00017 <span class="preprocessor">#include &quot;<a class="code" href="ksz8851snl_8h.html" title="Driver for Micrel KSZ8851SNL Ethernet controller.">ksz8851snl.h</a>&quot;</span>
<a name="l00018"></a>00018 <span class="preprocessor">#include &quot;<a class="code" href="ksz8851snl__spi_8h.html" title="SPI interface API for KSZ8851SNL Ethernet controller.">ksz8851snl_spi.h</a>&quot;</span>
<a name="l00019"></a>00019 <span class="preprocessor">#include &quot;em_assert.h&quot;</span>
<a name="l00020"></a>00020 
<a name="l00021"></a>00021 <span class="preprocessor">#include &quot;lwip/sys.h&quot;</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &quot;lwipopts.h&quot;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &quot;debug.h&quot;</span>
<a name="l00024"></a>00024 
<a name="l00025"></a>00025 <span class="preprocessor">#ifndef LWIP4EFM32</span>
<a name="l00026"></a>00026 <span class="preprocessor"></span><span class="preprocessor">#error &quot;lwiopts.h for EFM32 are not included&quot;</span>
<a name="l00027"></a>00027 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00028"></a>00028 <span class="preprocessor"></span>
<a name="l00029"></a>00029 <span class="comment">/* Register definitions */</span>
<a name="l00030"></a><a class="code" href="ksz8851snl_8c.html#aec33aabaaae5da6e6c4dca64d286a5e5">00030</a> <span class="preprocessor">#define MARL      0x10 </span>
<a name="l00031"></a><a class="code" href="ksz8851snl_8c.html#a53b0bd1eebb93c5d26d4ee73a6928140">00031</a> <span class="preprocessor">#define MARM      0x12 </span>
<a name="l00032"></a><a class="code" href="ksz8851snl_8c.html#a328ffd91c6ae67b14aad42bcf1aa8927">00032</a> <span class="preprocessor">#define MARH      0x14 </span>
<a name="l00033"></a><a class="code" href="ksz8851snl_8c.html#a935d63bec1945201ecb17b7e3bd7ebb7">00033</a> <span class="preprocessor">#define OBCR      0x20 </span>
<a name="l00034"></a><a class="code" href="ksz8851snl_8c.html#a092b1852ba2fbba0bcdd216f3f641b49">00034</a> <span class="preprocessor">#define GRR       0x26 </span>
<a name="l00035"></a><a class="code" href="ksz8851snl_8c.html#a926b6d1474c9258a92607b9b4272549e">00035</a> <span class="preprocessor">#define TXCR      0x70 </span>
<a name="l00036"></a><a class="code" href="ksz8851snl_8c.html#a3f311ff23775b0dd05baeafa58bbaa22">00036</a> <span class="preprocessor">#define RXCR1     0x74 </span>
<a name="l00037"></a><a class="code" href="ksz8851snl_8c.html#a610096e926ba4386c101f42eb51f83ed">00037</a> <span class="preprocessor">#define RXCR2     0x76 </span>
<a name="l00038"></a><a class="code" href="ksz8851snl_8c.html#afce935acdb1eb7756aeb45bddb6ffbcd">00038</a> <span class="preprocessor">#define TXMIR     0x78 </span>
<a name="l00039"></a><a class="code" href="ksz8851snl_8c.html#a30e9e4c89c87aa77f0168cec82474b8c">00039</a> <span class="preprocessor">#define RXFHSR    0x7C </span>
<a name="l00040"></a><a class="code" href="ksz8851snl_8c.html#a0b47780f1c7a35ea8af1f91738af073f">00040</a> <span class="preprocessor">#define RXFHBCR   0x7E </span>
<a name="l00041"></a><a class="code" href="ksz8851snl_8c.html#a272d3d63d93ee08337f48780bf95f9db">00041</a> <span class="preprocessor">#define TXQCR     0x80 </span>
<a name="l00042"></a><a class="code" href="ksz8851snl_8c.html#af5c7dd624af5db2a9d1e5ff08d17d7a1">00042</a> <span class="preprocessor">#define RXQCR     0x82 </span>
<a name="l00043"></a><a class="code" href="ksz8851snl_8c.html#a62ea34f447f8a5b2f10e3cd18e2e33c9">00043</a> <span class="preprocessor">#define TXFDPR    0x84 </span>
<a name="l00044"></a><a class="code" href="ksz8851snl_8c.html#a30336f6509570d09b6a6ef1309499c99">00044</a> <span class="preprocessor">#define RXFDPR    0x86 </span>
<a name="l00045"></a><a class="code" href="ksz8851snl_8c.html#a3e27fa35f9febccdc4a0c28a5c8cffbb">00045</a> <span class="preprocessor">#define IER       0x90 </span>
<a name="l00046"></a><a class="code" href="ksz8851snl_8c.html#a421ef10418d62e6b65390cb8cdab5c15">00046</a> <span class="preprocessor">#define ISR       0x92 </span>
<a name="l00047"></a><a class="code" href="ksz8851snl_8c.html#a3f38906b3f69e1ae69ab71fa624863c0">00047</a> <span class="preprocessor">#define RXFCTR    0x9C </span>
<a name="l00048"></a><a class="code" href="ksz8851snl_8c.html#a489ade49aadfa6fd965c1ce4e9567faa">00048</a> <span class="preprocessor">#define TXNTFSR   0x9E </span>
<a name="l00049"></a><a class="code" href="ksz8851snl_8c.html#ab514abc673ae547a70d89508dba74072">00049</a> <span class="preprocessor">#define FCLWR     0xB0 </span>
<a name="l00050"></a><a class="code" href="ksz8851snl_8c.html#a5e05d20aac1389dcb9efba750c7e1fc7">00050</a> <span class="preprocessor">#define FCHWR     0xB2 </span>
<a name="l00051"></a><a class="code" href="ksz8851snl_8c.html#a586a7f4e18d53f3c99321c82a7c8cbcf">00051</a> <span class="preprocessor">#define CIDER     0xC0 </span>
<a name="l00052"></a><a class="code" href="ksz8851snl_8c.html#ac5dddfc0f267c4206fae0c5823a71b5d">00052</a> <span class="preprocessor">#define IACR      0xC8 </span>
<a name="l00053"></a><a class="code" href="ksz8851snl_8c.html#ac70fd534e36f2de45f17f090752a30f0">00053</a> <span class="preprocessor">#define IADLR     0xD0 </span>
<a name="l00054"></a><a class="code" href="ksz8851snl_8c.html#a7d059c3a3c5ce05c5513413d6e9cebf1">00054</a> <span class="preprocessor">#define IADHR     0xD2 </span>
<a name="l00055"></a><a class="code" href="ksz8851snl_8c.html#adeb3a4d09a3fed3e809b1c96c21b4241">00055</a> <span class="preprocessor">#define PMECR     0xD4 </span>
<a name="l00056"></a><a class="code" href="ksz8851snl_8c.html#a899443e7d74043411fea3eee7d9de9f6">00056</a> <span class="preprocessor">#define PHYRR     0xD8 </span>
<a name="l00057"></a><a class="code" href="ksz8851snl_8c.html#aaf7daae0d88c4a4c4e0ba68e83e8e968">00057</a> <span class="preprocessor">#define P1MBCR    0xE4 </span>
<a name="l00058"></a><a class="code" href="ksz8851snl_8c.html#af7ebf99ea562bcdb5735519d2db88e32">00058</a> <span class="preprocessor">#define P1CR      0xF6 </span>
<a name="l00059"></a><a class="code" href="ksz8851snl_8c.html#ab84f41b2f2b735bec6b04abab49be0dd">00059</a> <span class="preprocessor">#define P1SR      0xF8 </span>
<a name="l00061"></a><a class="code" href="ksz8851snl_8c.html#a67a9f9d1d59c17889c587973b758890c">00061</a> <span class="preprocessor">#define KSZ8851SNL_CHIP_ID           0x8870 </span>
<a name="l00062"></a><a class="code" href="ksz8851snl_8c.html#a71ef81afb42a9b3dc69b8efb67ba08cc">00062</a> <span class="preprocessor">#define CHIP_ID_MASK                 0xFFF0 </span>
<a name="l00063"></a><a class="code" href="ksz8851snl_8c.html#a0189fe248f84298f9ccffd38692604fb">00063</a> <span class="preprocessor">#define ONE_FRAME_THRES              0x0001 </span>
<a name="l00064"></a><a class="code" href="ksz8851snl_8c.html#a56cdd36751f5a5ba51247720848a46ae">00064</a> <span class="preprocessor">#define FD_PTR_AUTO_INC              0x4000 </span>
<a name="l00065"></a><a class="code" href="ksz8851snl_8c.html#ac83b32831e0638f88b91366948124c04">00065</a> <span class="preprocessor">#define CLEAR_INT                    0xFFFF </span>
<a name="l00066"></a><a class="code" href="ksz8851snl_8c.html#a359afd6937727dbe8deee27136244dde">00066</a> <span class="preprocessor">#define NO_INT                       0x0000 </span>
<a name="l00067"></a><a class="code" href="ksz8851snl_8c.html#ad53a856610ae8f92071467aa1d9f0215">00067</a> <span class="preprocessor">#define TX_MEM_AVAIL_MASK            0x1FFF </span>
<a name="l00068"></a><a class="code" href="ksz8851snl_8c.html#a8908b96fed6ae4dd395a7a1b4126606d">00068</a> <span class="preprocessor">#define FRAME_ID_MASK                0x003F </span>
<a name="l00069"></a><a class="code" href="ksz8851snl_8c.html#a028895fdab77c4dd8aca7a34aaaf38e9">00069</a> <span class="preprocessor">#define CHECKSUM_VALID_FRAME_MASK    0x3C17 </span>
<a name="l00073"></a><a class="code" href="ksz8851snl_8c.html#aeaa8fab8c4bb775b6dd1fc7532911f25">00073</a> <span class="preprocessor">#define VALID_FRAME_MASK             0x8000 </span>
<a name="l00076"></a><a class="code" href="ksz8851snl_8c.html#a60cd22a6881b225ea028f8bc1a0e0783">00076</a> <span class="preprocessor">#define RX_BYTE_CNT_MASK             0x0FFF </span>
<a name="l00077"></a><a class="code" href="ksz8851snl_8c.html#a338d54179ac0da2af2363e3a930bf374">00077</a> <span class="preprocessor">#define LSB_MASK                     0x00FF </span>
<a name="l00078"></a><a class="code" href="ksz8851snl_8c.html#aebafa824e034291924298c85bc366e0e">00078</a> <span class="preprocessor">#define MSB_POS                      0x0008 </span>
<a name="l00079"></a><a class="code" href="ksz8851snl_8c.html#aedbede564fb262aa18cf51017de948ae">00079</a> <span class="preprocessor">#define TX_INT_on_COMPLETION         0x8000 </span>
<a name="l00080"></a><a class="code" href="ksz8851snl_8c.html#a92ed8507d1cd2331ad09275c5c4c1c89">00080</a> <span class="preprocessor">#define WORD_SIZE                    0x0004 </span>
<a name="l00081"></a><a class="code" href="ksz8851snl_8c.html#a14310221be58e5b64cc335aaecc80afd">00081</a> <span class="preprocessor">#define EXTRA_SIZE                   0x0008 </span>
<a name="l00082"></a><a class="code" href="ksz8851snl_8c.html#a1710d5f7a9e23b5411cf190c45d0b09c">00082</a> <span class="preprocessor">#define BLOCKING_RECEIVE             0      </span>
<a name="l00083"></a><a class="code" href="ksz8851snl_8c.html#ace67331af9e371dffde22d1b5fabf5f1">00083</a> <span class="preprocessor">#define WATERMARK_6KB                0x0600 </span>
<a name="l00084"></a><a class="code" href="ksz8851snl_8c.html#ae78ae160bdcc753d7ecd0c42c8d0c49b">00084</a> <span class="preprocessor">#define WATERMARK_4KB                0x0400 </span>
<a name="l00085"></a>00085 <span class="preprocessor"></span><span class="comment">/* Silicon Laboratories MAC address space */</span>
<a name="l00086"></a><a class="code" href="ksz8851snl_8c.html#ae3b1a19388873dd5c03e63feecff9c14">00086</a> <span class="preprocessor">#define HIGH_QMU_MAC_H               0x00   </span>
<a name="l00087"></a><a class="code" href="ksz8851snl_8c.html#a8aa3036cea0079ddc98c874ffbd24125">00087</a> <span class="preprocessor">#define HIGH_QMU_MAC_L               0x0B   </span>
<a name="l00088"></a><a class="code" href="ksz8851snl_8c.html#aa5a2ce4eeabfe5f74d047bcfece64724">00088</a> <span class="preprocessor">#define MID_QMU_MAC_H                0x57   </span>
<a name="l00089"></a><a class="code" href="ksz8851snl_8c.html#a25c8363b88d9b8f73cc6b1a98bba8d9c">00089</a> <span class="preprocessor">#define BYTE_MASK                    0x00FF </span>
<a name="l00090"></a><a class="code" href="ksz8851snl_8c.html#a86fd4404b140711fdb77326609c0f393">00090</a> <span class="preprocessor">#define BYTE_SIZE                    0x0008 </span>
<a name="l00092"></a>00092 <span class="preprocessor"></span><span class="comment">/* TX Flow Control Register Options */</span>
<a name="l00093"></a>00093 
<a name="l00095"></a><a class="code" href="ksz8851snl_8c.html#ab9b7bbaffe044312387e6412b97d66ea">00095</a> <span class="preprocessor">#define   TX_FLOW_CTRL_ICMP_CHECKSUM    0x0100</span>
<a name="l00096"></a>00096 <span class="preprocessor"></span>
<a name="l00097"></a><a class="code" href="ksz8851snl_8c.html#af0895070ec906a914b2dd62d1d8a5f5d">00097</a> <span class="preprocessor">#define   TX_FLOW_CTRL_TCP_CHECKSUM     0x0040</span>
<a name="l00098"></a>00098 <span class="preprocessor"></span>
<a name="l00099"></a><a class="code" href="ksz8851snl_8c.html#ae725224e700a804f0e0d72e58b4c2512">00099</a> <span class="preprocessor">#define   TX_FLOW_CTRL_IP_CHECKSUM      0x0020</span>
<a name="l00100"></a>00100 <span class="preprocessor"></span>
<a name="l00101"></a><a class="code" href="ksz8851snl_8c.html#a834364c5d577e607cd80192eb19610ac">00101</a> <span class="preprocessor">#define   TX_FLOW_CTRL_FLUSH_QUEUE      0x0010</span>
<a name="l00102"></a>00102 <span class="preprocessor"></span>
<a name="l00103"></a><a class="code" href="ksz8851snl_8c.html#a3aa120933c1ea819698210a87414a99a">00103</a> <span class="preprocessor">#define   TX_FLOW_CTRL_FLOW_ENABLE      0x0008</span>
<a name="l00104"></a>00104 <span class="preprocessor"></span>
<a name="l00105"></a><a class="code" href="ksz8851snl_8c.html#a36976098f270d11d48f9b766fd2cd054">00105</a> <span class="preprocessor">#define   TX_FLOW_CTRL_PAD_ENABLE       0x0004</span>
<a name="l00106"></a>00106 <span class="preprocessor"></span>
<a name="l00107"></a><a class="code" href="ksz8851snl_8c.html#aa37cabe23ff4bca018afc1f512bb6b60">00107</a> <span class="preprocessor">#define   TX_FLOW_CTRL_CRC_ENABLE       0x0002</span>
<a name="l00108"></a>00108 <span class="preprocessor"></span>
<a name="l00109"></a><a class="code" href="ksz8851snl_8c.html#a4fb198f5122ad90b21a55144fd193adc">00109</a> <span class="preprocessor">#define   TX_FLOW_CTRL_ENABLE           0x0001</span>
<a name="l00110"></a>00110 <span class="preprocessor"></span>
<a name="l00112"></a><a class="code" href="ksz8851snl_8c.html#ac95b594e03b020184d53ee1285ff2d0d">00112</a> <span class="preprocessor">#define   TX_FLOW_CTRL_CONFIG           (TX_FLOW_CTRL_ICMP_CHECKSUM | \</span>
<a name="l00113"></a>00113 <span class="preprocessor">                                         TX_FLOW_CTRL_TCP_CHECKSUM |  \</span>
<a name="l00114"></a>00114 <span class="preprocessor">                                         TX_FLOW_CTRL_IP_CHECKSUM |   \</span>
<a name="l00115"></a>00115 <span class="preprocessor">                                         TX_FLOW_CTRL_FLOW_ENABLE |   \</span>
<a name="l00116"></a>00116 <span class="preprocessor">                                         TX_FLOW_CTRL_PAD_ENABLE |    \</span>
<a name="l00117"></a>00117 <span class="preprocessor">                                         TX_FLOW_CTRL_CRC_ENABLE)</span>
<a name="l00118"></a>00118 <span class="preprocessor"></span>
<a name="l00119"></a>00119 <span class="comment">/* TXQ Command Register Options */</span>
<a name="l00121"></a><a class="code" href="ksz8851snl_8c.html#aa38df68f68191f53d80ba7630615fae3">00121</a> <span class="preprocessor">#define   TXQ_AUTO_ENQUEUE         0x0004</span>
<a name="l00122"></a>00122 <span class="preprocessor"></span>
<a name="l00123"></a><a class="code" href="ksz8851snl_8c.html#aef4013e1ace29d2d23b001d710b03b7a">00123</a> <span class="preprocessor">#define   TXQ_MEM_AVAILABLE_INT    0x0002</span>
<a name="l00124"></a>00124 <span class="preprocessor"></span>
<a name="l00125"></a><a class="code" href="ksz8851snl_8c.html#a56ad1b68495eb52699727a5e1fd29da5">00125</a> <span class="preprocessor">#define   TXQ_ENQUEUE              0x0001</span>
<a name="l00126"></a>00126 <span class="preprocessor"></span>
<a name="l00127"></a>00127 
<a name="l00128"></a>00128 <span class="comment">/* RX Flow Control Register 1 Options */</span>
<a name="l00130"></a><a class="code" href="ksz8851snl_8c.html#ab4afc07a6c37d2cd2713f5f4098579e6">00130</a> <span class="preprocessor">#define   RX_FLOW_CTRL_FLUSH_QUEUE       0x8000</span>
<a name="l00131"></a>00131 <span class="preprocessor"></span>
<a name="l00132"></a><a class="code" href="ksz8851snl_8c.html#a58eaa6b58461f86a0d145986a964e670">00132</a> <span class="preprocessor">#define   RX_FLOW_CTRL_UDP_CHECKSUM      0x4000</span>
<a name="l00133"></a>00133 <span class="preprocessor"></span>
<a name="l00134"></a><a class="code" href="ksz8851snl_8c.html#ae3a27fa68dc749c1619ea20ee36bf0d0">00134</a> <span class="preprocessor">#define   RX_FLOW_CTRL_TCP_CHECKSUM      0x2000</span>
<a name="l00135"></a>00135 <span class="preprocessor"></span>
<a name="l00136"></a><a class="code" href="ksz8851snl_8c.html#a6463e76a0b2ffb1f6f301cfa69c7295d">00136</a> <span class="preprocessor">#define   RX_FLOW_CTRL_IP_CHECKSUM       0x1000</span>
<a name="l00137"></a>00137 <span class="preprocessor"></span>
<a name="l00138"></a><a class="code" href="ksz8851snl_8c.html#a2e058910eb74fff1bc1ebaf2ed0b2208">00138</a> <span class="preprocessor">#define   RX_FLOW_CTRL_MAC_FILTER        0x0800</span>
<a name="l00139"></a>00139 <span class="preprocessor"></span>
<a name="l00140"></a><a class="code" href="ksz8851snl_8c.html#a8d2454f878c10eeb5e5d31e489a70a58">00140</a> <span class="preprocessor">#define   RX_FLOW_CTRL_FLOW_ENENABLE     0x0400</span>
<a name="l00141"></a>00141 <span class="preprocessor"></span>
<a name="l00142"></a><a class="code" href="ksz8851snl_8c.html#a549874423431e423943346fbef8b023f">00142</a> <span class="preprocessor">#define   RX_FLOW_CTRL_BAD_PACKET        0x0200</span>
<a name="l00143"></a>00143 <span class="preprocessor"></span>
<a name="l00144"></a><a class="code" href="ksz8851snl_8c.html#aa81e93dd9bc8cdc110e5997fdeaba733">00144</a> <span class="preprocessor">#define   RX_FLOW_CTRL_BROADCAST_ENABLE  0x0080</span>
<a name="l00145"></a>00145 <span class="preprocessor"></span>
<a name="l00146"></a><a class="code" href="ksz8851snl_8c.html#a4da16dd870a9549fc2fbddc63ecd3d2b">00146</a> <span class="preprocessor">#define   RX_FLOW_CTRL_MULTICAST_ENABLE  0x0040</span>
<a name="l00147"></a>00147 <span class="preprocessor"></span>
<a name="l00148"></a><a class="code" href="ksz8851snl_8c.html#ab740df479faf6c9461a54e6a36602a3e">00148</a> <span class="preprocessor">#define   RX_FLOW_CTRL_UNICAST_ENABLE    0x0020</span>
<a name="l00149"></a>00149 <span class="preprocessor"></span>
<a name="l00150"></a><a class="code" href="ksz8851snl_8c.html#ad2832794066d462981b8bbe4e423ad64">00150</a> <span class="preprocessor">#define   RX_FLOW_CTRL_PROMISCUOUS_MODE  0x0012</span>
<a name="l00151"></a>00151 <span class="preprocessor"></span>
<a name="l00152"></a><a class="code" href="ksz8851snl_8c.html#a49fea830bb207556949febe45a222f28">00152</a> <span class="preprocessor">#define   RX_FLOW_CTRL_RX_ALL            0x0010</span>
<a name="l00153"></a>00153 <span class="preprocessor"></span>
<a name="l00154"></a><a class="code" href="ksz8851snl_8c.html#a5e0ae61fde6db228bb18ac0c06ce0df0">00154</a> <span class="preprocessor">#define   RX_FLOW_CTRL_INVERSE_FILTER    0x0002</span>
<a name="l00155"></a>00155 <span class="preprocessor"></span>
<a name="l00156"></a><a class="code" href="ksz8851snl_8c.html#a35f925972a31fa513b3d50ede32091b5">00156</a> <span class="preprocessor">#define   RX_FLOW_CTRL_RX_ENABLE         0x0001</span>
<a name="l00157"></a>00157 <span class="preprocessor"></span>
<a name="l00159"></a><a class="code" href="ksz8851snl_8c.html#ad43736a9aeccb0eb58620770717fd71d">00159</a> <span class="preprocessor">#define   RX_FLOW_CTRL1_CONFIG           (RX_FLOW_CTRL_UDP_CHECKSUM     |  \</span>
<a name="l00160"></a>00160 <span class="preprocessor">                                          RX_FLOW_CTRL_TCP_CHECKSUM     |  \</span>
<a name="l00161"></a>00161 <span class="preprocessor">                                          RX_FLOW_CTRL_IP_CHECKSUM      |  \</span>
<a name="l00162"></a>00162 <span class="preprocessor">                                          RX_FLOW_CTRL_MAC_FILTER       |  \</span>
<a name="l00163"></a>00163 <span class="preprocessor">                                          RX_FLOW_CTRL_FLOW_ENENABLE    |  \</span>
<a name="l00164"></a>00164 <span class="preprocessor">                                          RX_FLOW_CTRL_BROADCAST_ENABLE |  \</span>
<a name="l00165"></a>00165 <span class="preprocessor">                                          RX_FLOW_CTRL_UNICAST_ENABLE)</span>
<a name="l00166"></a>00166 <span class="preprocessor"></span>
<a name="l00167"></a>00167 <span class="comment">/* RX Flow Control Register 2 Options */</span>
<a name="l00168"></a>00168 <span class="comment">/* SPI Receive Data Burst Length */</span>
<a name="l00170"></a><a class="code" href="ksz8851snl_8c.html#a338220101ebd2ea809c925769d9dd03a">00170</a> <span class="preprocessor">#define   RX_FLOW_CTRL_BURST_LEN_MASK        0x00E0</span>
<a name="l00171"></a>00171 <span class="preprocessor"></span>
<a name="l00172"></a><a class="code" href="ksz8851snl_8c.html#abb993cc004c5f464b2ae9d56c29e7f1d">00172</a> <span class="preprocessor">#define   RX_FLOW_CTRL_BURST_LEN_4           0x0000</span>
<a name="l00173"></a>00173 <span class="preprocessor"></span>
<a name="l00174"></a><a class="code" href="ksz8851snl_8c.html#a56ab4e3fe50df7a5abc6c1691b03e805">00174</a> <span class="preprocessor">#define   RX_FLOW_CTRL_BURST_LEN_8           0x0020</span>
<a name="l00175"></a>00175 <span class="preprocessor"></span>
<a name="l00176"></a><a class="code" href="ksz8851snl_8c.html#ac39468629d9c788e770fafc3b9c12b3d">00176</a> <span class="preprocessor">#define   RX_FLOW_CTRL_BURST_LEN_16          0x0040</span>
<a name="l00177"></a>00177 <span class="preprocessor"></span>
<a name="l00178"></a><a class="code" href="ksz8851snl_8c.html#a3b0e66466f6be2707e9215660d2b428d">00178</a> <span class="preprocessor">#define   RX_FLOW_CTRL_BURST_LEN_32          0x0060</span>
<a name="l00179"></a>00179 <span class="preprocessor"></span>
<a name="l00180"></a><a class="code" href="ksz8851snl_8c.html#add2a6921950830c5d96a555ce38a663b">00180</a> <span class="preprocessor">#define   RX_FLOW_CTRL_BURST_LEN_FRAME       0x0080</span>
<a name="l00181"></a>00181 <span class="preprocessor"></span>
<a name="l00182"></a><a class="code" href="ksz8851snl_8c.html#a8a6fb99f0b326888961f7e16ed9d2a3c">00182</a> <span class="preprocessor">#define   RX_FLOW_CTRL_IPV6_UDP_FRAG_PASS    0x0010</span>
<a name="l00183"></a>00183 <span class="preprocessor"></span>
<a name="l00184"></a><a class="code" href="ksz8851snl_8c.html#ad84a2cb6841bd4551b9f7296f2f604a0">00184</a> <span class="preprocessor">#define   RX_FLOW_CTRL_IPV6_UDP_ZERO_PASS    0x0008</span>
<a name="l00185"></a>00185 <span class="preprocessor"></span>
<a name="l00186"></a><a class="code" href="ksz8851snl_8c.html#afd6f73b88e92eeae3dd7c17278453777">00186</a> <span class="preprocessor">#define   RX_FLOW_CTRL_UDP_LITE_CHECKSUM     0x0004</span>
<a name="l00187"></a>00187 <span class="preprocessor"></span>
<a name="l00188"></a><a class="code" href="ksz8851snl_8c.html#a8e3ff178f51c43329860565866179705">00188</a> <span class="preprocessor">#define   RX_FLOW_CTRL_ICMP_CHECKSUM         0x0002</span>
<a name="l00189"></a>00189 <span class="preprocessor"></span>
<a name="l00190"></a><a class="code" href="ksz8851snl_8c.html#a1948e53f9c3dd873447b4f4c69a829da">00190</a> <span class="preprocessor">#define   RX_FLOW_CTRL_BLOCK_MAC             0x0001</span>
<a name="l00191"></a>00191 <span class="preprocessor"></span>
<a name="l00193"></a><a class="code" href="ksz8851snl_8c.html#a0bde5dcaa753e8253fb4fd81acd640ec">00193</a> <span class="preprocessor">#define   RX_FLOW_CTRL2_CONFIG               (RX_FLOW_CTRL_IPV6_UDP_FRAG_PASS | \</span>
<a name="l00194"></a>00194 <span class="preprocessor">                                              RX_FLOW_CTRL_UDP_LITE_CHECKSUM |  \</span>
<a name="l00195"></a>00195 <span class="preprocessor">                                              RX_FLOW_CTRL_ICMP_CHECKSUM |      \</span>
<a name="l00196"></a>00196 <span class="preprocessor">                                              RX_FLOW_CTRL_BURST_LEN_FRAME)</span>
<a name="l00197"></a>00197 <span class="preprocessor"></span>
<a name="l00198"></a>00198 <span class="comment">/* RXQ Command Register Options */</span>
<a name="l00200"></a><a class="code" href="ksz8851snl_8c.html#a9aeaca8e4e55bbe1f6e5f81e4419546c">00200</a> <span class="preprocessor">#define   RXQ_ON_TIME_INT            0x1000</span>
<a name="l00201"></a>00201 <span class="preprocessor"></span>
<a name="l00202"></a><a class="code" href="ksz8851snl_8c.html#a14ea527b771dd132db1b24569b6311bf">00202</a> <span class="preprocessor">#define   RXQ_ON_BYTE_CNT_INT        0x0800</span>
<a name="l00203"></a>00203 <span class="preprocessor"></span>
<a name="l00204"></a><a class="code" href="ksz8851snl_8c.html#a18b8748c9e736810098c7cd324442529">00204</a> <span class="preprocessor">#define   RXQ_ON_FRAME_CNT_INT       0x0400</span>
<a name="l00205"></a>00205 <span class="preprocessor"></span>
<a name="l00206"></a><a class="code" href="ksz8851snl_8c.html#a36f4bd7edab37cd0edd8595edf18c195">00206</a> <span class="preprocessor">#define   RXQ_TWOBYTE_OFFSET         0x0200</span>
<a name="l00207"></a>00207 <span class="preprocessor"></span>
<a name="l00208"></a><a class="code" href="ksz8851snl_8c.html#ab63999f4b129910cc4d017af45d3e272">00208</a> <span class="preprocessor">#define   RXQ_EN_ON_TIME_INT         0x0080</span>
<a name="l00209"></a>00209 <span class="preprocessor"></span>
<a name="l00210"></a><a class="code" href="ksz8851snl_8c.html#abcb96a3da99f3b7664d09b12ee5ae1d3">00210</a> <span class="preprocessor">#define   RXQ_EN_ON_BYTE_CNT_INT     0x0040</span>
<a name="l00211"></a>00211 <span class="preprocessor"></span>
<a name="l00212"></a><a class="code" href="ksz8851snl_8c.html#ac3847df02492bc527c393b1eb8f58d02">00212</a> <span class="preprocessor">#define   RXQ_EN_ON_FRAME_CNT_INT    0x0020</span>
<a name="l00213"></a>00213 <span class="preprocessor"></span>
<a name="l00214"></a><a class="code" href="ksz8851snl_8c.html#ae084712e3030163840005b1296a0da79">00214</a> <span class="preprocessor">#define   RXQ_AUTO_DEQUEUE           0x0010</span>
<a name="l00215"></a>00215 <span class="preprocessor"></span>
<a name="l00216"></a><a class="code" href="ksz8851snl_8c.html#a22c8cae8de31b0afd6b5eb78080c4d4f">00216</a> <span class="preprocessor">#define   RXQ_START_DMA              0x0008</span>
<a name="l00217"></a>00217 <span class="preprocessor"></span>
<a name="l00218"></a><a class="code" href="ksz8851snl_8c.html#adf331f33bb045dc73bbdd2aca446d3b1">00218</a> <span class="preprocessor">#define   RXQ_RELEASE_ERROR_FRAME    0x0001</span>
<a name="l00219"></a>00219 <span class="preprocessor"></span>
<a name="l00221"></a><a class="code" href="ksz8851snl_8c.html#a2b2622989bd3fa193103abae8004d3b3">00221</a> <span class="preprocessor">#define   RXQ_CMD_CONFIG             (RXQ_EN_ON_FRAME_CNT_INT | \</span>
<a name="l00222"></a>00222 <span class="preprocessor">                                      RXQ_AUTO_DEQUEUE)</span>
<a name="l00223"></a>00223 <span class="preprocessor"></span>
<a name="l00224"></a>00224 <span class="comment">/* Port 1 Status Register */</span>
<a name="l00226"></a><a class="code" href="ksz8851snl_8c.html#a87fa607805ba7061f1d6a4cf6764f116">00226</a> <span class="preprocessor">#define PORT1_AN_DONE                 0x0040</span>
<a name="l00227"></a>00227 <span class="preprocessor"></span>
<a name="l00228"></a><a class="code" href="ksz8851snl_8c.html#a8aa99936d570f6e85ff73a9ffe372815">00228</a> <span class="preprocessor">#define PORT1_LINK_GOOD               0x0020</span>
<a name="l00229"></a>00229 <span class="preprocessor"></span>
<a name="l00230"></a>00230 <span class="comment">/* Port 1 Control Register Options */</span>
<a name="l00232"></a><a class="code" href="ksz8851snl_8c.html#a575284288b451b99168a28eace28f027">00232</a> <span class="preprocessor">#define   PORT1_LED_OFF               0x8000</span>
<a name="l00233"></a>00233 <span class="preprocessor"></span>
<a name="l00234"></a><a class="code" href="ksz8851snl_8c.html#a158a44e04fcb947359a5ffb566e95d40">00234</a> <span class="preprocessor">#define   PORT1_TX_DISABLE            0x4000</span>
<a name="l00235"></a>00235 <span class="preprocessor"></span>
<a name="l00236"></a><a class="code" href="ksz8851snl_8c.html#afefbc2ee026e2c62da2f3540a11d943d">00236</a> <span class="preprocessor">#define   PORT1_AUTO_NEG_RESTART      0x2000</span>
<a name="l00237"></a>00237 <span class="preprocessor"></span>
<a name="l00238"></a><a class="code" href="ksz8851snl_8c.html#a9b79326b86c4ac564fdde7c91a04112a">00238</a> <span class="preprocessor">#define   PORT1_POWER_DOWN            0x0800</span>
<a name="l00239"></a>00239 <span class="preprocessor"></span>
<a name="l00240"></a><a class="code" href="ksz8851snl_8c.html#a05ce5d40b4a0db4562ea465c6b4dfd6b">00240</a> <span class="preprocessor">#define   PORT1_AUTO_MDIX_DISABLE     0x0400</span>
<a name="l00241"></a>00241 <span class="preprocessor"></span>
<a name="l00242"></a><a class="code" href="ksz8851snl_8c.html#a502b2e6289fafe5337a3df230057048b">00242</a> <span class="preprocessor">#define   PORT1_FORCE_MDIX            0x0200</span>
<a name="l00243"></a>00243 <span class="preprocessor"></span>
<a name="l00244"></a><a class="code" href="ksz8851snl_8c.html#a5906b0d3882ecaf8d9b81e79febe70e0">00244</a> <span class="preprocessor">#define   PORT1_AUTO_NEG_ENABLE       0x0080</span>
<a name="l00245"></a>00245 <span class="preprocessor"></span>
<a name="l00246"></a><a class="code" href="ksz8851snl_8c.html#adc183dd080761f6925e468848de009a9">00246</a> <span class="preprocessor">#define   PORT1_FORCE_100_MBIT        0x0040</span>
<a name="l00247"></a>00247 <span class="preprocessor"></span>
<a name="l00248"></a><a class="code" href="ksz8851snl_8c.html#aa76726ee8bc368c225c7052ac8d215c1">00248</a> <span class="preprocessor">#define   PORT1_FORCE_FULL_DUPLEX     0x0020</span>
<a name="l00249"></a>00249 <span class="preprocessor"></span>
<a name="l00250"></a><a class="code" href="ksz8851snl_8c.html#af2bf94a6acb8f18cc2523fb856c531bb">00250</a> <span class="preprocessor">#define   PORT1_AUTO_NEG_FLOW_CTRL    0x0010</span>
<a name="l00251"></a>00251 <span class="preprocessor"></span>
<a name="l00252"></a><a class="code" href="ksz8851snl_8c.html#a7c0657a7c4d68b93458ceb285c7adca1">00252</a> <span class="preprocessor">#define   PORT1_AUTO_NEG_100BTX_FD    0x0008</span>
<a name="l00253"></a>00253 <span class="preprocessor"></span>
<a name="l00254"></a><a class="code" href="ksz8851snl_8c.html#a1cbf25f36168aa181d221feff2e16579">00254</a> <span class="preprocessor">#define   PORT1_AUTO_NEG_100BTX       0x0004</span>
<a name="l00255"></a>00255 <span class="preprocessor"></span>
<a name="l00256"></a><a class="code" href="ksz8851snl_8c.html#a8d0097b4ce24b7b88280e5085868df73">00256</a> <span class="preprocessor">#define   PORT1_AUTO_NEG_10BT_FD      0x0002</span>
<a name="l00257"></a>00257 <span class="preprocessor"></span>
<a name="l00258"></a><a class="code" href="ksz8851snl_8c.html#adf3364401b833b9e7c0912fc6a90d86d">00258</a> <span class="preprocessor">#define   PORT1_AUTO_NEG_10BT         0x0001</span>
<a name="l00259"></a>00259 <span class="preprocessor"></span>
<a name="l00261"></a><a class="code" href="ksz8851snl_8c.html#a85f46f7c9891dd763ceb189d580ebe03">00261</a> <span class="preprocessor">#define   PORT1_CONFIG          (PORT1_AUTO_NEG_ENABLE    | \</span>
<a name="l00262"></a>00262 <span class="preprocessor">                                 PORT1_FORCE_100_MBIT     | \</span>
<a name="l00263"></a>00263 <span class="preprocessor">                                 PORT1_FORCE_FULL_DUPLEX  | \</span>
<a name="l00264"></a>00264 <span class="preprocessor">                                 PORT1_AUTO_NEG_FLOW_CTRL | \</span>
<a name="l00265"></a>00265 <span class="preprocessor">                                 PORT1_AUTO_NEG_100BTX_FD | \</span>
<a name="l00266"></a>00266 <span class="preprocessor">                                 PORT1_AUTO_NEG_100BTX    | \</span>
<a name="l00267"></a>00267 <span class="preprocessor">                                 PORT1_AUTO_NEG_10BT_FD   | \</span>
<a name="l00268"></a>00268 <span class="preprocessor">                                 PORT1_AUTO_NEG_10BT      )</span>
<a name="l00269"></a>00269 <span class="preprocessor"></span>
<a name="l00270"></a>00270 <span class="comment">/* Global Reset Register Options */</span>
<a name="l00272"></a><a class="code" href="ksz8851snl_8c.html#ae208507c34e08e32bccb9a392c803d4b">00272</a> <span class="preprocessor">#define QMU_MODULE_SOFT_RESET    0x0002</span>
<a name="l00273"></a>00273 <span class="preprocessor"></span>
<a name="l00274"></a><a class="code" href="ksz8851snl_8c.html#a4286160ca194bc8850c7fc9013fe3779">00274</a> <span class="preprocessor">#define GLOBAL_SOFT_RESET        0x0001</span>
<a name="l00275"></a>00275 <span class="preprocessor"></span>
<a name="l00277"></a><a class="code" href="ksz8851snl_8c.html#a6f5048620b3dde8583f7f1118e9de187">00277</a> <span class="preprocessor">#define PHY_RESET                0x0001</span>
<a name="l00278"></a>00278 <span class="preprocessor"></span>
<a name="l00279"></a>00279 <span class="comment">/* P1MBCR register */</span>
<a name="l00281"></a><a class="code" href="ksz8851snl_8c.html#afd5294adf51575bf765d1dc7d126fa91">00281</a> <span class="preprocessor">#define DIGITAL_LOOPBACK     0x4000</span>
<a name="l00282"></a>00282 <span class="preprocessor"></span>
<a name="l00283"></a><a class="code" href="ksz8851snl_8c.html#a8da7f27ab085e4ae5ced03050ecc2651">00283</a> <span class="preprocessor">#define FORCE_100            0x2000</span>
<a name="l00284"></a>00284 <span class="preprocessor"></span>
<a name="l00285"></a><a class="code" href="ksz8851snl_8c.html#a543c952d3573ec9a703cbf3470f69b1c">00285</a> <span class="preprocessor">#define AUTO_NEG             0x1000</span>
<a name="l00286"></a>00286 <span class="preprocessor"></span>
<a name="l00287"></a><a class="code" href="ksz8851snl_8c.html#a91e22764b853a4d283935d13f28a044c">00287</a> <span class="preprocessor">#define RESTART_AUTO_NEG     0x0200</span>
<a name="l00288"></a>00288 <span class="preprocessor"></span>
<a name="l00289"></a><a class="code" href="ksz8851snl_8c.html#aeaf13b5ca57ed5dcdae7a70e08f6f13a">00289</a> <span class="preprocessor">#define FORCE_FULL_DUPLEX    0x0100</span>
<a name="l00290"></a>00290 <span class="preprocessor"></span>
<a name="l00292"></a><a class="code" href="ksz8851snl_8c.html#af57085b82e30243420de0063be5a9faf">00292</a> <span class="preprocessor">#define TX_MEMORY_WAIT_MS    500</span>
<a name="l00293"></a>00293 <span class="preprocessor"></span>
<a name="l00295"></a><a class="code" href="ksz8851snl_8c.html#a82b54c052386458402cbcb4ca95d17db">00295</a> <span class="preprocessor">#define FRAME_COUNT_THRESHOLD 1</span>
<a name="l00296"></a>00296 <span class="preprocessor"></span>
<a name="l00298"></a><a class="code" href="ksz8851snl_8c.html#a20ca27dd1f0d0a4b0f8f2d7fc68b9a67">00298</a> <span class="preprocessor">#define MIB_MASK                    0x1C00       </span>
<a name="l00299"></a><a class="code" href="ksz8851snl_8c.html#a7b3e2a0e1514124e65b44209c4e75da8">00299</a> <span class="preprocessor">#define MIB_RxByte                  0x00         </span>
<a name="l00300"></a><a class="code" href="ksz8851snl_8c.html#ab9baf3b5b289f3f30994b1ca73a7cffc">00300</a> <span class="preprocessor">#define MIB_XXX                     0x01         </span>
<a name="l00301"></a><a class="code" href="ksz8851snl_8c.html#af77fe8bd283a893e4666c42084df4018">00301</a> <span class="preprocessor">#define MIB_RxUndersizePkt          0x02         </span>
<a name="l00302"></a><a class="code" href="ksz8851snl_8c.html#a877271f4dd85a65701155fd7c08dbcce">00302</a> <span class="preprocessor">#define MIB_RxFragments             0x03         </span>
<a name="l00303"></a><a class="code" href="ksz8851snl_8c.html#ab0f74dad531414aaef5191027f173127">00303</a> <span class="preprocessor">#define MIB_RxOversize              0x04         </span>
<a name="l00304"></a><a class="code" href="ksz8851snl_8c.html#a1943f008955fb33380c01881e958f285">00304</a> <span class="preprocessor">#define MIB_RxJabbers               0x05         </span>
<a name="l00305"></a><a class="code" href="ksz8851snl_8c.html#aa0cda94d56a44e218f4f1a405513cf3e">00305</a> <span class="preprocessor">#define MIB_RxSymbolError           0x06         </span>
<a name="l00306"></a><a class="code" href="ksz8851snl_8c.html#a0c53b377d3b1a6c19629cb2b00254a31">00306</a> <span class="preprocessor">#define MIB_RxCRCError              0x07         </span>
<a name="l00307"></a><a class="code" href="ksz8851snl_8c.html#a26e505e5f945348806a6422f38800f9e">00307</a> <span class="preprocessor">#define MIB_RxAlignmentError        0x08         </span>
<a name="l00308"></a><a class="code" href="ksz8851snl_8c.html#ab765664bef2e017367465b929358565f">00308</a> <span class="preprocessor">#define MIB_RxControl8808Pkts       0x09         </span>
<a name="l00309"></a><a class="code" href="ksz8851snl_8c.html#abda06c2c0ee5743c6b52dc4529fe843f">00309</a> <span class="preprocessor">#define MIB_RxPausePkts             0x0A         </span>
<a name="l00310"></a><a class="code" href="ksz8851snl_8c.html#aea40473651a77dea3f943647ff0dcc3f">00310</a> <span class="preprocessor">#define MIB_RxBroadcast             0x0B         </span>
<a name="l00311"></a><a class="code" href="ksz8851snl_8c.html#a7f7624dd74f65d485b83ce6d985ceadb">00311</a> <span class="preprocessor">#define MIB_RxMulticast             0x0C         </span>
<a name="l00312"></a><a class="code" href="ksz8851snl_8c.html#a89e01c83feb2a6a2a6ba44b8739b2436">00312</a> <span class="preprocessor">#define MIB_RxUnicast               0x0D         </span>
<a name="l00313"></a><a class="code" href="ksz8851snl_8c.html#afe475e41bf7628e761e57b567677c7ab">00313</a> <span class="preprocessor">#define MIB_Rx64Octets              0x0E         </span>
<a name="l00314"></a><a class="code" href="ksz8851snl_8c.html#a93154111cc8b0b46587f91838bd8d7f8">00314</a> <span class="preprocessor">#define MIB_Rx65to127Octets         0x0F         </span>
<a name="l00315"></a><a class="code" href="ksz8851snl_8c.html#aee13ec0a5e702ba0362f2cd3a4174f0e">00315</a> <span class="preprocessor">#define MIB_Rx128to255Octets        0x10         </span>
<a name="l00316"></a><a class="code" href="ksz8851snl_8c.html#ab7509002856ea6c2ca2f9c0ecc0f5cf9">00316</a> <span class="preprocessor">#define MIB_Rx256to511Octets        0x11         </span>
<a name="l00317"></a><a class="code" href="ksz8851snl_8c.html#a51ddde7ea1c2cb1d53ec6256d606e7c4">00317</a> <span class="preprocessor">#define MIB_Rx512to1023Octets       0x12         </span>
<a name="l00318"></a><a class="code" href="ksz8851snl_8c.html#a66f0bee98bb0c5907a3fb3ca93032088">00318</a> <span class="preprocessor">#define MIB_Rx1024to1521Octets      0x13         </span>
<a name="l00319"></a><a class="code" href="ksz8851snl_8c.html#aee3618f0c5da6241a1b1fce591bc81f0">00319</a> <span class="preprocessor">#define MIB_Rx1522to2000Octets      0x14         </span>
<a name="l00320"></a><a class="code" href="ksz8851snl_8c.html#ab81fe647d62bb6f5e024bad0a173f3f2">00320</a> <span class="preprocessor">#define MIB_TxByte                  0x15         </span>
<a name="l00321"></a><a class="code" href="ksz8851snl_8c.html#a6ccedee4178713093606af4ef623e46d">00321</a> <span class="preprocessor">#define MIB_TxLateCollision         0x16         </span>
<a name="l00322"></a><a class="code" href="ksz8851snl_8c.html#a503dfce549f31a47951f785b636c762f">00322</a> <span class="preprocessor">#define MIB_TxPausePkts             0x17         </span>
<a name="l00323"></a><a class="code" href="ksz8851snl_8c.html#a58ec254864d78b34afa2322c4a835b15">00323</a> <span class="preprocessor">#define MIB_TxBroadcastPkts         0x18         </span>
<a name="l00324"></a><a class="code" href="ksz8851snl_8c.html#a64fd7907e77cb4570457d7558bcb9b81">00324</a> <span class="preprocessor">#define MIB_TxMulticastPkts         0x19         </span>
<a name="l00325"></a><a class="code" href="ksz8851snl_8c.html#a85b6489a4f685aec8fa80eec8a9b15c5">00325</a> <span class="preprocessor">#define MIB_TxUnicastPkts           0x1A         </span>
<a name="l00326"></a><a class="code" href="ksz8851snl_8c.html#ad925e183a52c9215fb1cb775f2f4372b">00326</a> <span class="preprocessor">#define MIB_TxDeferred              0x1B         </span>
<a name="l00327"></a><a class="code" href="ksz8851snl_8c.html#a18250b5f09179aaf682a773042d55506">00327</a> <span class="preprocessor">#define MIB_TxTotalCollision        0x1C         </span>
<a name="l00328"></a><a class="code" href="ksz8851snl_8c.html#ad42643db163c0dfd947256277ce80a39">00328</a> <span class="preprocessor">#define MIB_TxExcessiveCollision    0x1D         </span>
<a name="l00329"></a><a class="code" href="ksz8851snl_8c.html#a7949177408865e3a8cd13e7205059c89">00329</a> <span class="preprocessor">#define MIB_TxSingleCollision       0x1E         </span>
<a name="l00330"></a><a class="code" href="ksz8851snl_8c.html#ab2c05fa995dea64ce68fd7cb8bcb5f71">00330</a> <span class="preprocessor">#define MIB_TxMultipleCollision     0x1F         </span>
<a name="l00333"></a>00333 <span class="preprocessor">#define READ_UNSAFE_REGISTERS       0</span>
<a name="l00334"></a>00334 <span class="preprocessor"></span>
<a name="l00335"></a>00335 <span class="keyword">static</span> uint16_t frameId = 0;        
<a name="l00336"></a>00336 <span class="keyword">static</span> uint8_t  macAddress[6];      
<a name="l00337"></a>00337 <span class="keyword">static</span> uint16_t rxFrameCount;
<a name="l00338"></a>00338 <span class="keyword">static</span> uint32_t interruptCnt = 0;
<a name="l00350"></a><a class="code" href="ksz8851snl_8c.html#ab17965a9fbeb7998e499f203fc153e69">00350</a> <span class="keyword">static</span> <a class="code" href="structKSZ8851SLN__mib__t.html" title="The MIB (Management Information Base) Counters that the ksz8851snl device expose...">KSZ8851SLN_mib_t</a> <a class="code" href="ksz8851snl_8c.html#ab17965a9fbeb7998e499f203fc153e69" title="Copy of the current MIB counters values from the ksz8851snl.">mibCounters</a>;
<a name="l00351"></a>00351 
<a name="l00352"></a>00352 <span class="comment">/***************************************************************************/</span>
<a name="l00362"></a><a class="code" href="ksz8851snl_8c.html#aca1ebdc21bb550265c785e6d5ae76f80">00362</a> <span class="keyword">static</span> uint32_t <a class="code" href="ksz8851snl_8c.html#aca1ebdc21bb550265c785e6d5ae76f80" title="helper function for KSZ8851SNL_UpdateMIBCounters">MIBCountersRead</a>(uint16_t offset)
<a name="l00363"></a>00363 {
<a name="l00364"></a>00364   uint16_t data;
<a name="l00365"></a>00365   uint32_t counter;
<a name="l00366"></a>00366 
<a name="l00367"></a>00367   data = <a class="code" href="ksz8851snl_8c.html#a20ca27dd1f0d0a4b0f8f2d7fc68b9a67" title="Management information base registers.">MIB_MASK</a> | offset;
<a name="l00368"></a>00368   <a class="code" href="group__ksz8851snl.html#ga194769a82e5a1c0ab03ea0923b7da2d0" title="Write ethernet controller register.">KSZ8851SNL_SPI_WriteRegister</a>(<a class="code" href="ksz8851snl_8c.html#ac5dddfc0f267c4206fae0c5823a71b5d" title="Indirect access control Register.">IACR</a>, data);
<a name="l00369"></a>00369   counter  = <a class="code" href="group__ksz8851snl.html#gaef8e79d738a8e792ea8335a14e4d80c5" title="Read ethernet controller register.">KSZ8851SNL_SPI_ReadRegister</a>(<a class="code" href="ksz8851snl_8c.html#ac70fd534e36f2de45f17f090752a30f0" title="Indirect access data low Register.">IADLR</a>);
<a name="l00370"></a>00370   counter |= <a class="code" href="group__ksz8851snl.html#gaef8e79d738a8e792ea8335a14e4d80c5" title="Read ethernet controller register.">KSZ8851SNL_SPI_ReadRegister</a>(<a class="code" href="ksz8851snl_8c.html#a7d059c3a3c5ce05c5513413d6e9cebf1" title="Indirect access data high Register.">IADHR</a>) &lt;&lt; 16;
<a name="l00371"></a>00371 
<a name="l00372"></a>00372   <span class="keywordflow">return</span> counter;
<a name="l00373"></a>00373 }
<a name="l00374"></a>00374 
<a name="l00375"></a>00375 <span class="comment">/***************************************************************************/</span>
<a name="l00382"></a><a class="code" href="group__ksz8851snl.html#ga9a2d44441ec164bb37194fb00d00994f">00382</a> <span class="keywordtype">void</span> <a class="code" href="group__ksz8851snl.html#ga9a2d44441ec164bb37194fb00d00994f" title="Update the Management Information Base Counters.">KSZ8851SNL_MIBCountersUpdate</a>(<span class="keywordtype">void</span>)
<a name="l00383"></a>00383 {
<a name="l00384"></a>00384   mibCounters.<a class="code" href="structKSZ8851SLN__mib__t.html#a40b90aa75121ca6c59f6f9525b8d049d" title="Rx octet count including bad packets.">RxByteCnt</a>           += <a class="code" href="ksz8851snl_8c.html#aca1ebdc21bb550265c785e6d5ae76f80" title="helper function for KSZ8851SNL_UpdateMIBCounters">MIBCountersRead</a>(<a class="code" href="ksz8851snl_8c.html#a7b3e2a0e1514124e65b44209c4e75da8" title="# of received bytes">MIB_RxByte</a>);
<a name="l00385"></a>00385   mibCounters.<a class="code" href="structKSZ8851SLN__mib__t.html#ab96af0e653da22fffc516b2907e35d85" title="Rx undersize packets w/ good CRC.">RxUndersizePktCnt</a>   += <a class="code" href="ksz8851snl_8c.html#aca1ebdc21bb550265c785e6d5ae76f80" title="helper function for KSZ8851SNL_UpdateMIBCounters">MIBCountersRead</a>(<a class="code" href="ksz8851snl_8c.html#af77fe8bd283a893e4666c42084df4018" title="# of received undersized packets">MIB_RxUndersizePkt</a>);
<a name="l00386"></a>00386   mibCounters.<a class="code" href="structKSZ8851SLN__mib__t.html#a21dcc9bc0494959990ee2c38931d0196" title="Rx fragment packets w/ bad CRC, symbol errors or alignment errors.">RxFragmentsCnt</a>      += <a class="code" href="ksz8851snl_8c.html#aca1ebdc21bb550265c785e6d5ae76f80" title="helper function for KSZ8851SNL_UpdateMIBCounters">MIBCountersRead</a>(<a class="code" href="ksz8851snl_8c.html#a877271f4dd85a65701155fd7c08dbcce" title="# of received fragments">MIB_RxFragments</a>);
<a name="l00387"></a>00387   mibCounters.<a class="code" href="structKSZ8851SLN__mib__t.html#a11b5c6e393abbda139004c949ee39909" title="Rx oversize packets w/ good CRC (max: 1536 bytes).">RxOversizeCnt</a>       += <a class="code" href="ksz8851snl_8c.html#aca1ebdc21bb550265c785e6d5ae76f80" title="helper function for KSZ8851SNL_UpdateMIBCounters">MIBCountersRead</a>(<a class="code" href="ksz8851snl_8c.html#ab0f74dad531414aaef5191027f173127" title="# of received oversized packets">MIB_RxOversize</a>);
<a name="l00388"></a>00388   mibCounters.<a class="code" href="structKSZ8851SLN__mib__t.html#ae59d98ed5ebae0b2442d70e5d142f7b7" title="Rx packets longer than 1536 bytes w/ either CRC errors, alignment errors, or symbol...">RxJabbersCnt</a>        += <a class="code" href="ksz8851snl_8c.html#aca1ebdc21bb550265c785e6d5ae76f80" title="helper function for KSZ8851SNL_UpdateMIBCounters">MIBCountersRead</a>(<a class="code" href="ksz8851snl_8c.html#a1943f008955fb33380c01881e958f285" title="# of received jabbers">MIB_RxJabbers</a>);
<a name="l00389"></a>00389   mibCounters.<a class="code" href="structKSZ8851SLN__mib__t.html#a3b8ec28460498d7e45dc9fc51a8fbe91" title="Rx packets w/ invalid data symbol and legal packet size.">RxSymbolErrorCnt</a>    += <a class="code" href="ksz8851snl_8c.html#aca1ebdc21bb550265c785e6d5ae76f80" title="helper function for KSZ8851SNL_UpdateMIBCounters">MIBCountersRead</a>(<a class="code" href="ksz8851snl_8c.html#aa0cda94d56a44e218f4f1a405513cf3e" title="# of received error symbols">MIB_RxSymbolError</a>);
<a name="l00390"></a>00390   mibCounters.<a class="code" href="structKSZ8851SLN__mib__t.html#a366794317e57654d52b79fd145b87163" title="Rx packets within (64,2000) bytes w/ an integral number of bytes and a bad CRC.">RxCRCErrorCnt</a>       += <a class="code" href="ksz8851snl_8c.html#aca1ebdc21bb550265c785e6d5ae76f80" title="helper function for KSZ8851SNL_UpdateMIBCounters">MIBCountersRead</a>(<a class="code" href="ksz8851snl_8c.html#a0c53b377d3b1a6c19629cb2b00254a31" title="# of received packets with CRC error">MIB_RxCRCError</a>);
<a name="l00391"></a>00391   mibCounters.<a class="code" href="structKSZ8851SLN__mib__t.html#a988d22fb66caeb096a4204e951d7e223" title="Number of PAUSE frames received by a port.">RxPausePktsCnt</a>      += <a class="code" href="ksz8851snl_8c.html#aca1ebdc21bb550265c785e6d5ae76f80" title="helper function for KSZ8851SNL_UpdateMIBCounters">MIBCountersRead</a>(<a class="code" href="ksz8851snl_8c.html#abda06c2c0ee5743c6b52dc4529fe843f" title="# of received pause packets">MIB_RxPausePkts</a>);
<a name="l00392"></a>00392   mibCounters.<a class="code" href="structKSZ8851SLN__mib__t.html#a6ef7694aa042a10a4c0dc70b569fea9c" title="Rx good broadcast packets.">RxBroadcastCnt</a>      += <a class="code" href="ksz8851snl_8c.html#aca1ebdc21bb550265c785e6d5ae76f80" title="helper function for KSZ8851SNL_UpdateMIBCounters">MIBCountersRead</a>(<a class="code" href="ksz8851snl_8c.html#aea40473651a77dea3f943647ff0dcc3f" title="# of received broadcast packets">MIB_RxBroadcast</a>);
<a name="l00393"></a>00393   mibCounters.<a class="code" href="structKSZ8851SLN__mib__t.html#a3404596d1289d4582ceff5a95b2dfdd7" title="Rx good multicast packets.">RxMulticastCnt</a>      += <a class="code" href="ksz8851snl_8c.html#aca1ebdc21bb550265c785e6d5ae76f80" title="helper function for KSZ8851SNL_UpdateMIBCounters">MIBCountersRead</a>(<a class="code" href="ksz8851snl_8c.html#a7f7624dd74f65d485b83ce6d985ceadb" title="# of received multicast packets">MIB_RxMulticast</a>);
<a name="l00394"></a>00394   mibCounters.<a class="code" href="structKSZ8851SLN__mib__t.html#afed45c32721cfe107c7a1daba4522a13" title="Rx good unicast packets.">RxUnicastCnt</a>        += <a class="code" href="ksz8851snl_8c.html#aca1ebdc21bb550265c785e6d5ae76f80" title="helper function for KSZ8851SNL_UpdateMIBCounters">MIBCountersRead</a>(<a class="code" href="ksz8851snl_8c.html#a89e01c83feb2a6a2a6ba44b8739b2436" title="# of received unicast packets">MIB_RxUnicast</a>);
<a name="l00395"></a>00395   mibCounters.<a class="code" href="structKSZ8851SLN__mib__t.html#a597b3e0b64d2d606a049f3290fc45e1f" title="Tx good octet count, including PAUSE packets.">TxByteCnt</a>           += <a class="code" href="ksz8851snl_8c.html#aca1ebdc21bb550265c785e6d5ae76f80" title="helper function for KSZ8851SNL_UpdateMIBCounters">MIBCountersRead</a>(<a class="code" href="ksz8851snl_8c.html#ab81fe647d62bb6f5e024bad0a173f3f2" title="# of transmitted bytes">MIB_TxByte</a>);
<a name="l00396"></a>00396   mibCounters.<a class="code" href="structKSZ8851SLN__mib__t.html#a4797a7e3d10e96cd805de203057d1369" title="Number of PAUSE frames transmitted.">TxPausePktsCnt</a>      += <a class="code" href="ksz8851snl_8c.html#aca1ebdc21bb550265c785e6d5ae76f80" title="helper function for KSZ8851SNL_UpdateMIBCounters">MIBCountersRead</a>(<a class="code" href="ksz8851snl_8c.html#a503dfce549f31a47951f785b636c762f" title="# of transmitted pause packets">MIB_TxPausePkts</a>);
<a name="l00397"></a>00397   mibCounters.<a class="code" href="structKSZ8851SLN__mib__t.html#aed3f252ed08ffa3347703482fc6710dc" title="Tx good broadcast packets.">TxBroadcastPktsCnt</a>  += <a class="code" href="ksz8851snl_8c.html#aca1ebdc21bb550265c785e6d5ae76f80" title="helper function for KSZ8851SNL_UpdateMIBCounters">MIBCountersRead</a>(<a class="code" href="ksz8851snl_8c.html#a58ec254864d78b34afa2322c4a835b15" title="# of transmitted broadcast packets">MIB_TxBroadcastPkts</a>);
<a name="l00398"></a>00398   mibCounters.<a class="code" href="structKSZ8851SLN__mib__t.html#aa3ddeba759f2509cc236bb5f9cb3404d" title="Tx good multicast packets.">TxMulticastPktsCnt</a>  += <a class="code" href="ksz8851snl_8c.html#aca1ebdc21bb550265c785e6d5ae76f80" title="helper function for KSZ8851SNL_UpdateMIBCounters">MIBCountersRead</a>(<a class="code" href="ksz8851snl_8c.html#a64fd7907e77cb4570457d7558bcb9b81" title="# of transmitted multicast packets">MIB_TxMulticastPkts</a>);
<a name="l00399"></a>00399   mibCounters.<a class="code" href="structKSZ8851SLN__mib__t.html#a4bf723fcc1d4108b347444d65e117ce9" title="Tx good unicast packets.">TxUnicastPktsCnt</a>    += <a class="code" href="ksz8851snl_8c.html#aca1ebdc21bb550265c785e6d5ae76f80" title="helper function for KSZ8851SNL_UpdateMIBCounters">MIBCountersRead</a>(<a class="code" href="ksz8851snl_8c.html#a85b6489a4f685aec8fa80eec8a9b15c5" title="# of transmitted unicast packets">MIB_TxUnicastPkts</a>);
<a name="l00400"></a>00400   mibCounters.<a class="code" href="structKSZ8851SLN__mib__t.html#ab4389dd1adb89cde38564d614e2cdd42" title="Tx packets by a port for which the 1st Tx attempt is delayed due to the busy medium...">TxDeferredCnt</a>       += <a class="code" href="ksz8851snl_8c.html#aca1ebdc21bb550265c785e6d5ae76f80" title="helper function for KSZ8851SNL_UpdateMIBCounters">MIBCountersRead</a>(<a class="code" href="ksz8851snl_8c.html#ad925e183a52c9215fb1cb775f2f4372b" title="# of transmitted deferred packets">MIB_TxDeferred</a>);
<a name="l00401"></a>00401   mibCounters.<a class="code" href="structKSZ8851SLN__mib__t.html#a589e6277c1bd02bf2fe78cfa099bb07c" title="Tx total collision, half duplex only.">TxTotalCollisionCnt</a> += <a class="code" href="ksz8851snl_8c.html#aca1ebdc21bb550265c785e6d5ae76f80" title="helper function for KSZ8851SNL_UpdateMIBCounters">MIBCountersRead</a>(<a class="code" href="ksz8851snl_8c.html#a18250b5f09179aaf682a773042d55506" title="# of transmitted total collisions">MIB_TxTotalCollision</a>);
<a name="l00402"></a>00402 }
<a name="l00403"></a>00403 
<a name="l00404"></a>00404 <span class="comment">/***************************************************************************/</span>
<a name="l00409"></a><a class="code" href="group__ksz8851snl.html#ga22dfd04517c38f1bec28ae63aae92b86">00409</a> <span class="keywordtype">void</span> <a class="code" href="group__ksz8851snl.html#ga22dfd04517c38f1bec28ae63aae92b86" title="Dumps the Management Information Base Counters.">KSZ8851SNL_MIBCountersDump</a>(<span class="keywordtype">void</span>)
<a name="l00410"></a>00410 {
<a name="l00411"></a>00411   printf(<span class="stringliteral">&quot;####################### MIB COUNTER DUMP ########################\n&quot;</span>);
<a name="l00412"></a>00412   printf(<span class="stringliteral">&quot;MIB_RxByteCnt           = %lu\n&quot;</span>, mibCounters.<a class="code" href="structKSZ8851SLN__mib__t.html#a40b90aa75121ca6c59f6f9525b8d049d" title="Rx octet count including bad packets.">RxByteCnt</a>);
<a name="l00413"></a>00413   printf(<span class="stringliteral">&quot;MIB_RxUndersizePktCnt   = %lu\n&quot;</span>, mibCounters.<a class="code" href="structKSZ8851SLN__mib__t.html#ab96af0e653da22fffc516b2907e35d85" title="Rx undersize packets w/ good CRC.">RxUndersizePktCnt</a>);
<a name="l00414"></a>00414   printf(<span class="stringliteral">&quot;MIB_RxFragmentsCnt      = %lu\n&quot;</span>, mibCounters.<a class="code" href="structKSZ8851SLN__mib__t.html#a21dcc9bc0494959990ee2c38931d0196" title="Rx fragment packets w/ bad CRC, symbol errors or alignment errors.">RxFragmentsCnt</a>);
<a name="l00415"></a>00415   printf(<span class="stringliteral">&quot;MIB_RxOversizeCnt       = %lu\n&quot;</span>, mibCounters.<a class="code" href="structKSZ8851SLN__mib__t.html#a11b5c6e393abbda139004c949ee39909" title="Rx oversize packets w/ good CRC (max: 1536 bytes).">RxOversizeCnt</a>);
<a name="l00416"></a>00416   printf(<span class="stringliteral">&quot;MIB_RxJabbersCnt        = %lu\n&quot;</span>, mibCounters.<a class="code" href="structKSZ8851SLN__mib__t.html#ae59d98ed5ebae0b2442d70e5d142f7b7" title="Rx packets longer than 1536 bytes w/ either CRC errors, alignment errors, or symbol...">RxJabbersCnt</a>);
<a name="l00417"></a>00417   printf(<span class="stringliteral">&quot;MIB_RxSymbolErrorCnt    = %lu\n&quot;</span>, mibCounters.<a class="code" href="structKSZ8851SLN__mib__t.html#a3b8ec28460498d7e45dc9fc51a8fbe91" title="Rx packets w/ invalid data symbol and legal packet size.">RxSymbolErrorCnt</a>);
<a name="l00418"></a>00418   printf(<span class="stringliteral">&quot;MIB_RxCRCErrorCnt       = %lu\n&quot;</span>, mibCounters.<a class="code" href="structKSZ8851SLN__mib__t.html#a366794317e57654d52b79fd145b87163" title="Rx packets within (64,2000) bytes w/ an integral number of bytes and a bad CRC.">RxCRCErrorCnt</a>);
<a name="l00419"></a>00419   printf(<span class="stringliteral">&quot;MIB_RxPausePktsCnt      = %lu\n&quot;</span>, mibCounters.<a class="code" href="structKSZ8851SLN__mib__t.html#a988d22fb66caeb096a4204e951d7e223" title="Number of PAUSE frames received by a port.">RxPausePktsCnt</a>);
<a name="l00420"></a>00420   printf(<span class="stringliteral">&quot;MIB_RxBroadcastCnt      = %lu\n&quot;</span>, mibCounters.<a class="code" href="structKSZ8851SLN__mib__t.html#a6ef7694aa042a10a4c0dc70b569fea9c" title="Rx good broadcast packets.">RxBroadcastCnt</a>);
<a name="l00421"></a>00421   printf(<span class="stringliteral">&quot;MIB_RxMulticastCnt      = %lu\n&quot;</span>, mibCounters.<a class="code" href="structKSZ8851SLN__mib__t.html#a3404596d1289d4582ceff5a95b2dfdd7" title="Rx good multicast packets.">RxMulticastCnt</a>);
<a name="l00422"></a>00422   printf(<span class="stringliteral">&quot;MIB_RxUnicastCnt        = %lu\n&quot;</span>, mibCounters.<a class="code" href="structKSZ8851SLN__mib__t.html#afed45c32721cfe107c7a1daba4522a13" title="Rx good unicast packets.">RxUnicastCnt</a>);
<a name="l00423"></a>00423   printf(<span class="stringliteral">&quot;MIB_TxByteCnt           = %lu\n&quot;</span>, mibCounters.<a class="code" href="structKSZ8851SLN__mib__t.html#a597b3e0b64d2d606a049f3290fc45e1f" title="Tx good octet count, including PAUSE packets.">TxByteCnt</a>);
<a name="l00424"></a>00424   printf(<span class="stringliteral">&quot;MIB_TxPausePktsCnt      = %lu\n&quot;</span>, mibCounters.<a class="code" href="structKSZ8851SLN__mib__t.html#a4797a7e3d10e96cd805de203057d1369" title="Number of PAUSE frames transmitted.">TxPausePktsCnt</a>);
<a name="l00425"></a>00425   printf(<span class="stringliteral">&quot;MIB_TxBroadcastPktsCnt  = %lu\n&quot;</span>, mibCounters.<a class="code" href="structKSZ8851SLN__mib__t.html#aed3f252ed08ffa3347703482fc6710dc" title="Tx good broadcast packets.">TxBroadcastPktsCnt</a>);
<a name="l00426"></a>00426   printf(<span class="stringliteral">&quot;MIB_TxMulticastPktsCnt  = %lu\n&quot;</span>, mibCounters.<a class="code" href="structKSZ8851SLN__mib__t.html#aa3ddeba759f2509cc236bb5f9cb3404d" title="Tx good multicast packets.">TxMulticastPktsCnt</a>);
<a name="l00427"></a>00427   printf(<span class="stringliteral">&quot;MIB_TxUnicastPktsCnt    = %lu\n&quot;</span>, mibCounters.<a class="code" href="structKSZ8851SLN__mib__t.html#a4bf723fcc1d4108b347444d65e117ce9" title="Tx good unicast packets.">TxUnicastPktsCnt</a>);
<a name="l00428"></a>00428   printf(<span class="stringliteral">&quot;MIB_TxDeferredCnt       = %lu\n&quot;</span>, mibCounters.<a class="code" href="structKSZ8851SLN__mib__t.html#ab4389dd1adb89cde38564d614e2cdd42" title="Tx packets by a port for which the 1st Tx attempt is delayed due to the busy medium...">TxDeferredCnt</a>);
<a name="l00429"></a>00429   printf(<span class="stringliteral">&quot;MIB_TxTotalCollisionCnt = %lu\n&quot;</span>, mibCounters.<a class="code" href="structKSZ8851SLN__mib__t.html#a589e6277c1bd02bf2fe78cfa099bb07c" title="Tx total collision, half duplex only.">TxTotalCollisionCnt</a>);
<a name="l00430"></a>00430   printf(<span class="stringliteral">&quot;#################################################################\n&quot;</span>);
<a name="l00431"></a>00431 }
<a name="l00432"></a>00432 
<a name="l00433"></a>00433 <span class="comment">/***************************************************************************/</span>
<a name="l00437"></a><a class="code" href="group__ksz8851snl.html#ga08945d0a156fe9fdce410ff86e464acf">00437</a> <span class="keywordtype">void</span> <a class="code" href="group__ksz8851snl.html#ga08945d0a156fe9fdce410ff86e464acf" title="Prints the value of the registers of the ethernet controller.">KSZ8851SNL_AllRegistersDump</a>(<span class="keywordtype">void</span>)
<a name="l00438"></a>00438 {
<a name="l00439"></a>00439   printf(<span class="stringliteral">&quot;###################### ALL REGISTER DUMP ########################\n&quot;</span>);
<a name="l00440"></a>00440   <span class="keywordtype">int</span> i;
<a name="l00441"></a>00441   <span class="keywordflow">for</span> (i = 0x00; i &lt; 0xFF; i += 0x02)
<a name="l00442"></a>00442   {
<a name="l00443"></a>00443     <span class="keywordflow">if</span> ((i % 8 == 0) &amp;&amp; (i &gt; 0))
<a name="l00444"></a>00444     {
<a name="l00445"></a>00445       printf(<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00446"></a>00446     }
<a name="l00447"></a>00447     printf(<span class="stringliteral">&quot;REG[0x%02X]=0x%04X &quot;</span>, i, <a class="code" href="group__ksz8851snl.html#gaef8e79d738a8e792ea8335a14e4d80c5" title="Read ethernet controller register.">KSZ8851SNL_SPI_ReadRegister</a>(i));
<a name="l00448"></a>00448   }
<a name="l00449"></a>00449   printf(<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00450"></a>00450   printf(<span class="stringliteral">&quot;#################################################################\n&quot;</span>);
<a name="l00451"></a>00451 }
<a name="l00452"></a>00452 
<a name="l00453"></a>00453 <span class="comment">/***************************************************************************/</span>
<a name="l00457"></a><a class="code" href="group__ksz8851snl.html#ga67dc1040b0d6482f79bb68f789fd375d">00457</a> <span class="keywordtype">void</span> <a class="code" href="group__ksz8851snl.html#ga67dc1040b0d6482f79bb68f789fd375d" title="Prints the value of the registers of the ethernet controller.">KSZ8851SNL_RegistersDump</a>(<span class="keywordtype">void</span>)
<a name="l00458"></a>00458 {
<a name="l00459"></a>00459   printf(<span class="stringliteral">&quot;##################### SPECIAL REGISTER DUMP ######################\n&quot;</span>);
<a name="l00460"></a>00460   printf(<span class="stringliteral">&quot;MARL  [0x%02X]=0x%04X\n&quot;</span>, <a class="code" href="ksz8851snl_8c.html#aec33aabaaae5da6e6c4dca64d286a5e5" title="MAC Address Low.">MARL</a>,   <a class="code" href="group__ksz8851snl.html#gaef8e79d738a8e792ea8335a14e4d80c5" title="Read ethernet controller register.">KSZ8851SNL_SPI_ReadRegister</a>(<a class="code" href="ksz8851snl_8c.html#aec33aabaaae5da6e6c4dca64d286a5e5" title="MAC Address Low.">MARL</a>));
<a name="l00461"></a>00461   printf(<span class="stringliteral">&quot;MARM  [0x%02X]=0x%04X\n&quot;</span>, <a class="code" href="ksz8851snl_8c.html#a53b0bd1eebb93c5d26d4ee73a6928140" title="MAC Address Middle.">MARM</a>,   <a class="code" href="group__ksz8851snl.html#gaef8e79d738a8e792ea8335a14e4d80c5" title="Read ethernet controller register.">KSZ8851SNL_SPI_ReadRegister</a>(<a class="code" href="ksz8851snl_8c.html#a53b0bd1eebb93c5d26d4ee73a6928140" title="MAC Address Middle.">MARM</a>));
<a name="l00462"></a>00462   printf(<span class="stringliteral">&quot;MARH  [0x%02X]=0x%04X\n&quot;</span>, <a class="code" href="ksz8851snl_8c.html#a328ffd91c6ae67b14aad42bcf1aa8927" title="MAC Address High.">MARH</a>,   <a class="code" href="group__ksz8851snl.html#gaef8e79d738a8e792ea8335a14e4d80c5" title="Read ethernet controller register.">KSZ8851SNL_SPI_ReadRegister</a>(<a class="code" href="ksz8851snl_8c.html#a328ffd91c6ae67b14aad42bcf1aa8927" title="MAC Address High.">MARH</a>));
<a name="l00463"></a>00463   printf(<span class="stringliteral">&quot;OBCR  [0x%02X]=0x%04X\n&quot;</span>, <a class="code" href="ksz8851snl_8c.html#a935d63bec1945201ecb17b7e3bd7ebb7" title="On-Chip Bus Control Register.">OBCR</a>,   <a class="code" href="group__ksz8851snl.html#gaef8e79d738a8e792ea8335a14e4d80c5" title="Read ethernet controller register.">KSZ8851SNL_SPI_ReadRegister</a>(<a class="code" href="ksz8851snl_8c.html#a935d63bec1945201ecb17b7e3bd7ebb7" title="On-Chip Bus Control Register.">OBCR</a>));
<a name="l00464"></a>00464   printf(<span class="stringliteral">&quot;GRR   [0x%02X]=0x%04X\n&quot;</span>, <a class="code" href="ksz8851snl_8c.html#a092b1852ba2fbba0bcdd216f3f641b49" title="Global Reset Register.">GRR</a>,    <a class="code" href="group__ksz8851snl.html#gaef8e79d738a8e792ea8335a14e4d80c5" title="Read ethernet controller register.">KSZ8851SNL_SPI_ReadRegister</a>(<a class="code" href="ksz8851snl_8c.html#a092b1852ba2fbba0bcdd216f3f641b49" title="Global Reset Register.">GRR</a>));
<a name="l00465"></a>00465   printf(<span class="stringliteral">&quot;TXCR  [0x%02X]=0x%04X\n&quot;</span>, <a class="code" href="ksz8851snl_8c.html#a926b6d1474c9258a92607b9b4272549e" title="Transmit Flow Control Register.">TXCR</a>,   <a class="code" href="group__ksz8851snl.html#gaef8e79d738a8e792ea8335a14e4d80c5" title="Read ethernet controller register.">KSZ8851SNL_SPI_ReadRegister</a>(<a class="code" href="ksz8851snl_8c.html#a926b6d1474c9258a92607b9b4272549e" title="Transmit Flow Control Register.">TXCR</a>));
<a name="l00466"></a>00466   printf(<span class="stringliteral">&quot;RXCR1 [0x%02X]=0x%04X\n&quot;</span>, <a class="code" href="ksz8851snl_8c.html#a3f311ff23775b0dd05baeafa58bbaa22" title="Receive Flow Control Register 1.">RXCR1</a>,  <a class="code" href="group__ksz8851snl.html#gaef8e79d738a8e792ea8335a14e4d80c5" title="Read ethernet controller register.">KSZ8851SNL_SPI_ReadRegister</a>(<a class="code" href="ksz8851snl_8c.html#a3f311ff23775b0dd05baeafa58bbaa22" title="Receive Flow Control Register 1.">RXCR1</a>));
<a name="l00467"></a>00467   printf(<span class="stringliteral">&quot;RXCR2 [0x%02X]=0x%04X\n&quot;</span>, <a class="code" href="ksz8851snl_8c.html#a610096e926ba4386c101f42eb51f83ed" title="Receive Flow Control Register 2.">RXCR2</a>,  <a class="code" href="group__ksz8851snl.html#gaef8e79d738a8e792ea8335a14e4d80c5" title="Read ethernet controller register.">KSZ8851SNL_SPI_ReadRegister</a>(<a class="code" href="ksz8851snl_8c.html#a610096e926ba4386c101f42eb51f83ed" title="Receive Flow Control Register 2.">RXCR2</a>));
<a name="l00468"></a>00468   printf(<span class="stringliteral">&quot;TXMIR [0x%02X]=0x%04X\n&quot;</span>, <a class="code" href="ksz8851snl_8c.html#afce935acdb1eb7756aeb45bddb6ffbcd" title="TXQ Memory Information Register.">TXMIR</a>,  <a class="code" href="group__ksz8851snl.html#gaef8e79d738a8e792ea8335a14e4d80c5" title="Read ethernet controller register.">KSZ8851SNL_SPI_ReadRegister</a>(<a class="code" href="ksz8851snl_8c.html#afce935acdb1eb7756aeb45bddb6ffbcd" title="TXQ Memory Information Register.">TXMIR</a>));
<a name="l00469"></a>00469 <span class="preprocessor">#if (READ_UNSAFE_REGISTERS)</span>
<a name="l00470"></a>00470 <span class="preprocessor"></span>  printf(<span class="stringliteral">&quot;RXFHSR[0x%02X]=0x%04X\n&quot;</span>, <a class="code" href="ksz8851snl_8c.html#a30e9e4c89c87aa77f0168cec82474b8c" title="Receive Frame Header Status Register.">RXFHSR</a>, <a class="code" href="group__ksz8851snl.html#gaef8e79d738a8e792ea8335a14e4d80c5" title="Read ethernet controller register.">KSZ8851SNL_SPI_ReadRegister</a>(<a class="code" href="ksz8851snl_8c.html#a30e9e4c89c87aa77f0168cec82474b8c" title="Receive Frame Header Status Register.">RXFHSR</a>));
<a name="l00471"></a>00471 <span class="preprocessor">#endif</span>
<a name="l00472"></a>00472 <span class="preprocessor"></span>  printf(<span class="stringliteral">&quot;TXQCR [0x%02X]=0x%04X\n&quot;</span>, <a class="code" href="ksz8851snl_8c.html#a272d3d63d93ee08337f48780bf95f9db" title="TXQ Command Register.">TXQCR</a>,  <a class="code" href="group__ksz8851snl.html#gaef8e79d738a8e792ea8335a14e4d80c5" title="Read ethernet controller register.">KSZ8851SNL_SPI_ReadRegister</a>(<a class="code" href="ksz8851snl_8c.html#a272d3d63d93ee08337f48780bf95f9db" title="TXQ Command Register.">TXQCR</a>));
<a name="l00473"></a>00473   printf(<span class="stringliteral">&quot;RXQCR [0x%02X]=0x%04X\n&quot;</span>, <a class="code" href="ksz8851snl_8c.html#af5c7dd624af5db2a9d1e5ff08d17d7a1" title="RXQ Command Register.">RXQCR</a>,  <a class="code" href="group__ksz8851snl.html#gaef8e79d738a8e792ea8335a14e4d80c5" title="Read ethernet controller register.">KSZ8851SNL_SPI_ReadRegister</a>(<a class="code" href="ksz8851snl_8c.html#af5c7dd624af5db2a9d1e5ff08d17d7a1" title="RXQ Command Register.">RXQCR</a>));
<a name="l00474"></a>00474   printf(<span class="stringliteral">&quot;TXFDPR[0x%02X]=0x%04X\n&quot;</span>, <a class="code" href="ksz8851snl_8c.html#a62ea34f447f8a5b2f10e3cd18e2e33c9" title="TX Frame Data Pointer Register.">TXFDPR</a>, <a class="code" href="group__ksz8851snl.html#gaef8e79d738a8e792ea8335a14e4d80c5" title="Read ethernet controller register.">KSZ8851SNL_SPI_ReadRegister</a>(<a class="code" href="ksz8851snl_8c.html#a62ea34f447f8a5b2f10e3cd18e2e33c9" title="TX Frame Data Pointer Register.">TXFDPR</a>));
<a name="l00475"></a>00475   printf(<span class="stringliteral">&quot;RXFDPR[0x%02X]=0x%04X\n&quot;</span>, <a class="code" href="ksz8851snl_8c.html#a30336f6509570d09b6a6ef1309499c99" title="RX Frame Data Pointer Register.">RXFDPR</a>, <a class="code" href="group__ksz8851snl.html#gaef8e79d738a8e792ea8335a14e4d80c5" title="Read ethernet controller register.">KSZ8851SNL_SPI_ReadRegister</a>(<a class="code" href="ksz8851snl_8c.html#a30336f6509570d09b6a6ef1309499c99" title="RX Frame Data Pointer Register.">RXFDPR</a>));
<a name="l00476"></a>00476   printf(<span class="stringliteral">&quot;IER   [0x%02X]=0x%04X\n&quot;</span>, <a class="code" href="ksz8851snl_8c.html#a3e27fa35f9febccdc4a0c28a5c8cffbb" title="Interrupt Enable Register.">IER</a>,    <a class="code" href="group__ksz8851snl.html#gaef8e79d738a8e792ea8335a14e4d80c5" title="Read ethernet controller register.">KSZ8851SNL_SPI_ReadRegister</a>(<a class="code" href="ksz8851snl_8c.html#a3e27fa35f9febccdc4a0c28a5c8cffbb" title="Interrupt Enable Register.">IER</a>));
<a name="l00477"></a>00477   printf(<span class="stringliteral">&quot;ISR   [0x%02X]=0x%04X\n&quot;</span>, <a class="code" href="ksz8851snl_8c.html#a421ef10418d62e6b65390cb8cdab5c15" title="Interrupt Status Register.">ISR</a>,    <a class="code" href="group__ksz8851snl.html#gaef8e79d738a8e792ea8335a14e4d80c5" title="Read ethernet controller register.">KSZ8851SNL_SPI_ReadRegister</a>(<a class="code" href="ksz8851snl_8c.html#a421ef10418d62e6b65390cb8cdab5c15" title="Interrupt Status Register.">ISR</a>));
<a name="l00478"></a>00478   printf(<span class="stringliteral">&quot;RXFCTR[0x%02X]=0x%04X\n&quot;</span>, <a class="code" href="ksz8851snl_8c.html#a3f38906b3f69e1ae69ab71fa624863c0" title="RX Frame Count &amp;amp; Threshold Register.">RXFCTR</a>, <a class="code" href="group__ksz8851snl.html#gaef8e79d738a8e792ea8335a14e4d80c5" title="Read ethernet controller register.">KSZ8851SNL_SPI_ReadRegister</a>(<a class="code" href="ksz8851snl_8c.html#a3f38906b3f69e1ae69ab71fa624863c0" title="RX Frame Count &amp;amp; Threshold Register.">RXFCTR</a>));
<a name="l00479"></a>00479 <span class="preprocessor">#if (READ_UNSAFE_REGISTERS)</span>
<a name="l00480"></a>00480 <span class="preprocessor"></span>  printf(<span class="stringliteral">&quot;TXNTFSR[0x%02X]=0x%04X\n&quot;</span>, <a class="code" href="ksz8851snl_8c.html#a489ade49aadfa6fd965c1ce4e9567faa" title="TX Next Frame size register.">TXNTFSR</a>, <a class="code" href="group__ksz8851snl.html#gaef8e79d738a8e792ea8335a14e4d80c5" title="Read ethernet controller register.">KSZ8851SNL_SPI_ReadRegister</a>(<a class="code" href="ksz8851snl_8c.html#a489ade49aadfa6fd965c1ce4e9567faa" title="TX Next Frame size register.">TXNTFSR</a>));
<a name="l00481"></a>00481 <span class="preprocessor">#endif</span>
<a name="l00482"></a>00482 <span class="preprocessor"></span>  printf(<span class="stringliteral">&quot;CIDER [0x%02X]=0x%04X\n&quot;</span>, <a class="code" href="ksz8851snl_8c.html#a586a7f4e18d53f3c99321c82a7c8cbcf" title="Chip ID and Enable Register.">CIDER</a>,  <a class="code" href="group__ksz8851snl.html#gaef8e79d738a8e792ea8335a14e4d80c5" title="Read ethernet controller register.">KSZ8851SNL_SPI_ReadRegister</a>(<a class="code" href="ksz8851snl_8c.html#a586a7f4e18d53f3c99321c82a7c8cbcf" title="Chip ID and Enable Register.">CIDER</a>));
<a name="l00483"></a>00483   printf(<span class="stringliteral">&quot;PHYRR [0x%02X]=0x%04X\n&quot;</span>, <a class="code" href="ksz8851snl_8c.html#a899443e7d74043411fea3eee7d9de9f6" title="PHY Reset Register.">PHYRR</a>,  <a class="code" href="group__ksz8851snl.html#gaef8e79d738a8e792ea8335a14e4d80c5" title="Read ethernet controller register.">KSZ8851SNL_SPI_ReadRegister</a>(<a class="code" href="ksz8851snl_8c.html#a899443e7d74043411fea3eee7d9de9f6" title="PHY Reset Register.">PHYRR</a>));
<a name="l00484"></a>00484   printf(<span class="stringliteral">&quot;P1MBCR[0x%02X]=0x%04X\n&quot;</span>, <a class="code" href="ksz8851snl_8c.html#aaf7daae0d88c4a4c4e0ba68e83e8e968" title="PHY1 MII-Register Basic Control Register.">P1MBCR</a>, <a class="code" href="group__ksz8851snl.html#gaef8e79d738a8e792ea8335a14e4d80c5" title="Read ethernet controller register.">KSZ8851SNL_SPI_ReadRegister</a>(<a class="code" href="ksz8851snl_8c.html#aaf7daae0d88c4a4c4e0ba68e83e8e968" title="PHY1 MII-Register Basic Control Register.">P1MBCR</a>));
<a name="l00485"></a>00485   printf(<span class="stringliteral">&quot;P1CR  [0x%02X]=0x%04X\n&quot;</span>, <a class="code" href="ksz8851snl_8c.html#af7ebf99ea562bcdb5735519d2db88e32" title="Port 1 Control Register.">P1CR</a>,   <a class="code" href="group__ksz8851snl.html#gaef8e79d738a8e792ea8335a14e4d80c5" title="Read ethernet controller register.">KSZ8851SNL_SPI_ReadRegister</a>(<a class="code" href="ksz8851snl_8c.html#af7ebf99ea562bcdb5735519d2db88e32" title="Port 1 Control Register.">P1CR</a>));
<a name="l00486"></a>00486   printf(<span class="stringliteral">&quot;#################################################################\n&quot;</span>);
<a name="l00487"></a>00487 }
<a name="l00488"></a>00488 
<a name="l00489"></a>00489 <span class="comment">/**************************************************************************/</span>
<a name="l00492"></a><a class="code" href="group__ksz8851snl.html#ga6a70548f793f9d73e9fbc95bd45378ec">00492</a> <span class="keywordtype">void</span> <a class="code" href="group__ksz8851snl.html#ga6a70548f793f9d73e9fbc95bd45378ec" title="enables the chip interrupts">KSZ8851SNL_IntEnable</a>(<span class="keywordtype">void</span>)
<a name="l00493"></a>00493 {
<a name="l00494"></a>00494   <span class="keywordflow">if</span> (interruptCnt)
<a name="l00495"></a>00495   {
<a name="l00496"></a>00496     interruptCnt--;
<a name="l00497"></a>00497   }
<a name="l00498"></a>00498   <span class="keywordflow">if</span> (interruptCnt == 0)
<a name="l00499"></a>00499   {
<a name="l00500"></a>00500     <span class="comment">/* Enable interrupts */</span>
<a name="l00501"></a>00501     <a class="code" href="group__ksz8851snl.html#ga194769a82e5a1c0ab03ea0923b7da2d0" title="Write ethernet controller register.">KSZ8851SNL_SPI_WriteRegister</a>(<a class="code" href="ksz8851snl_8c.html#a3e27fa35f9febccdc4a0c28a5c8cffbb" title="Interrupt Enable Register.">IER</a>, <a class="code" href="group__ksz8851snl.html#ga922f616d7302ee47828a0ee0b8e0f42b" title="Service RX done, link change and error IRQs.">KSZ8851SNL_INT_ENABLE_MASK</a>);
<a name="l00502"></a>00502   }
<a name="l00503"></a>00503 }
<a name="l00504"></a>00504 
<a name="l00505"></a>00505 <span class="comment">/**************************************************************************/</span>
<a name="l00508"></a><a class="code" href="group__ksz8851snl.html#ga3e64dcfd57de13fdcc6549ab3d476ba7">00508</a> <span class="keywordtype">void</span> <a class="code" href="group__ksz8851snl.html#ga3e64dcfd57de13fdcc6549ab3d476ba7" title="disables the chip interrupts">KSZ8851SNL_IntDisable</a>(<span class="keywordtype">void</span>)
<a name="l00509"></a>00509 {
<a name="l00510"></a>00510   <a class="code" href="group__ksz8851snl.html#ga194769a82e5a1c0ab03ea0923b7da2d0" title="Write ethernet controller register.">KSZ8851SNL_SPI_WriteRegister</a>(<a class="code" href="ksz8851snl_8c.html#a3e27fa35f9febccdc4a0c28a5c8cffbb" title="Interrupt Enable Register.">IER</a>, <a class="code" href="ksz8851snl_8c.html#a359afd6937727dbe8deee27136244dde" title="Used to disable the interupts.">NO_INT</a>);
<a name="l00511"></a>00511   interruptCnt++;
<a name="l00512"></a>00512 }
<a name="l00513"></a>00513 
<a name="l00514"></a>00514 <span class="comment">/**************************************************************************/</span>
<a name="l00521"></a><a class="code" href="group__ksz8851snl.html#ga06b0ac238cdd63e2f652b0a1f694ef55">00521</a> <span class="keywordtype">void</span> <a class="code" href="group__ksz8851snl.html#ga06b0ac238cdd63e2f652b0a1f694ef55" title="Clear interrupt flags.">KSZ8851SNL_IntClear</a>(uint16_t flags)
<a name="l00522"></a>00522 {
<a name="l00523"></a>00523   <a class="code" href="group__ksz8851snl.html#ga194769a82e5a1c0ab03ea0923b7da2d0" title="Write ethernet controller register.">KSZ8851SNL_SPI_WriteRegister</a>(<a class="code" href="ksz8851snl_8c.html#a421ef10418d62e6b65390cb8cdab5c15" title="Interrupt Status Register.">ISR</a>, flags);
<a name="l00524"></a>00524 }
<a name="l00525"></a>00525 
<a name="l00526"></a>00526 <span class="comment">/**************************************************************************/</span>
<a name="l00529"></a><a class="code" href="group__ksz8851snl.html#gafa5ad86862c5b30ba56037da95484999">00529</a> uint16_t <a class="code" href="group__ksz8851snl.html#gafa5ad86862c5b30ba56037da95484999" title="Get interrupt flags.">KSZ8851SNL_IntGet</a>(<span class="keywordtype">void</span>)
<a name="l00530"></a>00530 {
<a name="l00531"></a>00531   <span class="keywordflow">return</span> <a class="code" href="group__ksz8851snl.html#gaef8e79d738a8e792ea8335a14e4d80c5" title="Read ethernet controller register.">KSZ8851SNL_SPI_ReadRegister</a>(<a class="code" href="ksz8851snl_8c.html#a421ef10418d62e6b65390cb8cdab5c15" title="Interrupt Status Register.">ISR</a>);
<a name="l00532"></a>00532 }
<a name="l00533"></a>00533 
<a name="l00534"></a>00534 <span class="comment">/**************************************************************************/</span>
<a name="l00541"></a><a class="code" href="group__ksz8851snl.html#ga81ad6322ce0b536302cc2c442bf0dbab">00541</a> <span class="keywordtype">void</span> <a class="code" href="group__ksz8851snl.html#ga81ad6322ce0b536302cc2c442bf0dbab" title="Clear PMECR (Power Management Event Control Register) flags.">KSZ8851SNL_PMECRStatusClear</a>(uint16_t flags)
<a name="l00542"></a>00542 {
<a name="l00543"></a>00543   uint16_t status = <a class="code" href="group__ksz8851snl.html#gaef8e79d738a8e792ea8335a14e4d80c5" title="Read ethernet controller register.">KSZ8851SNL_SPI_ReadRegister</a>(<a class="code" href="ksz8851snl_8c.html#adeb3a4d09a3fed3e809b1c96c21b4241" title="Power Managment Event Control Register.">PMECR</a>) | flags;
<a name="l00544"></a>00544   <a class="code" href="group__ksz8851snl.html#ga194769a82e5a1c0ab03ea0923b7da2d0" title="Write ethernet controller register.">KSZ8851SNL_SPI_WriteRegister</a>(<a class="code" href="ksz8851snl_8c.html#adeb3a4d09a3fed3e809b1c96c21b4241" title="Power Managment Event Control Register.">PMECR</a>, status);
<a name="l00545"></a>00545 }
<a name="l00546"></a>00546 
<a name="l00547"></a>00547 <span class="comment">/**************************************************************************/</span>
<a name="l00550"></a><a class="code" href="group__ksz8851snl.html#ga85f1d9a0eb9a3f6f39d86aa3b6cc476f">00550</a> uint16_t <a class="code" href="group__ksz8851snl.html#ga85f1d9a0eb9a3f6f39d86aa3b6cc476f" title="Get RXQCR register.">KSZ8851SNL_RXQCRGet</a>(<span class="keywordtype">void</span>)
<a name="l00551"></a>00551 {
<a name="l00552"></a>00552   <span class="keywordflow">return</span> <a class="code" href="group__ksz8851snl.html#gaef8e79d738a8e792ea8335a14e4d80c5" title="Read ethernet controller register.">KSZ8851SNL_SPI_ReadRegister</a>(<a class="code" href="ksz8851snl_8c.html#af5c7dd624af5db2a9d1e5ff08d17d7a1" title="RXQ Command Register.">RXQCR</a>);
<a name="l00553"></a>00553 }
<a name="l00554"></a>00554 
<a name="l00555"></a>00555 <span class="comment">/**************************************************************************/</span>
<a name="l00558"></a><a class="code" href="group__ksz8851snl.html#ga0021d947767d6e2d4cc7872f4d99b6aa">00558</a> <span class="keywordtype">void</span> <a class="code" href="group__ksz8851snl.html#ga0021d947767d6e2d4cc7872f4d99b6aa" title="FrameCounter.">KSZ8851SNL_FrameCounterSet</a>(<span class="keywordtype">void</span>)
<a name="l00559"></a>00559 {
<a name="l00560"></a>00560   <span class="comment">/* Read the frame count and threshold register */</span>
<a name="l00561"></a>00561   uint16_t rxftr = <a class="code" href="group__ksz8851snl.html#gaef8e79d738a8e792ea8335a14e4d80c5" title="Read ethernet controller register.">KSZ8851SNL_SPI_ReadRegister</a>(<a class="code" href="ksz8851snl_8c.html#a3f38906b3f69e1ae69ab71fa624863c0" title="RX Frame Count &amp;amp; Threshold Register.">RXFCTR</a>);
<a name="l00562"></a>00562   <span class="comment">/* Extract the actual number of frames from RX_FRAME_THRES_REG*/</span>
<a name="l00563"></a>00563   rxFrameCount = rxftr &gt;&gt; <a class="code" href="ksz8851snl_8c.html#aebafa824e034291924298c85bc366e0e" title="Used to mark the MSB pos.">MSB_POS</a>;
<a name="l00564"></a>00564 }
<a name="l00565"></a>00565 
<a name="l00566"></a>00566 <span class="comment">/**************************************************************************/</span>
<a name="l00569"></a><a class="code" href="group__ksz8851snl.html#gade8cdaacfa6891944c80bd3e832012dd">00569</a> <span class="keywordtype">void</span> <a class="code" href="group__ksz8851snl.html#gade8cdaacfa6891944c80bd3e832012dd" title="Reset TxQueue.">KSZ8851SNL_TxQueueReset</a>(<span class="keywordtype">void</span>)
<a name="l00570"></a>00570 {
<a name="l00571"></a>00571   uint16_t data;
<a name="l00572"></a>00572 
<a name="l00573"></a>00573   data = <a class="code" href="group__ksz8851snl.html#gaef8e79d738a8e792ea8335a14e4d80c5" title="Read ethernet controller register.">KSZ8851SNL_SPI_ReadRegister</a>(<a class="code" href="ksz8851snl_8c.html#a926b6d1474c9258a92607b9b4272549e" title="Transmit Flow Control Register.">TXCR</a>);
<a name="l00574"></a>00574   <span class="comment">/* Disable TX */</span>
<a name="l00575"></a>00575   data &amp;= ~<a class="code" href="ksz8851snl_8c.html#a4fb198f5122ad90b21a55144fd193adc" title="Enable tranmsit.">TX_FLOW_CTRL_ENABLE</a>;
<a name="l00576"></a>00576   <a class="code" href="group__ksz8851snl.html#ga194769a82e5a1c0ab03ea0923b7da2d0" title="Write ethernet controller register.">KSZ8851SNL_SPI_WriteRegister</a>(<a class="code" href="ksz8851snl_8c.html#a926b6d1474c9258a92607b9b4272549e" title="Transmit Flow Control Register.">TXCR</a>, data);
<a name="l00577"></a>00577   <span class="comment">/* Flush */</span>
<a name="l00578"></a>00578   data |= <a class="code" href="ksz8851snl_8c.html#a834364c5d577e607cd80192eb19610ac" title="Flush Transmit Queue.">TX_FLOW_CTRL_FLUSH_QUEUE</a>;
<a name="l00579"></a>00579   <a class="code" href="group__ksz8851snl.html#ga194769a82e5a1c0ab03ea0923b7da2d0" title="Write ethernet controller register.">KSZ8851SNL_SPI_WriteRegister</a>(<a class="code" href="ksz8851snl_8c.html#a926b6d1474c9258a92607b9b4272549e" title="Transmit Flow Control Register.">TXCR</a>, data);
<a name="l00580"></a>00580   <span class="comment">/* normal op - no flush */</span>
<a name="l00581"></a>00581   data &amp;= ~<a class="code" href="ksz8851snl_8c.html#a834364c5d577e607cd80192eb19610ac" title="Flush Transmit Queue.">TX_FLOW_CTRL_FLUSH_QUEUE</a>;
<a name="l00582"></a>00582   <a class="code" href="group__ksz8851snl.html#ga194769a82e5a1c0ab03ea0923b7da2d0" title="Write ethernet controller register.">KSZ8851SNL_SPI_WriteRegister</a>(<a class="code" href="ksz8851snl_8c.html#a926b6d1474c9258a92607b9b4272549e" title="Transmit Flow Control Register.">TXCR</a>, data);
<a name="l00583"></a>00583   <span class="comment">/* Enable TX */</span>
<a name="l00584"></a>00584   data |= <a class="code" href="ksz8851snl_8c.html#a4fb198f5122ad90b21a55144fd193adc" title="Enable tranmsit.">TX_FLOW_CTRL_ENABLE</a>;
<a name="l00585"></a>00585   <a class="code" href="group__ksz8851snl.html#ga194769a82e5a1c0ab03ea0923b7da2d0" title="Write ethernet controller register.">KSZ8851SNL_SPI_WriteRegister</a>(<a class="code" href="ksz8851snl_8c.html#a926b6d1474c9258a92607b9b4272549e" title="Transmit Flow Control Register.">TXCR</a>, data);
<a name="l00586"></a>00586 }
<a name="l00587"></a>00587 
<a name="l00588"></a>00588 <span class="comment">/**************************************************************************/</span>
<a name="l00591"></a><a class="code" href="group__ksz8851snl.html#ga4c087f2e3d625db1c02e65c73f4839f3">00591</a> <span class="keywordtype">void</span> <a class="code" href="group__ksz8851snl.html#ga4c087f2e3d625db1c02e65c73f4839f3" title="Reset RxQueue.">KSZ8851SNL_RxQueueReset</a>(<span class="keywordtype">void</span>)
<a name="l00592"></a>00592 {
<a name="l00593"></a>00593   uint16_t data;
<a name="l00594"></a>00594 
<a name="l00595"></a>00595   data = <a class="code" href="group__ksz8851snl.html#gaef8e79d738a8e792ea8335a14e4d80c5" title="Read ethernet controller register.">KSZ8851SNL_SPI_ReadRegister</a>(<a class="code" href="ksz8851snl_8c.html#a3f311ff23775b0dd05baeafa58bbaa22" title="Receive Flow Control Register 1.">RXCR1</a>);
<a name="l00596"></a>00596   <span class="comment">/* Disable RX */</span>
<a name="l00597"></a>00597   data &amp;= ~<a class="code" href="ksz8851snl_8c.html#a35f925972a31fa513b3d50ede32091b5" title="Enable receive.">RX_FLOW_CTRL_RX_ENABLE</a>;
<a name="l00598"></a>00598   <a class="code" href="group__ksz8851snl.html#ga194769a82e5a1c0ab03ea0923b7da2d0" title="Write ethernet controller register.">KSZ8851SNL_SPI_WriteRegister</a>(<a class="code" href="ksz8851snl_8c.html#a3f311ff23775b0dd05baeafa58bbaa22" title="Receive Flow Control Register 1.">RXCR1</a>, data);
<a name="l00599"></a>00599   <span class="comment">/* Flush */</span>
<a name="l00600"></a>00600   <a class="code" href="group__ksz8851snl.html#ga194769a82e5a1c0ab03ea0923b7da2d0" title="Write ethernet controller register.">KSZ8851SNL_SPI_WriteRegister</a>(<a class="code" href="ksz8851snl_8c.html#a3f311ff23775b0dd05baeafa58bbaa22" title="Receive Flow Control Register 1.">RXCR1</a>, data);
<a name="l00601"></a>00601   <span class="comment">/* Clear flush */</span>
<a name="l00602"></a>00602   data &amp;= ~<a class="code" href="ksz8851snl_8c.html#ab4afc07a6c37d2cd2713f5f4098579e6" title="Flush Receive Queue.">RX_FLOW_CTRL_FLUSH_QUEUE</a>;
<a name="l00603"></a>00603   <a class="code" href="group__ksz8851snl.html#ga194769a82e5a1c0ab03ea0923b7da2d0" title="Write ethernet controller register.">KSZ8851SNL_SPI_WriteRegister</a>(<a class="code" href="ksz8851snl_8c.html#a3f311ff23775b0dd05baeafa58bbaa22" title="Receive Flow Control Register 1.">RXCR1</a>, data);
<a name="l00604"></a>00604   <span class="comment">/* Write default config with enable set */</span>
<a name="l00605"></a>00605   data |= <a class="code" href="ksz8851snl_8c.html#a35f925972a31fa513b3d50ede32091b5" title="Enable receive.">RX_FLOW_CTRL_RX_ENABLE</a>;
<a name="l00606"></a>00606   <a class="code" href="group__ksz8851snl.html#ga194769a82e5a1c0ab03ea0923b7da2d0" title="Write ethernet controller register.">KSZ8851SNL_SPI_WriteRegister</a>(<a class="code" href="ksz8851snl_8c.html#a3f311ff23775b0dd05baeafa58bbaa22" title="Receive Flow Control Register 1.">RXCR1</a>, data);
<a name="l00607"></a>00607 }
<a name="l00608"></a>00608 
<a name="l00609"></a>00609 <span class="comment">/**************************************************************************/</span>
<a name="l00612"></a><a class="code" href="group__ksz8851snl.html#ga02611fd180208feb00a4f1fbab7115dc">00612</a> uint16_t <a class="code" href="group__ksz8851snl.html#ga02611fd180208feb00a4f1fbab7115dc" title="FrameCounter.">KSZ8851SNL_FrameCounterGet</a>(<span class="keywordtype">void</span>)
<a name="l00613"></a>00613 {
<a name="l00614"></a>00614   <span class="keywordflow">return</span> rxFrameCount;
<a name="l00615"></a>00615 }
<a name="l00616"></a>00616 
<a name="l00617"></a>00617 <span class="comment">/***************************************************************************/</span>
<a name="l00620"></a><a class="code" href="group__ksz8851snl.html#ga414381cd961a77b97b9e17970ba43e7a">00620</a> <span class="keywordtype">void</span> <a class="code" href="group__ksz8851snl.html#ga414381cd961a77b97b9e17970ba43e7a" title="Initialize the registers of the ethernet controller.">KSZ8851SNL_Init</a>(<span class="keywordtype">void</span>)
<a name="l00621"></a>00621 {
<a name="l00622"></a>00622   uint16_t data;
<a name="l00623"></a>00623 
<a name="l00624"></a>00624   <span class="comment">/* Initialize SPI Interface */</span>
<a name="l00625"></a>00625   <a class="code" href="group__ksz8851snl.html#ga12cf356cb196dbc44230f7ad5aa16742" title="KSZ8851SNL_SPI_Init Initialize SPI interface to Ethernet controller.">KSZ8851SNL_SPI_Init</a>();
<a name="l00626"></a>00626 
<a name="l00627"></a>00627   <span class="comment">/* Reset PHY module */</span>
<a name="l00628"></a>00628   <a class="code" href="group__ksz8851snl.html#ga194769a82e5a1c0ab03ea0923b7da2d0" title="Write ethernet controller register.">KSZ8851SNL_SPI_WriteRegister</a>(<a class="code" href="ksz8851snl_8c.html#a899443e7d74043411fea3eee7d9de9f6" title="PHY Reset Register.">PHYRR</a>, <a class="code" href="ksz8851snl_8c.html#a6f5048620b3dde8583f7f1118e9de187" title="PHY Reset Register Options.">PHY_RESET</a>);
<a name="l00629"></a>00629 
<a name="l00630"></a>00630   <span class="comment">/* Reset Soft (clear registers of PHY, MAC, QMU, DMA) */</span>
<a name="l00631"></a>00631   data = <a class="code" href="group__ksz8851snl.html#gaef8e79d738a8e792ea8335a14e4d80c5" title="Read ethernet controller register.">KSZ8851SNL_SPI_ReadRegister</a>(<a class="code" href="ksz8851snl_8c.html#a092b1852ba2fbba0bcdd216f3f641b49" title="Global Reset Register.">GRR</a>);
<a name="l00632"></a>00632   data &amp;= ~<a class="code" href="ksz8851snl_8c.html#a4286160ca194bc8850c7fc9013fe3779" title="Global reset.">GLOBAL_SOFT_RESET</a>;
<a name="l00633"></a>00633   <a class="code" href="group__ksz8851snl.html#ga194769a82e5a1c0ab03ea0923b7da2d0" title="Write ethernet controller register.">KSZ8851SNL_SPI_WriteRegister</a>(<a class="code" href="ksz8851snl_8c.html#a092b1852ba2fbba0bcdd216f3f641b49" title="Global Reset Register.">GRR</a>, data);
<a name="l00634"></a>00634 
<a name="l00635"></a>00635   <span class="comment">/* Reset Soft (clear registers of PHY, MAC, QMU, DMA) */</span>
<a name="l00636"></a>00636   data = <a class="code" href="group__ksz8851snl.html#gaef8e79d738a8e792ea8335a14e4d80c5" title="Read ethernet controller register.">KSZ8851SNL_SPI_ReadRegister</a>(<a class="code" href="ksz8851snl_8c.html#a092b1852ba2fbba0bcdd216f3f641b49" title="Global Reset Register.">GRR</a>);
<a name="l00637"></a>00637   data &amp;= ~<a class="code" href="ksz8851snl_8c.html#a4286160ca194bc8850c7fc9013fe3779" title="Global reset.">GLOBAL_SOFT_RESET</a>;
<a name="l00638"></a>00638   <a class="code" href="group__ksz8851snl.html#ga194769a82e5a1c0ab03ea0923b7da2d0" title="Write ethernet controller register.">KSZ8851SNL_SPI_WriteRegister</a>(<a class="code" href="ksz8851snl_8c.html#a092b1852ba2fbba0bcdd216f3f641b49" title="Global Reset Register.">GRR</a>, data);
<a name="l00639"></a>00639 
<a name="l00640"></a>00640   <span class="comment">/* Read the chip ID and check if that is correct */</span>
<a name="l00641"></a>00641   data = <a class="code" href="group__ksz8851snl.html#gaef8e79d738a8e792ea8335a14e4d80c5" title="Read ethernet controller register.">KSZ8851SNL_SPI_ReadRegister</a>(<a class="code" href="ksz8851snl_8c.html#a586a7f4e18d53f3c99321c82a7c8cbcf" title="Chip ID and Enable Register.">CIDER</a>);
<a name="l00642"></a>00642 
<a name="l00643"></a>00643   <span class="comment">/* The CIDER lower bits [3..1] are defined as revision number,</span>
<a name="l00644"></a>00644 <span class="comment">   *   thus a mask needs to be applied</span>
<a name="l00645"></a>00645 <span class="comment">   */</span>
<a name="l00646"></a>00646 
<a name="l00647"></a>00647   <span class="comment">/* this is a hard assert - abort  */</span>
<a name="l00648"></a>00648   EFM_ASSERT((data &amp; <a class="code" href="ksz8851snl_8c.html#a71ef81afb42a9b3dc69b8efb67ba08cc" title="Used to mask the revision ID.">CHIP_ID_MASK</a>) == <a class="code" href="ksz8851snl_8c.html#a67a9f9d1d59c17889c587973b758890c" title="Default Chip ID for KSZ8851SNL.">KSZ8851SNL_CHIP_ID</a>);
<a name="l00649"></a>00649 
<a name="l00650"></a>00650   <span class="comment">/* Write the Queue Management Unit MAC Address */</span>
<a name="l00651"></a>00651   <a class="code" href="group__ksz8851snl.html#ga628b9c6f6df5bebe5d5cb1317d4b3f7b" title="Get the MAC address of the current board.">KSZ8851SNL_MacAddressGet</a>(macAddress);
<a name="l00652"></a>00652   <span class="comment">/* Write the MAC Address into the MAC registers */</span>
<a name="l00653"></a>00653   <a class="code" href="group__ksz8851snl.html#ga194769a82e5a1c0ab03ea0923b7da2d0" title="Write ethernet controller register.">KSZ8851SNL_SPI_WriteRegister</a>(<a class="code" href="ksz8851snl_8c.html#a328ffd91c6ae67b14aad42bcf1aa8927" title="MAC Address High.">MARH</a>, (macAddress[0] &lt;&lt; 8) | macAddress[1]);
<a name="l00654"></a>00654   <a class="code" href="group__ksz8851snl.html#ga194769a82e5a1c0ab03ea0923b7da2d0" title="Write ethernet controller register.">KSZ8851SNL_SPI_WriteRegister</a>(<a class="code" href="ksz8851snl_8c.html#a53b0bd1eebb93c5d26d4ee73a6928140" title="MAC Address Middle.">MARM</a>, (macAddress[2] &lt;&lt; 8) | macAddress[3]);
<a name="l00655"></a>00655   <a class="code" href="group__ksz8851snl.html#ga194769a82e5a1c0ab03ea0923b7da2d0" title="Write ethernet controller register.">KSZ8851SNL_SPI_WriteRegister</a>(<a class="code" href="ksz8851snl_8c.html#aec33aabaaae5da6e6c4dca64d286a5e5" title="MAC Address Low.">MARL</a>, (macAddress[4] &lt;&lt; 8) | macAddress[5]);
<a name="l00656"></a>00656 
<a name="l00657"></a>00657   <span class="comment">/* Enable QMU Transmit Frame Data Pointer Auto Increment */</span>
<a name="l00658"></a>00658   <a class="code" href="group__ksz8851snl.html#ga194769a82e5a1c0ab03ea0923b7da2d0" title="Write ethernet controller register.">KSZ8851SNL_SPI_WriteRegister</a>(<a class="code" href="ksz8851snl_8c.html#a62ea34f447f8a5b2f10e3cd18e2e33c9" title="TX Frame Data Pointer Register.">TXFDPR</a>, <a class="code" href="ksz8851snl_8c.html#a56cdd36751f5a5ba51247720848a46ae" title="Used to reset the FD pointer.">FD_PTR_AUTO_INC</a>);
<a name="l00659"></a>00659 
<a name="l00660"></a>00660   <span class="comment">/* Enable QMU Transmit:</span>
<a name="l00661"></a>00661 <span class="comment">   *  flow control,</span>
<a name="l00662"></a>00662 <span class="comment">   *  padding,</span>
<a name="l00663"></a>00663 <span class="comment">   *  CRC,</span>
<a name="l00664"></a>00664 <span class="comment">   *  checksum generation.</span>
<a name="l00665"></a>00665 <span class="comment">   */</span>
<a name="l00666"></a>00666   <a class="code" href="group__ksz8851snl.html#ga194769a82e5a1c0ab03ea0923b7da2d0" title="Write ethernet controller register.">KSZ8851SNL_SPI_WriteRegister</a>(<a class="code" href="ksz8851snl_8c.html#a926b6d1474c9258a92607b9b4272549e" title="Transmit Flow Control Register.">TXCR</a>, <a class="code" href="ksz8851snl_8c.html#ac95b594e03b020184d53ee1285ff2d0d" title="TX FLOW CONTROL Initialization collection.">TX_FLOW_CTRL_CONFIG</a>);
<a name="l00667"></a>00667 
<a name="l00668"></a>00668   <span class="comment">/* Enable QMU Receive Frame Data Pointer Auto Increment */</span>
<a name="l00669"></a>00669   <a class="code" href="group__ksz8851snl.html#ga194769a82e5a1c0ab03ea0923b7da2d0" title="Write ethernet controller register.">KSZ8851SNL_SPI_WriteRegister</a>(<a class="code" href="ksz8851snl_8c.html#a30336f6509570d09b6a6ef1309499c99" title="RX Frame Data Pointer Register.">RXFDPR</a>, <a class="code" href="ksz8851snl_8c.html#a56cdd36751f5a5ba51247720848a46ae" title="Used to reset the FD pointer.">FD_PTR_AUTO_INC</a>);
<a name="l00670"></a>00670 
<a name="l00671"></a>00671   <span class="comment">/* Configure Receive Frame Threshold for one frame */</span>
<a name="l00672"></a>00672   <a class="code" href="group__ksz8851snl.html#ga194769a82e5a1c0ab03ea0923b7da2d0" title="Write ethernet controller register.">KSZ8851SNL_SPI_WriteRegister</a>(<a class="code" href="ksz8851snl_8c.html#a3f38906b3f69e1ae69ab71fa624863c0" title="RX Frame Count &amp;amp; Threshold Register.">RXFCTR</a>, <a class="code" href="ksz8851snl_8c.html#a82b54c052386458402cbcb4ca95d17db" title="Receive Frame Count Threshold to use in RXFCTR.">FRAME_COUNT_THRESHOLD</a>);
<a name="l00673"></a>00673 
<a name="l00674"></a>00674   <span class="comment">/* Set RX queue low watermark to 10240 bytes for issuing of</span>
<a name="l00675"></a>00675 <span class="comment">     stop PAUSE frames (flow control) */</span>
<a name="l00676"></a>00676   data = 0xA00;
<a name="l00677"></a>00677   <a class="code" href="group__ksz8851snl.html#ga194769a82e5a1c0ab03ea0923b7da2d0" title="Write ethernet controller register.">KSZ8851SNL_SPI_WriteRegister</a>(<a class="code" href="ksz8851snl_8c.html#ab514abc673ae547a70d89508dba74072" title="Configure Low Watermark to 6KByte.">FCLWR</a>, data);
<a name="l00678"></a>00678 
<a name="l00679"></a>00679   <span class="comment">/* Enable QMU Receive:</span>
<a name="l00680"></a>00680 <span class="comment">   *  flow control,</span>
<a name="l00681"></a>00681 <span class="comment">   *  receive all broadcast frame,</span>
<a name="l00682"></a>00682 <span class="comment">   *  receive unicast frame,</span>
<a name="l00683"></a>00683 <span class="comment">   *  IP/TCP/UDP/ICMP checksum generation.</span>
<a name="l00684"></a>00684 <span class="comment">   */</span>
<a name="l00685"></a>00685   <a class="code" href="group__ksz8851snl.html#ga194769a82e5a1c0ab03ea0923b7da2d0" title="Write ethernet controller register.">KSZ8851SNL_SPI_WriteRegister</a>(<a class="code" href="ksz8851snl_8c.html#a3f311ff23775b0dd05baeafa58bbaa22" title="Receive Flow Control Register 1.">RXCR1</a>, <a class="code" href="ksz8851snl_8c.html#ad43736a9aeccb0eb58620770717fd71d" title="RX FLOW CONTROL1 Initialization collection.">RX_FLOW_CTRL1_CONFIG</a>);
<a name="l00686"></a>00686 
<a name="l00687"></a>00687   <span class="comment">/* Enable QMU Receive:</span>
<a name="l00688"></a>00688 <span class="comment">   *  ICMP/UDP Lite frame checksum verification,</span>
<a name="l00689"></a>00689 <span class="comment">   *  UDP Lite frame checksum generation,</span>
<a name="l00690"></a>00690 <span class="comment">   *  IPv6 UDP fragment frame pass.</span>
<a name="l00691"></a>00691 <span class="comment">   */</span>
<a name="l00692"></a>00692   <a class="code" href="group__ksz8851snl.html#ga194769a82e5a1c0ab03ea0923b7da2d0" title="Write ethernet controller register.">KSZ8851SNL_SPI_WriteRegister</a>(<a class="code" href="ksz8851snl_8c.html#a610096e926ba4386c101f42eb51f83ed" title="Receive Flow Control Register 2.">RXCR2</a>, <a class="code" href="ksz8851snl_8c.html#a0bde5dcaa753e8253fb4fd81acd640ec" title="RX FLOW CONTROL2 Initialization collection.">RX_FLOW_CTRL2_CONFIG</a>);
<a name="l00693"></a>00693 
<a name="l00694"></a>00694   <span class="comment">/* Enable QMU Receive:</span>
<a name="l00695"></a>00695 <span class="comment">   *  IP Header Two-Byte Offset,</span>
<a name="l00696"></a>00696 <span class="comment">   *  Receive Frame Count Threshold,</span>
<a name="l00697"></a>00697 <span class="comment">   *  RXQ Auto-Dequeue frame.</span>
<a name="l00698"></a>00698 <span class="comment">   */</span>
<a name="l00699"></a>00699   <a class="code" href="group__ksz8851snl.html#ga194769a82e5a1c0ab03ea0923b7da2d0" title="Write ethernet controller register.">KSZ8851SNL_SPI_WriteRegister</a>(<a class="code" href="ksz8851snl_8c.html#af5c7dd624af5db2a9d1e5ff08d17d7a1" title="RXQ Command Register.">RXQCR</a>, <a class="code" href="ksz8851snl_8c.html#a2b2622989bd3fa193103abae8004d3b3" title="RX COMMAND Initialization collection.">RXQ_CMD_CONFIG</a>);
<a name="l00700"></a>00700 
<a name="l00701"></a>00701   <span class="comment">/* Restart Port 1 auto-negotiation */</span>
<a name="l00702"></a>00702   <a class="code" href="group__ksz8851snl.html#ga194769a82e5a1c0ab03ea0923b7da2d0" title="Write ethernet controller register.">KSZ8851SNL_SPI_WriteRegister</a>(<a class="code" href="ksz8851snl_8c.html#af7ebf99ea562bcdb5735519d2db88e32" title="Port 1 Control Register.">P1CR</a>, <a class="code" href="ksz8851snl_8c.html#a85f46f7c9891dd763ceb189d580ebe03" title="PHY Port default config P1CR.">PORT1_CONFIG</a> | <a class="code" href="ksz8851snl_8c.html#afefbc2ee026e2c62da2f3540a11d943d" title="Restart auto-negotiation.">PORT1_AUTO_NEG_RESTART</a>);
<a name="l00703"></a>00703 
<a name="l00704"></a>00704   <span class="comment">/* Clear interrupts */</span>
<a name="l00705"></a>00705   <a class="code" href="group__ksz8851snl.html#ga194769a82e5a1c0ab03ea0923b7da2d0" title="Write ethernet controller register.">KSZ8851SNL_SPI_WriteRegister</a>(<a class="code" href="ksz8851snl_8c.html#a421ef10418d62e6b65390cb8cdab5c15" title="Interrupt Status Register.">ISR</a>, <a class="code" href="ksz8851snl_8c.html#ac83b32831e0638f88b91366948124c04" title="Used to clear INT_STATUS_REG.">CLEAR_INT</a>);
<a name="l00706"></a>00706 }
<a name="l00707"></a>00707 
<a name="l00708"></a>00708 
<a name="l00709"></a>00709 <span class="comment">/***************************************************************************/</span>
<a name="l00712"></a><a class="code" href="group__ksz8851snl.html#ga1fc05f812bbd153f2cd82042b7398e67">00712</a> <span class="keywordtype">void</span> <a class="code" href="group__ksz8851snl.html#ga1fc05f812bbd153f2cd82042b7398e67" title="Enable RX and TX.">KSZ8851SNL_Enable</a>(<span class="keywordtype">void</span>)
<a name="l00713"></a>00713 {
<a name="l00714"></a>00714   uint16_t data;
<a name="l00715"></a>00715 
<a name="l00716"></a>00716   <a class="code" href="group__ksz8851snl.html#ga194769a82e5a1c0ab03ea0923b7da2d0" title="Write ethernet controller register.">KSZ8851SNL_SPI_WriteRegister</a>(<a class="code" href="ksz8851snl_8c.html#a3e27fa35f9febccdc4a0c28a5c8cffbb" title="Interrupt Enable Register.">IER</a>, <a class="code" href="group__ksz8851snl.html#ga922f616d7302ee47828a0ee0b8e0f42b" title="Service RX done, link change and error IRQs.">KSZ8851SNL_INT_ENABLE_MASK</a>);
<a name="l00717"></a>00717 
<a name="l00718"></a>00718   <span class="comment">/* Enable QMU Transmit */</span>
<a name="l00719"></a>00719   data  = <a class="code" href="group__ksz8851snl.html#gaef8e79d738a8e792ea8335a14e4d80c5" title="Read ethernet controller register.">KSZ8851SNL_SPI_ReadRegister</a>(<a class="code" href="ksz8851snl_8c.html#a926b6d1474c9258a92607b9b4272549e" title="Transmit Flow Control Register.">TXCR</a>);
<a name="l00720"></a>00720   data |= <a class="code" href="ksz8851snl_8c.html#a4fb198f5122ad90b21a55144fd193adc" title="Enable tranmsit.">TX_FLOW_CTRL_ENABLE</a>;
<a name="l00721"></a>00721   <a class="code" href="group__ksz8851snl.html#ga194769a82e5a1c0ab03ea0923b7da2d0" title="Write ethernet controller register.">KSZ8851SNL_SPI_WriteRegister</a>(<a class="code" href="ksz8851snl_8c.html#a926b6d1474c9258a92607b9b4272549e" title="Transmit Flow Control Register.">TXCR</a>, data);
<a name="l00722"></a>00722 
<a name="l00723"></a>00723   <span class="comment">/* Enable QMU Receive */</span>
<a name="l00724"></a>00724   data  = <a class="code" href="group__ksz8851snl.html#gaef8e79d738a8e792ea8335a14e4d80c5" title="Read ethernet controller register.">KSZ8851SNL_SPI_ReadRegister</a>(<a class="code" href="ksz8851snl_8c.html#a3f311ff23775b0dd05baeafa58bbaa22" title="Receive Flow Control Register 1.">RXCR1</a>);
<a name="l00725"></a>00725   data |= <a class="code" href="ksz8851snl_8c.html#a35f925972a31fa513b3d50ede32091b5" title="Enable receive.">RX_FLOW_CTRL_RX_ENABLE</a>;
<a name="l00726"></a>00726   <a class="code" href="group__ksz8851snl.html#ga194769a82e5a1c0ab03ea0923b7da2d0" title="Write ethernet controller register.">KSZ8851SNL_SPI_WriteRegister</a>(<a class="code" href="ksz8851snl_8c.html#a3f311ff23775b0dd05baeafa58bbaa22" title="Receive Flow Control Register 1.">RXCR1</a>, data);
<a name="l00727"></a>00727 }
<a name="l00728"></a>00728 
<a name="l00729"></a>00729 
<a name="l00730"></a>00730 <span class="comment">/***************************************************************************/</span>
<a name="l00737"></a><a class="code" href="group__ksz8851snl.html#ga31c3be356bee9c4f14f9e5255c87c21c">00737</a> <span class="keywordtype">bool</span> <a class="code" href="group__ksz8851snl.html#ga31c3be356bee9c4f14f9e5255c87c21c" title="Prepares for a transmission of an ethernet frame over the network.">KSZ8851SNL_TransmitBegin</a>(uint16_t length)
<a name="l00738"></a>00738 {
<a name="l00739"></a>00739   uint16_t txmir;
<a name="l00740"></a>00740   uint16_t data, reqSize;
<a name="l00741"></a>00741   uint8_t  outbuf[4];
<a name="l00742"></a>00742 
<a name="l00743"></a>00743   <span class="comment">/* Wait for previous frame to finish before setting up a new one */</span>
<a name="l00744"></a>00744   <span class="keywordflow">while</span> (<a class="code" href="group__ksz8851snl.html#gaef8e79d738a8e792ea8335a14e4d80c5" title="Read ethernet controller register.">KSZ8851SNL_SPI_ReadRegister</a>(<a class="code" href="ksz8851snl_8c.html#a272d3d63d93ee08337f48780bf95f9db" title="TXQ Command Register.">TXQCR</a>) &amp; <a class="code" href="ksz8851snl_8c.html#a56ad1b68495eb52699727a5e1fd29da5" title="Enable Manual Engueue TXQ Frame.">TXQ_ENQUEUE</a>)
<a name="l00745"></a>00745   {
<a name="l00746"></a>00746     ;
<a name="l00747"></a>00747   }
<a name="l00748"></a>00748 
<a name="l00749"></a>00749   <span class="comment">/* Make sure there is room for</span>
<a name="l00750"></a>00750 <span class="comment">   *</span>
<a name="l00751"></a>00751 <span class="comment">   * 4 bytes Control Word</span>
<a name="l00752"></a>00752 <span class="comment">   * 4 bytes Byte Count</span>
<a name="l00753"></a>00753 <span class="comment">   * n bytes Packet</span>
<a name="l00754"></a>00754 <span class="comment">   * 4 bytes CRC</span>
<a name="l00755"></a>00755 <span class="comment">   */</span>
<a name="l00756"></a>00756   reqSize = length + 12;
<a name="l00757"></a>00757   txmir = <a class="code" href="group__ksz8851snl.html#gaef8e79d738a8e792ea8335a14e4d80c5" title="Read ethernet controller register.">KSZ8851SNL_SPI_ReadRegister</a>(<a class="code" href="ksz8851snl_8c.html#afce935acdb1eb7756aeb45bddb6ffbcd" title="TXQ Memory Information Register.">TXMIR</a>) &amp; <a class="code" href="ksz8851snl_8c.html#ad53a856610ae8f92071467aa1d9f0215" title="Used to mask the reserved bits.">TX_MEM_AVAIL_MASK</a>;
<a name="l00758"></a>00758   LWIP_DEBUGF(NETIF_DEBUG, (<span class="stringliteral">&quot;KSZ8851SNL_LongTransmitInit: txmir =%hu  reqSize = %hu \n&quot;</span>, txmir, reqSize));
<a name="l00759"></a>00759 
<a name="l00760"></a>00760   <span class="keywordflow">if</span> (txmir &lt; reqSize)
<a name="l00761"></a>00761   {
<a name="l00762"></a>00762     <span class="comment">/* TXQ is out of memory */</span>
<a name="l00763"></a>00763     LWIP_DEBUGF(NETIF_DEBUG | LWIP_DBG_LEVEL_WARNING, (<span class="stringliteral">&quot;Not enough TXQ Memory, available=%u required=%u\n&quot;</span>, txmir, reqSize));
<a name="l00764"></a>00764     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00765"></a>00765   }
<a name="l00766"></a>00766 
<a name="l00767"></a>00767   LWIP_DEBUGF(NETIF_DEBUG, (<span class="stringliteral">&quot;KSZ8851SNL_LongTransmitInit: Memory available &gt;  txmir =%hu  reqSize = %hu \n&quot;</span>, txmir, reqSize));
<a name="l00768"></a>00768   <span class="comment">/* Enable TXQ write access */</span>
<a name="l00769"></a>00769   data = <a class="code" href="group__ksz8851snl.html#gaef8e79d738a8e792ea8335a14e4d80c5" title="Read ethernet controller register.">KSZ8851SNL_SPI_ReadRegister</a>(<a class="code" href="ksz8851snl_8c.html#af5c7dd624af5db2a9d1e5ff08d17d7a1" title="RXQ Command Register.">RXQCR</a>) | <a class="code" href="ksz8851snl_8c.html#a22c8cae8de31b0afd6b5eb78080c4d4f" title="Start QMU transfer operation.">RXQ_START_DMA</a>;
<a name="l00770"></a>00770   <a class="code" href="group__ksz8851snl.html#ga194769a82e5a1c0ab03ea0923b7da2d0" title="Write ethernet controller register.">KSZ8851SNL_SPI_WriteRegister</a>(<a class="code" href="ksz8851snl_8c.html#af5c7dd624af5db2a9d1e5ff08d17d7a1" title="RXQ Command Register.">RXQCR</a>, data);
<a name="l00771"></a>00771 
<a name="l00772"></a>00772   <span class="comment">/* Write frame ID, control word and byte count */</span>
<a name="l00773"></a>00773   outbuf[0] = (frameId++ &amp; <a class="code" href="ksz8851snl_8c.html#a8908b96fed6ae4dd395a7a1b4126606d" title="Used to mask the reserved bits.">FRAME_ID_MASK</a>);
<a name="l00774"></a>00774   outbuf[1] = 0x80; <span class="comment">/*  TX_INT_on_COMPLETION */</span>
<a name="l00775"></a>00775   outbuf[2] = length &amp; <a class="code" href="ksz8851snl_8c.html#a338d54179ac0da2af2363e3a930bf374" title="Used to mask the LSB.">LSB_MASK</a>;
<a name="l00776"></a>00776   outbuf[3] = length &gt;&gt; <a class="code" href="ksz8851snl_8c.html#aebafa824e034291924298c85bc366e0e" title="Used to mark the MSB pos.">MSB_POS</a>;
<a name="l00777"></a>00777 
<a name="l00778"></a>00778   <span class="comment">/* Start the SPI Transfer and send frame header */</span>
<a name="l00779"></a>00779   <a class="code" href="group__ksz8851snl.html#ga06d01a766dd38a09f6cb657bf778b385" title="Start writing to the ethernet controller FIFO.">KSZ8851SNL_SPI_WriteFifoBegin</a>();
<a name="l00780"></a>00780   <a class="code" href="group__ksz8851snl.html#ga8bf407a2b072a222c5053b39963ed165" title="Continue writing ethernet controller FIFO.">KSZ8851SNL_SPI_WriteFifo</a>(4, outbuf);
<a name="l00781"></a>00781 
<a name="l00782"></a>00782   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00783"></a>00783 }
<a name="l00784"></a>00784 
<a name="l00785"></a>00785 
<a name="l00786"></a>00786 <span class="comment">/***************************************************************************/</span>
<a name="l00801"></a><a class="code" href="group__ksz8851snl.html#ga62488dd5f992f4a6965e0fb0a0cf1134">00801</a> <span class="keywordtype">void</span> <a class="code" href="group__ksz8851snl.html#ga62488dd5f992f4a6965e0fb0a0cf1134" title="Transmit a chunk of data to the ethernet controller.">KSZ8851SNL_Transmit</a>(uint16_t length, <span class="keyword">const</span> uint8_t *buffer)
<a name="l00802"></a>00802 {
<a name="l00803"></a>00803   EFM_ASSERT(buffer != NULL);
<a name="l00804"></a>00804   <a class="code" href="group__ksz8851snl.html#ga8bf407a2b072a222c5053b39963ed165" title="Continue writing ethernet controller FIFO.">KSZ8851SNL_SPI_WriteFifo</a>(length, buffer);
<a name="l00805"></a>00805 }
<a name="l00806"></a>00806 
<a name="l00807"></a>00807 <span class="comment">/***************************************************************************/</span>
<a name="l00819"></a><a class="code" href="group__ksz8851snl.html#ga4e4ea2904a2346dbe35d1ecffb3aa8ca">00819</a> <span class="keywordtype">void</span> <a class="code" href="group__ksz8851snl.html#ga4e4ea2904a2346dbe35d1ecffb3aa8ca" title="Ends a transmission of an ethernet frame to the ethernet controller.">KSZ8851SNL_TransmitEnd</a>(uint16_t length)
<a name="l00820"></a>00820 {
<a name="l00821"></a>00821   uint16_t data;
<a name="l00822"></a>00822   uint16_t padding;
<a name="l00823"></a>00823   uint8_t dummy[4] = {0x00};
<a name="l00824"></a>00824 
<a name="l00825"></a>00825   <span class="comment">/* Padding packet to 4 byte boundary */</span>
<a name="l00826"></a>00826   <span class="keywordflow">if</span> (length % 4)
<a name="l00827"></a>00827   {
<a name="l00828"></a>00828     padding = 4 - (length % 4);
<a name="l00829"></a>00829     <a class="code" href="group__ksz8851snl.html#ga8bf407a2b072a222c5053b39963ed165" title="Continue writing ethernet controller FIFO.">KSZ8851SNL_SPI_WriteFifo</a>(padding, dummy);
<a name="l00830"></a>00830   }
<a name="l00831"></a>00831 
<a name="l00832"></a>00832   <span class="comment">/* Stop the SPI Transfer */</span>
<a name="l00833"></a>00833   <a class="code" href="group__ksz8851snl.html#ga3102136a87269f6531366fca103c06f7" title="Stop read/write the ethernet controller FIFO.">KSZ8851SNL_SPI_WriteFifoEnd</a>();
<a name="l00834"></a>00834 
<a name="l00835"></a>00835   <span class="comment">/* Disable TXQ write access */</span>
<a name="l00836"></a>00836   data = <a class="code" href="group__ksz8851snl.html#gaef8e79d738a8e792ea8335a14e4d80c5" title="Read ethernet controller register.">KSZ8851SNL_SPI_ReadRegister</a>(<a class="code" href="ksz8851snl_8c.html#af5c7dd624af5db2a9d1e5ff08d17d7a1" title="RXQ Command Register.">RXQCR</a>) &amp; (~<a class="code" href="ksz8851snl_8c.html#a22c8cae8de31b0afd6b5eb78080c4d4f" title="Start QMU transfer operation.">RXQ_START_DMA</a>);
<a name="l00837"></a>00837   <a class="code" href="group__ksz8851snl.html#ga194769a82e5a1c0ab03ea0923b7da2d0" title="Write ethernet controller register.">KSZ8851SNL_SPI_WriteRegister</a>(<a class="code" href="ksz8851snl_8c.html#af5c7dd624af5db2a9d1e5ff08d17d7a1" title="RXQ Command Register.">RXQCR</a>, data);
<a name="l00838"></a>00838 
<a name="l00839"></a>00839   <span class="comment">/* Start TXQ Manual enqueue */</span>
<a name="l00840"></a>00840   data = <a class="code" href="group__ksz8851snl.html#gaef8e79d738a8e792ea8335a14e4d80c5" title="Read ethernet controller register.">KSZ8851SNL_SPI_ReadRegister</a>(<a class="code" href="ksz8851snl_8c.html#a272d3d63d93ee08337f48780bf95f9db" title="TXQ Command Register.">TXQCR</a>) | <a class="code" href="ksz8851snl_8c.html#a56ad1b68495eb52699727a5e1fd29da5" title="Enable Manual Engueue TXQ Frame.">TXQ_ENQUEUE</a>;
<a name="l00841"></a>00841   <a class="code" href="group__ksz8851snl.html#ga194769a82e5a1c0ab03ea0923b7da2d0" title="Write ethernet controller register.">KSZ8851SNL_SPI_WriteRegister</a>(<a class="code" href="ksz8851snl_8c.html#a272d3d63d93ee08337f48780bf95f9db" title="TXQ Command Register.">TXQCR</a>, data);
<a name="l00842"></a>00842 }
<a name="l00843"></a>00843 
<a name="l00844"></a>00844 <span class="comment">/***************************************************************************/</span>
<a name="l00848"></a><a class="code" href="ksz8851snl_8c.html#a1893ae2fdc832fc747a3f297c6b17d5c">00848</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="ksz8851snl_8c.html#a1893ae2fdc832fc747a3f297c6b17d5c" title="Release the current frame if it is inconsistent.">ReleaseIncosistentFrame</a>(<span class="keywordtype">void</span>)
<a name="l00849"></a>00849 {
<a name="l00850"></a>00850   uint16_t data;
<a name="l00851"></a>00851   <span class="comment">/* Issue the Release error frame command */</span>
<a name="l00852"></a>00852   data = <a class="code" href="group__ksz8851snl.html#gaef8e79d738a8e792ea8335a14e4d80c5" title="Read ethernet controller register.">KSZ8851SNL_SPI_ReadRegister</a>(<a class="code" href="ksz8851snl_8c.html#af5c7dd624af5db2a9d1e5ff08d17d7a1" title="RXQ Command Register.">RXQCR</a>) | <a class="code" href="ksz8851snl_8c.html#adf331f33bb045dc73bbdd2aca446d3b1" title="Release RX Error Frame.">RXQ_RELEASE_ERROR_FRAME</a>;
<a name="l00853"></a>00853   <a class="code" href="group__ksz8851snl.html#ga194769a82e5a1c0ab03ea0923b7da2d0" title="Write ethernet controller register.">KSZ8851SNL_SPI_WriteRegister</a>(<a class="code" href="ksz8851snl_8c.html#af5c7dd624af5db2a9d1e5ff08d17d7a1" title="RXQ Command Register.">RXQCR</a>, data);
<a name="l00854"></a>00854 
<a name="l00855"></a>00855   <span class="comment">/* Wait for PHY to clear the command/flag */</span>
<a name="l00856"></a>00856   <span class="keywordflow">while</span> (<a class="code" href="group__ksz8851snl.html#gaef8e79d738a8e792ea8335a14e4d80c5" title="Read ethernet controller register.">KSZ8851SNL_SPI_ReadRegister</a>(<a class="code" href="ksz8851snl_8c.html#af5c7dd624af5db2a9d1e5ff08d17d7a1" title="RXQ Command Register.">RXQCR</a>) &amp; <a class="code" href="ksz8851snl_8c.html#adf331f33bb045dc73bbdd2aca446d3b1" title="Release RX Error Frame.">RXQ_RELEASE_ERROR_FRAME</a>)
<a name="l00857"></a>00857   {
<a name="l00858"></a>00858     ;
<a name="l00859"></a>00859   }
<a name="l00860"></a>00860 }
<a name="l00861"></a>00861 
<a name="l00862"></a>00862 <span class="comment">/***************************************************************************/</span>
<a name="l00875"></a><a class="code" href="group__ksz8851snl.html#gad49a596fbc706123a1aa477f14cdf3b4">00875</a> uint16_t <a class="code" href="group__ksz8851snl.html#gad49a596fbc706123a1aa477f14cdf3b4" title="Performs the actual receive of a raw frame over the network.">KSZ8851SNL_Receive</a>(uint16_t length, uint8_t *buffer)
<a name="l00876"></a>00876 {
<a name="l00877"></a>00877   uint16_t data;
<a name="l00878"></a>00878   uint16_t rxStatus;
<a name="l00879"></a>00879   uint16_t rxPacketLength;
<a name="l00880"></a>00880   uint16_t frameLength;
<a name="l00881"></a>00881   uint16_t bytesToRead;
<a name="l00882"></a>00882 
<a name="l00883"></a>00883   EFM_ASSERT(buffer != NULL);
<a name="l00884"></a>00884 
<a name="l00885"></a>00885   <span class="keywordflow">while</span> (rxFrameCount &gt; 0)
<a name="l00886"></a>00886   {
<a name="l00887"></a>00887     rxFrameCount--;
<a name="l00888"></a>00888     <span class="comment">/* Read the received frame status */</span>
<a name="l00889"></a>00889     rxStatus = <a class="code" href="group__ksz8851snl.html#gaef8e79d738a8e792ea8335a14e4d80c5" title="Read ethernet controller register.">KSZ8851SNL_SPI_ReadRegister</a>(<a class="code" href="ksz8851snl_8c.html#a30e9e4c89c87aa77f0168cec82474b8c" title="Receive Frame Header Status Register.">RXFHSR</a>);
<a name="l00890"></a>00890 
<a name="l00891"></a>00891     <span class="comment">/* Check the consistency of the frame */</span>
<a name="l00892"></a>00892     <span class="keywordflow">if</span> ((!(rxStatus &amp; <a class="code" href="ksz8851snl_8c.html#aeaa8fab8c4bb775b6dd1fc7532911f25" title="RXFV Receive Frame Valid of the RXFHSR register.">VALID_FRAME_MASK</a>)) || (rxStatus &amp; <a class="code" href="ksz8851snl_8c.html#a028895fdab77c4dd8aca7a34aaaf38e9" title="CRC OK for ICMP, IP, TCP, UDP MII error Frame too long error.">CHECKSUM_VALID_FRAME_MASK</a>))
<a name="l00893"></a>00893     {
<a name="l00894"></a>00894       <span class="comment">/* Issue the Release error frame command */</span>
<a name="l00895"></a>00895       <a class="code" href="ksz8851snl_8c.html#a1893ae2fdc832fc747a3f297c6b17d5c" title="Release the current frame if it is inconsistent.">ReleaseIncosistentFrame</a>();
<a name="l00896"></a>00896       <span class="comment">/* continue to next frame */</span>
<a name="l00897"></a>00897       <span class="keywordflow">continue</span>;
<a name="l00898"></a>00898     }
<a name="l00899"></a>00899     <span class="keywordflow">else</span>
<a name="l00900"></a>00900     {
<a name="l00901"></a>00901       <span class="comment">/* Read the byte size of the received frame */</span>
<a name="l00902"></a>00902       rxPacketLength = <a class="code" href="group__ksz8851snl.html#gaef8e79d738a8e792ea8335a14e4d80c5" title="Read ethernet controller register.">KSZ8851SNL_SPI_ReadRegister</a>(<a class="code" href="ksz8851snl_8c.html#a0b47780f1c7a35ea8af1f91738af073f" title="Receive Frame Header Bytecount Register.">RXFHBCR</a>) &amp; <a class="code" href="ksz8851snl_8c.html#a60cd22a6881b225ea028f8bc1a0e0783" title="Used to mask the reserved bits.">RX_BYTE_CNT_MASK</a>;
<a name="l00903"></a>00903 
<a name="l00904"></a>00904       <span class="comment">/* round to dword boundary */</span>
<a name="l00905"></a>00905       bytesToRead = 4 * ((rxPacketLength + 3) &gt;&gt; 2);
<a name="l00906"></a>00906       LWIP_DEBUGF(NETIF_DEBUG, (<span class="stringliteral">&quot;KSZ8851SNL_Receive: rxPacketLength=%u, bytesToRead=%u \n&quot;</span>, rxPacketLength, bytesToRead));
<a name="l00907"></a>00907       <span class="keywordflow">if</span> ((bytesToRead &gt; length) || (rxPacketLength &lt;= 4))
<a name="l00908"></a>00908       {
<a name="l00909"></a>00909         <span class="comment">/* Issue the Release error frame command */</span>
<a name="l00910"></a>00910         <a class="code" href="ksz8851snl_8c.html#a1893ae2fdc832fc747a3f297c6b17d5c" title="Release the current frame if it is inconsistent.">ReleaseIncosistentFrame</a>();
<a name="l00911"></a>00911         <span class="comment">/* continue to next frame */</span>
<a name="l00912"></a>00912         <span class="keywordflow">continue</span>;
<a name="l00913"></a>00913       }
<a name="l00914"></a>00914 
<a name="l00915"></a>00915       <span class="comment">/* Set QMU RXQ frame pointer to start of packet data. Note</span>
<a name="l00916"></a>00916 <span class="comment">       * that we skip the status word and byte count since we</span>
<a name="l00917"></a>00917 <span class="comment">       * already know this from RXFHSR and RXFHBCR.</span>
<a name="l00918"></a>00918 <span class="comment">       */</span>
<a name="l00919"></a>00919       <a class="code" href="group__ksz8851snl.html#ga194769a82e5a1c0ab03ea0923b7da2d0" title="Write ethernet controller register.">KSZ8851SNL_SPI_WriteRegister</a>(<a class="code" href="ksz8851snl_8c.html#a30336f6509570d09b6a6ef1309499c99" title="RX Frame Data Pointer Register.">RXFDPR</a>, 0x0004 | <a class="code" href="ksz8851snl_8c.html#a56cdd36751f5a5ba51247720848a46ae" title="Used to reset the FD pointer.">FD_PTR_AUTO_INC</a>);
<a name="l00920"></a>00920 
<a name="l00921"></a>00921       <span class="comment">/* Start QMU DMA transfer */</span>
<a name="l00922"></a>00922       data = <a class="code" href="group__ksz8851snl.html#gaef8e79d738a8e792ea8335a14e4d80c5" title="Read ethernet controller register.">KSZ8851SNL_SPI_ReadRegister</a>(<a class="code" href="ksz8851snl_8c.html#af5c7dd624af5db2a9d1e5ff08d17d7a1" title="RXQ Command Register.">RXQCR</a>) | <a class="code" href="ksz8851snl_8c.html#a22c8cae8de31b0afd6b5eb78080c4d4f" title="Start QMU transfer operation.">RXQ_START_DMA</a>;
<a name="l00923"></a>00923       <a class="code" href="group__ksz8851snl.html#ga194769a82e5a1c0ab03ea0923b7da2d0" title="Write ethernet controller register.">KSZ8851SNL_SPI_WriteRegister</a>(<a class="code" href="ksz8851snl_8c.html#af5c7dd624af5db2a9d1e5ff08d17d7a1" title="RXQ Command Register.">RXQCR</a>, data);
<a name="l00924"></a>00924 
<a name="l00925"></a>00925       <span class="comment">/* Read the whole ethernet frame */</span>
<a name="l00926"></a>00926       <a class="code" href="group__ksz8851snl.html#ga3eda0b4b00ab2ec0a7c265329587cc88" title="Read data from the ethernet controller RX FIFO.">KSZ8851SNL_SPI_ReadFifo</a>(bytesToRead, buffer);
<a name="l00927"></a>00927 
<a name="l00928"></a>00928       <span class="comment">/* Stop QMU DMA transfer */</span>
<a name="l00929"></a>00929       data = <a class="code" href="group__ksz8851snl.html#gaef8e79d738a8e792ea8335a14e4d80c5" title="Read ethernet controller register.">KSZ8851SNL_SPI_ReadRegister</a>(<a class="code" href="ksz8851snl_8c.html#af5c7dd624af5db2a9d1e5ff08d17d7a1" title="RXQ Command Register.">RXQCR</a>) &amp; (~<a class="code" href="ksz8851snl_8c.html#a22c8cae8de31b0afd6b5eb78080c4d4f" title="Start QMU transfer operation.">RXQ_START_DMA</a>);
<a name="l00930"></a>00930       <a class="code" href="group__ksz8851snl.html#ga194769a82e5a1c0ab03ea0923b7da2d0" title="Write ethernet controller register.">KSZ8851SNL_SPI_WriteRegister</a>(<a class="code" href="ksz8851snl_8c.html#af5c7dd624af5db2a9d1e5ff08d17d7a1" title="RXQ Command Register.">RXQCR</a>, data);
<a name="l00931"></a>00931 
<a name="l00932"></a>00932       <span class="comment">/* Return frame length without CRC */</span>
<a name="l00933"></a>00933       frameLength = rxPacketLength - 4;
<a name="l00934"></a>00934       <span class="keywordflow">return</span> frameLength;
<a name="l00935"></a>00935     }
<a name="l00936"></a>00936   }
<a name="l00937"></a>00937   <span class="keywordflow">return</span> 0;
<a name="l00938"></a>00938 }
<a name="l00939"></a>00939 
<a name="l00940"></a>00940 <span class="comment">/***************************************************************************/</span>
<a name="l00950"></a><a class="code" href="group__ksz8851snl.html#ga628b9c6f6df5bebe5d5cb1317d4b3f7b">00950</a> <span class="keywordtype">void</span> <a class="code" href="group__ksz8851snl.html#ga628b9c6f6df5bebe5d5cb1317d4b3f7b" title="Get the MAC address of the current board.">KSZ8851SNL_MacAddressGet</a>(uint8_t *macAddress)
<a name="l00951"></a>00951 {
<a name="l00952"></a>00952   <span class="keywordtype">int</span> i;
<a name="l00953"></a>00953 
<a name="l00954"></a>00954   EFM_ASSERT(macAddress != NULL);
<a name="l00955"></a>00955 
<a name="l00956"></a>00956   <span class="comment">/* set the first 3 bytes given by the EM MAC Address space */</span>
<a name="l00957"></a>00957   macAddress[0] = <a class="code" href="ksz8851snl_8c.html#ae3b1a19388873dd5c03e63feecff9c14" title="1st segment of the MAC address">HIGH_QMU_MAC_H</a>;
<a name="l00958"></a>00958   macAddress[1] = <a class="code" href="ksz8851snl_8c.html#a8aa3036cea0079ddc98c874ffbd24125" title="2nd segment of the MAC address">HIGH_QMU_MAC_L</a>;
<a name="l00959"></a>00959   macAddress[2] = <a class="code" href="ksz8851snl_8c.html#aa5a2ce4eeabfe5f74d047bcfece64724" title="3rd segment of the MAC address">MID_QMU_MAC_H</a>;
<a name="l00960"></a>00960   <span class="comment">/* set the next 3 bytes given by the CMU unique ID */</span>
<a name="l00961"></a>00961 
<a name="l00962"></a>00962   <span class="keywordflow">for</span> (i = 0; i &lt; 3; i++)
<a name="l00963"></a>00963   {
<a name="l00964"></a>00964     macAddress[5 - i] = (DEVINFO-&gt;UNIQUEL &amp; (BYTE_MASK &lt;&lt; i * BYTE_SIZE)) &gt;&gt; i * <a class="code" href="ksz8851snl_8c.html#a86fd4404b140711fdb77326609c0f393" title="Used to mark the MSB pos.">BYTE_SIZE</a>;
<a name="l00965"></a>00965   }
<a name="l00966"></a>00966 }
<a name="l00967"></a>00967 
<a name="l00968"></a>00968 <span class="comment">/***************************************************************************/</span>
<a name="l00971"></a><a class="code" href="group__ksz8851snl.html#ga6e245d5e6c11c9880c438f088120e8ce">00971</a> uint16_t <a class="code" href="group__ksz8851snl.html#ga6e245d5e6c11c9880c438f088120e8ce" title="Get the PHY status.">KSZ8851SNL_PHYStatusGet</a>(<span class="keywordtype">void</span>)
<a name="l00972"></a>00972 {
<a name="l00973"></a>00973   <span class="keywordflow">return</span> <a class="code" href="group__ksz8851snl.html#gaef8e79d738a8e792ea8335a14e4d80c5" title="Read ethernet controller register.">KSZ8851SNL_SPI_ReadRegister</a>(<a class="code" href="ksz8851snl_8c.html#ab84f41b2f2b735bec6b04abab49be0dd" title="Port 1 Status Register.">P1SR</a>);
<a name="l00974"></a>00974 }
</pre></div></div>
<div id="footer">
<hr size="1"><address style="text-align: right;"><small>
Generated on Mon Sep 7 09:26:01 2015</small> for Board Support Package by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a><small> 1.6.3 </small></address></div>
</body>
</html>
