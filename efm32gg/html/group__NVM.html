<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>EFM32 Giant Gecko Software Documentation: NVM</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">EFM32 Giant Gecko Software Documentation
   &#160;<span id="projectnumber">efm32gg-doc-4.3.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="../../index.html"><span>Documentation&#160;Home</span></a></li>
      <li><a href="http://www.silabs.com"><span>silabs.com</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__NVM.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">NVM<div class="ingroups"><a class="el" href="group__emdrv.html">EMDRV</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>NVM Non-volatile Memory Wear-Leveling driver </p><pre class="fragment"></pre><p>. </p>
<ul>
<li><a class="el" href="group__NVM.html#nvm_intro">Introduction</a> </li>
<li><a class="el" href="group__NVM.html#nvm_conf">Configuration Options</a> </li>
<li><a class="el" href="group__NVM.html#nvm_api">The API</a> </li>
<li><a class="el" href="group__NVM.html#nvm_example">Example</a></li>
</ul>
<p><br />
 </p>
<h1><a class="anchor" id="nvm_intro"></a>
Introduction</h1>
<p>This driver allows you to store application data in NVM. The driver supports wear leveling to maximize the lifetime of the underlying NVM system. CCITT CRC16 is used for data validation.</p>
<p>The size and layout of the data objects to be managed by this driver must be known at compile-time. Object may be composed of any primitive data type (8, 16 or 32-bit).</p>
<p>This driver consists of the files <a class="el" href="nvm_8c.html" title="Non-Volatile Memory Wear-Leveling driver API implementation. ">nvm.c</a>, <a class="el" href="nvm_8h.html" title="Non-Volatile Memory Wear-Leveling driver API. ">nvm.h</a> and <a class="el" href="nvm__hal_8h.html" title="Non-Volatile Memory Wear-Leveling driver HAL. ">nvm_hal.h</a>. Additionally, a implementation of <a class="el" href="nvm__hal_8c.html" title="Non-Volatile Memory Wear-Leveling driver HAL implementation. ">nvm_hal.c</a> is required for the specific NVM system to be used. A implementation of <a class="el" href="nvm__hal_8c.html" title="Non-Volatile Memory Wear-Leveling driver HAL implementation. ">nvm_hal.c</a> for EFM32/EZR32/EFR32 Flash memory is included with this driver. Driver configuration parameters and specification of the data objects are located in nvm_config.c and nvm_config.h.</p>
<p><br />
 </p>
<h1><a class="anchor" id="nvm_conf"></a>
Configuration Options</h1>
<p>The files nvm_config.c and nvm_config.h contains compile-time configuration parameters and a specification of the user data structures to be managed by the driver, and how these are mapped to pages. A page can be of type normal or wear. A wear page can only contain a single object, but they provide better performance and drastically increase the lifetime of the memory if the object is known to have a low update frequency.</p>
<p>nvm_config.c implements an user data example. The arrays colorTable, coefficientTable, etc are defined and assigned to NVM pages. A pointer to each page is assigned to the page table nvmPages. The page table also contain a page type specifier. A page is either of type nvmPageTypeNormal or nvmPageTypeWear. Pages of type nvmPageTypeNormal are written to the unused page with the lowest erase count. For pages of type nvmPageTypeWear, the data is first attempted fitted in a already used page. If this fails, then a a new page is selected based on the lowest erase count. Pages of type nvmPageTypeWear can only contain one data object.</p>
<p>In nvm_config.h, driver features can be enabled or disabled. The following parameters may require special attention:</p>
<ul>
<li>NVM_MAX_NUMBER_OF_PAGES: Maximum number of NVM pages allocated to the driver.</li>
<li>NVM_PAGES_SCRATCH: Configure extra pages to allocate for data security and wear leveling.</li>
<li>NVM_PAGE_SIZE: Page size for the NVM system. Default is the size of the flash.</li>
</ul>
<p>Users have to be aware of the following limitations:</p><ul>
<li>Maximum 254 objects in a page.</li>
<li>Maximum 256 pages allocated to the driver. The default is 32 pages.</li>
</ul>
<p>Note that the different EFM32/EZR32/EFR32 families have different page sizes. Please refer to the reference manual for details.</p>
<p><br />
 </p>
<h1><a class="anchor" id="nvm_api"></a>
The API</h1>
<p>This section contain brief descriptions of the functions defined by the API. You will find detailed information on input and output parameters and return values by clicking on the hyperlinked function names. Most functions return an error code or ECODE_EMDRV_NVM_OK is returned on success. See <a class="el" href="ecode_8h.html" title="Energy Aware drivers error code definitions. ">ecode.h</a> and <a class="el" href="nvm_8h.html" title="Non-Volatile Memory Wear-Leveling driver API. ">nvm.h</a> for other error codes.</p>
<p>Your application code must include one header file: <a class="el" href="nvm_8h.html" title="Non-Volatile Memory Wear-Leveling driver API. ">nvm.h</a>.</p>
<p>The application may define the data objects allocated in RAM (and defined in nvm_config.c) as extern if direct access to these objects is required, eg:</p>
<pre class="fragment">  extern uint32_t colorTable[];</pre><p>The driver requires that the NVM system is erased by calling <a class="el" href="group__NVM.html#ga6cad1505838978506c7d94f9a1472595">NVM_Erase()</a> before the driver initialization function <a class="el" href="group__NVM.html#gaf74bb05f10ed4959e65e85fa438ead67">NVM_Init()</a> is called. <a class="el" href="group__NVM.html#gaf74bb05f10ed4959e65e85fa438ead67">NVM_Init()</a> requires a parameter to the configuration data. A pointer to the configuration data can be obtained by calling NVM_ConfigGet().</p>
<p><a class="el" href="group__NVM.html#gad181be9b434658d3552fb311039ff691">NVM_Write()</a> takes two parameters, a page ID and a object ID. These two parameters must correspond to the definition of the user data in nvm_config.c. For example, colorTable is assigned to page 1 in the example version of nvm_config.c. To write the data in colorTable to NVM, call NVM_Write(MY_PAGE_1, COLOR_TABLE_ID).</p>
<p><a class="el" href="group__NVM.html#ga34880829bee50bf0fde0f6c9695dca86">NVM_Read()</a> reads the a data object or an entire page in NVM back to the structures defined for the page in RAM.</p>
<p><br />
 </p>
<h1><a class="anchor" id="nvm_example"></a>
Example</h1>
<pre class="fragment">  #include "em_chip.h"
  #include "em_gpio.h"
  #include "nvm.h"

  // Data object extern declarations matching the example data defined in nvm_config.c
  extern uint32_t colorTable[];
  extern uint8_t coefficientTable[];
  extern uint8_t primeNumberTable[];
  extern uint16_t bonusTable[];
  extern uint8_t privateKeyTable[];
  extern uint16_t transformTable[];
  extern int32_t safetyTable[];
  extern uint8_t bigEmptyTable[450];
  extern int8_t smallNegativeTable[];
  extern uint16_t shortPositiveTable[];
  extern uint32_t singleVariable;

  // Object and page IDs maching the data defined in nvm_config.c
  typedef enum
  {
    COLOR_TABLE_ID,
    COEFFICIENT_TABLE_ID,
    PRIME_NUMBER_TABLE_ID,
    BONUS_TABLE_ID,
    PRIVATE_KEY_TABLE_ID,
    TRANSFORM_TABLE_ID,
    SINGLE_VARIABLE_ID,
    SAFETY_TABLE_ID,
    BIG_EMPTY_TABLE_ID,
    SMALL_NEGATIVE_TABLE_ID,
    SHORT_POSITIVE_TABLE_ID
  } NVM_Object_Ids;

  typedef enum
  {
    MY_PAGE_1,
    MY_PAGE_2,
    MY_PAGE_3,
    MY_PAGE_4,
    MY_PAGE_5,
    MY_PAGE_6,
  } NVM_Page_Ids;

  CHIP_Init();

  // Erase all pages managed by the driver and set the erase count
  // for each page to 0. To retain the erase count, pass NVM_ERASE_RETAINCOUNT.
  NVM_Erase(0);

  if (ECODE_EMDRV_NVM_NO_PAGES_AVAILABLE == NVM_Init(NVM_ConfigGet())
  {
    // The driver could not initialize any pages
  }

  // Write all pages to NVM
  NVM_Write(MY_PAGE_1, NVM_WRITE_ALL_CMD));
  NVM_Write(MY_PAGE_2, NVM_WRITE_ALL_CMD));
  NVM_Write(MY_PAGE_3, NVM_WRITE_ALL_CMD));
  NVM_Write(MY_PAGE_4, NVM_WRITE_ALL_CMD));
  NVM_Write(MY_PAGE_5, NVM_WRITE_ALL_CMD));
  NVM_Write(MY_PAGE_6, NVM_WRITE_ALL_CMD));

  // Set some data elements to 0
  for (i = 0; i &lt; 4; i++)
  {
    bonusTable[i] = 0;
    primeNumberTable[i] = 0;
  }

  // Read back from NVM and check
  NVM_Read(MY_PAGE_1, NVM_READ_ALL_CMD));
  NVM_Read(MY_PAGE_4, PRIME_NUMBER_TABLE_ID));

  for (i = 0; i &lt; 4; i++)
  {
    if (bonusTable[i] == 0)
    {
      // Should not happen because bonusTable[] in NVM should contain the
      // constants set in nvm_config.c
    }
    if (primeNumberTable[i] == 0)
    {
      // Should not happen because primeNumberTable[] in NVM should contain the
      // constants set in nvm_config.c
    }
  }</pre> <table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:gacb8a7f9574d3b638baa9975a1d2d525b"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="gacb8a7f9574d3b638baa9975a1d2d525b"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__NVM.html#gacb8a7f9574d3b638baa9975a1d2d525b">ECODE_EMDRV_NVM_ADDR_INVALID</a>&#160;&#160;&#160;( <a class="el" href="group__emdrv.html#ga7e8592ecd56d0333b6e9904cc62909c6">ECODE_EMDRV_SPIDRV_BASE</a> | 0x00000001 )</td></tr>
<tr class="memdesc:gacb8a7f9574d3b638baa9975a1d2d525b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Invalid address. <br /></td></tr>
<tr class="separator:gacb8a7f9574d3b638baa9975a1d2d525b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaae4e262fa99ff77f50f342100567e579"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="gaae4e262fa99ff77f50f342100567e579"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__NVM.html#gaae4e262fa99ff77f50f342100567e579">ECODE_EMDRV_NVM_ALIGNMENT_INVALID</a>&#160;&#160;&#160;( <a class="el" href="group__emdrv.html#ga7e8592ecd56d0333b6e9904cc62909c6">ECODE_EMDRV_SPIDRV_BASE</a> | 0x00000002 )</td></tr>
<tr class="memdesc:gaae4e262fa99ff77f50f342100567e579"><td class="mdescLeft">&#160;</td><td class="mdescRight">Invalid data alignment. <br /></td></tr>
<tr class="separator:gaae4e262fa99ff77f50f342100567e579"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga513abf6d9830442da42feae5d3aa3793"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga513abf6d9830442da42feae5d3aa3793"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__NVM.html#ga513abf6d9830442da42feae5d3aa3793">ECODE_EMDRV_NVM_DATA_INVALID</a>&#160;&#160;&#160;( <a class="el" href="group__emdrv.html#ga7e8592ecd56d0333b6e9904cc62909c6">ECODE_EMDRV_SPIDRV_BASE</a> | 0x00000003 )</td></tr>
<tr class="memdesc:ga513abf6d9830442da42feae5d3aa3793"><td class="mdescLeft">&#160;</td><td class="mdescRight">Invalid input data or format. <br /></td></tr>
<tr class="separator:ga513abf6d9830442da42feae5d3aa3793"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gad67929c11d6b7520bf992dc6dcfc4d2c"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="gad67929c11d6b7520bf992dc6dcfc4d2c"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__NVM.html#gad67929c11d6b7520bf992dc6dcfc4d2c">ECODE_EMDRV_NVM_ERROR</a>&#160;&#160;&#160;( <a class="el" href="group__emdrv.html#ga7e8592ecd56d0333b6e9904cc62909c6">ECODE_EMDRV_SPIDRV_BASE</a> | 0x00000007 )</td></tr>
<tr class="memdesc:gad67929c11d6b7520bf992dc6dcfc4d2c"><td class="mdescLeft">&#160;</td><td class="mdescRight">General error. <br /></td></tr>
<tr class="separator:gad67929c11d6b7520bf992dc6dcfc4d2c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga2345b10d783d735ed6be169a918ec991"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga2345b10d783d735ed6be169a918ec991"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__NVM.html#ga2345b10d783d735ed6be169a918ec991">ECODE_EMDRV_NVM_NO_PAGES_AVAILABLE</a>&#160;&#160;&#160;( <a class="el" href="group__emdrv.html#ga7e8592ecd56d0333b6e9904cc62909c6">ECODE_EMDRV_SPIDRV_BASE</a> | 0x00000005 )</td></tr>
<tr class="memdesc:ga2345b10d783d735ed6be169a918ec991"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialization didn't find any pages available to allocate. <br /></td></tr>
<tr class="separator:ga2345b10d783d735ed6be169a918ec991"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae332cf766a19b67f1ed35c9d9e95bd20"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__NVM.html#gae332cf766a19b67f1ed35c9d9e95bd20">ECODE_EMDRV_NVM_OK</a>&#160;&#160;&#160;( <a class="el" href="group__emdrv.html#gad59417e7951d81dfc15ec2757f08148e">ECODE_OK</a> )</td></tr>
<tr class="memdesc:gae332cf766a19b67f1ed35c9d9e95bd20"><td class="mdescLeft">&#160;</td><td class="mdescRight">Success return value.  <a href="#gae332cf766a19b67f1ed35c9d9e95bd20">More...</a><br /></td></tr>
<tr class="separator:gae332cf766a19b67f1ed35c9d9e95bd20"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga6ea441c3105ea4a18a10a3b042bd7d86"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga6ea441c3105ea4a18a10a3b042bd7d86"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__NVM.html#ga6ea441c3105ea4a18a10a3b042bd7d86">ECODE_EMDRV_NVM_PAGE_INVALID</a>&#160;&#160;&#160;( <a class="el" href="group__emdrv.html#ga7e8592ecd56d0333b6e9904cc62909c6">ECODE_EMDRV_SPIDRV_BASE</a> | 0x00000006 )</td></tr>
<tr class="memdesc:ga6ea441c3105ea4a18a10a3b042bd7d86"><td class="mdescLeft">&#160;</td><td class="mdescRight">Could not find the page specified. <br /></td></tr>
<tr class="separator:ga6ea441c3105ea4a18a10a3b042bd7d86"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga903849e2678082db4030a0f553ea508a"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga903849e2678082db4030a0f553ea508a"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__NVM.html#ga903849e2678082db4030a0f553ea508a">ECODE_EMDRV_NVM_WRITE_LOCK</a>&#160;&#160;&#160;( <a class="el" href="group__emdrv.html#ga7e8592ecd56d0333b6e9904cc62909c6">ECODE_EMDRV_SPIDRV_BASE</a> | 0x00000004 )</td></tr>
<tr class="memdesc:ga903849e2678082db4030a0f553ea508a"><td class="mdescLeft">&#160;</td><td class="mdescRight">A write is currently in progress. <br /></td></tr>
<tr class="separator:ga903849e2678082db4030a0f553ea508a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaddbc995da5f67dc3b176213f32008a62"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__NVM.html#gaddbc995da5f67dc3b176213f32008a62">NVM_ERASE_RETAINCOUNT</a>&#160;&#160;&#160;0xffffffffUL</td></tr>
<tr class="separator:gaddbc995da5f67dc3b176213f32008a62"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gabdbe94a8a506bb943ed440adf4c3c0c6"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__NVM.html#gabdbe94a8a506bb943ed440adf4c3c0c6">NVM_PAGE_TERMINATION</a>&#160;&#160;&#160;{ NULL, 0, (NVM_Object_Ids) 0 }</td></tr>
<tr class="separator:gabdbe94a8a506bb943ed440adf4c3c0c6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaf237b8d940d372ccbd82b8998fbc8f60"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__NVM.html#gaf237b8d940d372ccbd82b8998fbc8f60">NVM_READ_ALL_CMD</a>&#160;&#160;&#160;0xff</td></tr>
<tr class="separator:gaf237b8d940d372ccbd82b8998fbc8f60"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga69ca4a7805f154f9e3b65bf2a42c8037"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__NVM.html#ga69ca4a7805f154f9e3b65bf2a42c8037">NVM_WRITE_ALL_CMD</a>&#160;&#160;&#160;0xff</td></tr>
<tr class="separator:ga69ca4a7805f154f9e3b65bf2a42c8037"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gac2786ac8b0b1ae7ae7dd2ee028cc97c7"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__NVM.html#gac2786ac8b0b1ae7ae7dd2ee028cc97c7">NVM_WRITE_NONE_CMD</a>&#160;&#160;&#160;0xfe</td></tr>
<tr class="separator:gac2786ac8b0b1ae7ae7dd2ee028cc97c7"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga6cad1505838978506c7d94f9a1472595"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__emdrv.html#ga7bf5621660c5ba69ac4dd3044173d35c">Ecode_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__NVM.html#ga6cad1505838978506c7d94f9a1472595">NVM_Erase</a> (uint32_t eraseCount)</td></tr>
<tr class="memdesc:ga6cad1505838978506c7d94f9a1472595"><td class="mdescLeft">&#160;</td><td class="mdescRight">Erase the entire allocated NVM area.  <a href="#ga6cad1505838978506c7d94f9a1472595">More...</a><br /></td></tr>
<tr class="separator:ga6cad1505838978506c7d94f9a1472595"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaf74bb05f10ed4959e65e85fa438ead67"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__emdrv.html#ga7bf5621660c5ba69ac4dd3044173d35c">Ecode_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__NVM.html#gaf74bb05f10ed4959e65e85fa438ead67">NVM_Init</a> (NVM_Config_t const *nvmConfig)</td></tr>
<tr class="memdesc:gaf74bb05f10ed4959e65e85fa438ead67"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize the NVM manager.  <a href="#gaf74bb05f10ed4959e65e85fa438ead67">More...</a><br /></td></tr>
<tr class="separator:gaf74bb05f10ed4959e65e85fa438ead67"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga34880829bee50bf0fde0f6c9695dca86"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__emdrv.html#ga7bf5621660c5ba69ac4dd3044173d35c">Ecode_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__NVM.html#ga34880829bee50bf0fde0f6c9695dca86">NVM_Read</a> (uint16_t pageId, uint8_t objectId)</td></tr>
<tr class="memdesc:ga34880829bee50bf0fde0f6c9695dca86"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read an object or an entire page.  <a href="#ga34880829bee50bf0fde0f6c9695dca86">More...</a><br /></td></tr>
<tr class="separator:ga34880829bee50bf0fde0f6c9695dca86"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gad181be9b434658d3552fb311039ff691"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__emdrv.html#ga7bf5621660c5ba69ac4dd3044173d35c">Ecode_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__NVM.html#gad181be9b434658d3552fb311039ff691">NVM_Write</a> (uint16_t pageId, uint8_t objectId)</td></tr>
<tr class="memdesc:gad181be9b434658d3552fb311039ff691"><td class="mdescLeft">&#160;</td><td class="mdescRight">Write an object or a page.  <a href="#gad181be9b434658d3552fb311039ff691">More...</a><br /></td></tr>
<tr class="separator:gad181be9b434658d3552fb311039ff691"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="gae332cf766a19b67f1ed35c9d9e95bd20"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ECODE_EMDRV_NVM_OK&#160;&#160;&#160;( <a class="el" href="group__emdrv.html#gad59417e7951d81dfc15ec2757f08148e">ECODE_OK</a> )</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Success return value. </p>
<p>Return/error codes </p>

<p>Definition at line <a class="el" href="nvm_8h_source.html#l00046">46</a> of file <a class="el" href="nvm_8h_source.html">nvm.h</a>.</p>

<p>Referenced by <a class="el" href="group__NVM.html#ga6cad1505838978506c7d94f9a1472595">NVM_Erase()</a>, <a class="el" href="group__NVM.html#gaf74bb05f10ed4959e65e85fa438ead67">NVM_Init()</a>, <a class="el" href="group__NVM.html#ga34880829bee50bf0fde0f6c9695dca86">NVM_Read()</a>, and <a class="el" href="group__NVM.html#gad181be9b434658d3552fb311039ff691">NVM_Write()</a>.</p>

</div>
</div>
<a class="anchor" id="gaddbc995da5f67dc3b176213f32008a62"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define NVM_ERASE_RETAINCOUNT&#160;&#160;&#160;0xffffffffUL</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Retains the registered erase count when eraseing a page. </p>

<p>Definition at line <a class="el" href="nvm_8h_source.html#l00063">63</a> of file <a class="el" href="nvm_8h_source.html">nvm.h</a>.</p>

<p>Referenced by <a class="el" href="group__NVM.html#ga6cad1505838978506c7d94f9a1472595">NVM_Erase()</a>.</p>

</div>
</div>
<a class="anchor" id="gabdbe94a8a506bb943ed440adf4c3c0c6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define NVM_PAGE_TERMINATION&#160;&#160;&#160;{ NULL, 0, (NVM_Object_Ids) 0 }</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Structure defining end of pages table. </p>

<p>Definition at line <a class="el" href="nvm_8h_source.html#l00066">66</a> of file <a class="el" href="nvm_8h_source.html">nvm.h</a>.</p>

</div>
</div>
<a class="anchor" id="gaf237b8d940d372ccbd82b8998fbc8f60"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define NVM_READ_ALL_CMD&#160;&#160;&#160;0xff</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>All objects are read to RAM. </p>

<p>Definition at line <a class="el" href="nvm_8h_source.html#l00060">60</a> of file <a class="el" href="nvm_8h_source.html">nvm.h</a>.</p>

<p>Referenced by <a class="el" href="group__NVM.html#ga34880829bee50bf0fde0f6c9695dca86">NVM_Read()</a>.</p>

</div>
</div>
<a class="anchor" id="ga69ca4a7805f154f9e3b65bf2a42c8037"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define NVM_WRITE_ALL_CMD&#160;&#160;&#160;0xff</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>All objects are written from RAM. </p>

<p>Definition at line <a class="el" href="nvm_8h_source.html#l00056">56</a> of file <a class="el" href="nvm_8h_source.html">nvm.h</a>.</p>

<p>Referenced by <a class="el" href="group__NVM.html#gad181be9b434658d3552fb311039ff691">NVM_Write()</a>.</p>

</div>
</div>
<a class="anchor" id="gac2786ac8b0b1ae7ae7dd2ee028cc97c7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define NVM_WRITE_NONE_CMD&#160;&#160;&#160;0xfe</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>All objects are copied from the old page. </p>

<p>Definition at line <a class="el" href="nvm_8h_source.html#l00058">58</a> of file <a class="el" href="nvm_8h_source.html">nvm.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ga6cad1505838978506c7d94f9a1472595"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__emdrv.html#ga7bf5621660c5ba69ac4dd3044173d35c">Ecode_t</a> NVM_Erase </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>eraseCount</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Erase the entire allocated NVM area. </p>
<p>Use this function to erase the entire non-volatile memory area allocated to the NVM system. It is possible to set a fixed erase count for all the pages, or retain the existing one. To retain the erase count might not be advisable if an error has occurred since this data may also have been damaged.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">eraseCount</td><td>Specifies which erase count to set for the blank pages. Pass NVM_ERASE_RETAINCOUNT to retain the erase count.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Returns the result of the erase operation. </dd></dl>

<p>Definition at line <a class="el" href="nvm_8c_source.html#l00382">382</a> of file <a class="el" href="nvm_8c_source.html">nvm.c</a>.</p>

<p>References <a class="el" href="group__NVM.html#gad67929c11d6b7520bf992dc6dcfc4d2c">ECODE_EMDRV_NVM_ERROR</a>, <a class="el" href="group__NVM.html#gae332cf766a19b67f1ed35c9d9e95bd20">ECODE_EMDRV_NVM_OK</a>, <a class="el" href="group__NVM.html#gaddbc995da5f67dc3b176213f32008a62">NVM_ERASE_RETAINCOUNT</a>, <a class="el" href="nvm__hal_8h.html#aaa2acd545c460f4cea576178fc185a21">NVMHAL_PageErase()</a>, <a class="el" href="nvm__hal_8h.html#ae5903c7cb194ab35d7637879ca492479">NVMHAL_Read()</a>, and <a class="el" href="nvm__hal_8h.html#a0800d58f7bb43d0462592d0062c5cef3">NVMHAL_Write()</a>.</p>

</div>
</div>
<a class="anchor" id="gaf74bb05f10ed4959e65e85fa438ead67"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__emdrv.html#ga7bf5621660c5ba69ac4dd3044173d35c">Ecode_t</a> NVM_Init </td>
          <td>(</td>
          <td class="paramtype">NVM_Config_t const *&#160;</td>
          <td class="paramname"><em>config</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize the NVM manager. </p>
<p>Use this function to initialize and validate the NVM. Should be run on startup. The result of this process is then returned in the form of a Ecode_t.</p>
<p>If ECODE_EMDRV_NVM_OK is returned, everything went according to plan and you can use the API right away. If ECODE_EMDRV_NVM_NO_PAGES_AVAILABLE is returned this is a device that validates, but is empty. The proper way to handle this is to first reset the memory using NVM_Erase, and then write any initial data.</p>
<p>If a ECODE_EMDRV_NVM_ERROR, or anything more specific, is returned something irreparable happened, and the system cannot be used reliably. A simple solution to this would be to erase and reinitialize, but this will then cause data loss.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">config</td><td>Pointer to structure defining NVM area.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Returns the result of the initialization. </dd></dl>

<p>Definition at line <a class="el" href="nvm_8c_source.html#l00185">185</a> of file <a class="el" href="nvm_8c_source.html">nvm.c</a>.</p>

<p>References <a class="el" href="group__NVM.html#gad67929c11d6b7520bf992dc6dcfc4d2c">ECODE_EMDRV_NVM_ERROR</a>, <a class="el" href="group__NVM.html#ga2345b10d783d735ed6be169a918ec991">ECODE_EMDRV_NVM_NO_PAGES_AVAILABLE</a>, <a class="el" href="group__NVM.html#gae332cf766a19b67f1ed35c9d9e95bd20">ECODE_EMDRV_NVM_OK</a>, <a class="el" href="nvm__hal_8h.html#a67a31b5bf9f6a36a8e67b3d03bf59b38">NVMHAL_Init()</a>, and <a class="el" href="nvm__hal_8h.html#ae5903c7cb194ab35d7637879ca492479">NVMHAL_Read()</a>.</p>

</div>
</div>
<a class="anchor" id="ga34880829bee50bf0fde0f6c9695dca86"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__emdrv.html#ga7bf5621660c5ba69ac4dd3044173d35c">Ecode_t</a> NVM_Read </td>
          <td>(</td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>pageId</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>objectId</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Read an object or an entire page. </p>
<p>Use this function to read an object or an entire page from memory. It takes a page id and an object id (or the NVM_READ_ALL constant to read everything) and reads data from flash and puts it in the memory locations given in the page specification.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">pageId</td><td>Identifier of the page to read from.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">objectId</td><td>Identifier of the object to read. Can be set to NVM_READ_ALL to read an entire page.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Returns the result of the read operation. </dd></dl>

<p>Definition at line <a class="el" href="nvm_8c_source.html#l00834">834</a> of file <a class="el" href="nvm_8c_source.html">nvm.c</a>.</p>

<p>References <a class="el" href="group__NVM.html#ga513abf6d9830442da42feae5d3aa3793">ECODE_EMDRV_NVM_DATA_INVALID</a>, <a class="el" href="group__NVM.html#gae332cf766a19b67f1ed35c9d9e95bd20">ECODE_EMDRV_NVM_OK</a>, <a class="el" href="group__NVM.html#ga6ea441c3105ea4a18a10a3b042bd7d86">ECODE_EMDRV_NVM_PAGE_INVALID</a>, <a class="el" href="group__NVM.html#gaf237b8d940d372ccbd82b8998fbc8f60">NVM_READ_ALL_CMD</a>, and <a class="el" href="nvm__hal_8h.html#ae5903c7cb194ab35d7637879ca492479">NVMHAL_Read()</a>.</p>

</div>
</div>
<a class="anchor" id="gad181be9b434658d3552fb311039ff691"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__emdrv.html#ga7bf5621660c5ba69ac4dd3044173d35c">Ecode_t</a> NVM_Write </td>
          <td>(</td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>pageId</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>objectId</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Write an object or a page. </p>
<p>Use this function to write an object or an entire page to NVM. It takes a page and an object and updates this object with the data pointed to by the corresponding page entry. All the objects in a page can be written simultaneously by using NVM_WRITE_ALL instead of an object ID. For normal pages it simply finds an unused page in flash with the lowest erase count and copies all objects belonging to this page updating objects defined by objectId argument. For wear pages, this function tries to find spare place in already used page and write object here. If there is no free space, it uses a new page while invalidating previously used one.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">pageId</td><td>Identifier of the page you want to write to NVM.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">objectId</td><td>Identifier of the object you want to write. May be set to NVM_WRITE_ALL to write the entire page to memory.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Returns the result of the write operation. </dd></dl>

<p>Definition at line <a class="el" href="nvm_8c_source.html#l00460">460</a> of file <a class="el" href="nvm_8c_source.html">nvm.c</a>.</p>

<p>References <a class="el" href="group__NVM.html#gad67929c11d6b7520bf992dc6dcfc4d2c">ECODE_EMDRV_NVM_ERROR</a>, <a class="el" href="group__NVM.html#gae332cf766a19b67f1ed35c9d9e95bd20">ECODE_EMDRV_NVM_OK</a>, <a class="el" href="group__NVM.html#ga69ca4a7805f154f9e3b65bf2a42c8037">NVM_WRITE_ALL_CMD</a>, <a class="el" href="nvm__hal_8h.html#ae5903c7cb194ab35d7637879ca492479">NVMHAL_Read()</a>, and <a class="el" href="nvm__hal_8h.html#a0800d58f7bb43d0462592d0062c5cef3">NVMHAL_Write()</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Thu Mar 10 2016 14:27:20 for EFM32 Giant Gecko Software Documentation by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.10 </li>
  </ul>
</div>
</body>
</html>
