<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Silicon Labs Energy Aware Drivers: DMADRV Direct Memory Access</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">


<h1><a class="anchor" id="dmadrv_doc">DMADRV Direct Memory Access </a></h1><ul>
<li><a class="el" href="dmadrv__doc.html#dmadrv_intro">Introduction</a> </li>
<li><a class="el" href="dmadrv__doc.html#dmadrv_conf">Configuration Options</a> </li>
<li><a class="el" href="dmadrv__doc.html#dmadrv_api">The API</a> </li>
<li><a class="el" href="dmadrv__doc.html#dmadrv_example">Example</a></li>
</ul>
<p><br/>
 </p>
<h2><a class="anchor" id="dmadrv_intro">
Introduction</a></h2>
<p>The DMADRV driver makes it possible to write code using DMA which will work regardless of the type of DMA controller on the underlying microcontroller. It will also make it possible to use DMA in several modules, without the modules knowing of each others existence. The driver does not preclude use of the native emlib API of the underlying DMA controller, on the contrary, this will often result in more efficient code and is a necessity when doing complex DMA operations. The housekeeping functions of this driver will be valuable even in this use-case.</p>
<p>The source files for the DMA driver library resides in the emdrv/dmadrv folder, and are named <a class="el" href="dmadrv_8c.html" title="DMADRV API implementation.">dmadrv.c</a> and <a class="el" href="dmadrv_8h.html" title="DMADRV API definition.">dmadrv.h</a>.</p>
<dl class="note"><dt><b>Note:</b></dt><dd>DMA transfer completion callback functions are called from within the DMA interrupt handler.</dd></dl>
<p><br/>
 </p>
<h2><a class="anchor" id="dmadrv_conf">
Configuration Options</a></h2>
<p>Some properties of the DMADRV driver are compile-time configurable. These properties are stored in a file named <a class="el" href="dmadrv__config_8h.html">dmadrv_config.h</a>. A template for this file, containing default values, resides in the emdrv/config folder. Currently the configuration options are: </p>
<ul>
<li>The interrupt priority of the DMA peripheral. </li>
<li>Number of DMA channels to support. </li>
<li>Use the native emlib API belonging to the underlying DMA hardware in combination with the DMADRV API.</li>
</ul>
<p>Both configuration options will help reduce the drivers ram memory footprint.</p>
<p>To configure DMADRV, provide your own configuration file. Here is a sample <a class="el" href="dmadrv__config_8h.html">dmadrv_config.h</a> file: </p>
<div class="fragment"><pre class="fragment">
#ifndef __SILICON_LABS_DMADRV_CONFIG_H__
#define __SILICON_LABS_DMADRV_CONFIG_H__

// DMADRV DMA interrupt priority configuration option.
// Set DMA interrupt priority. Range is 0..7, 0 is highest priority.
#define EMDRV_DMADRV_DMA_IRQ_PRIORITY 4

// DMADRV channel count configuration option.
// Number of DMA channels to support. A lower DMA channel count will reduce
// ram memory footprint.
#define EMDRV_DMADRV_DMA_CH_COUNT 4

// DMADRV native API configuration option.
// Use the native emlib api of the DMA controller, but still use DMADRV
// housekeeping functions as AllocateChannel/FreeChannel etc.
#define EMDRV_DMADRV_USE_NATIVE_API

#endif
  </pre></div><p><br/>
 </p>
<h2><a class="anchor" id="dmadrv_api">
The API</a></h2>
<p>This section contain brief descriptions of the functions in the API. You will find detailed information on input and output parameters and return values by clicking on the hyperlinked function names. Most functions return an error code, <a class="el" href="group__DMADRV.html#gac20848ba30d8793ad1344fc442aae4c4">ECODE_EMDRV_DMADRV_OK</a> is returned on success, see <a class="el" href="ecode_8h.html">ecode.h</a> and <a class="el" href="dmadrv_8h.html">dmadrv.h</a> for other error codes.</p>
<p>Your application code must include one header file: <em><a class="el" href="dmadrv_8h.html" title="DMADRV API definition.">dmadrv.h</a></em>.</p>
<p><a class="el" href="group__DMADRV.html#ga43d0052d81f16e72914f85248a8554b1">DMADRV_Init()</a>, <a class="el" href="group__DMADRV.html#ga73633db63cfd99ba01a68b05c24094ec">DMADRV_DeInit()</a> <br/>
 These functions initializes or deinitializes the DMADRV driver. Typically  DMADRV_Init()  is called once in your startup code.</p>
<p><a class="el" href="group__DMADRV.html#gab503e066820cd13fd612f4365d4d07b2">DMADRV_AllocateChannel()</a>, <a class="el" href="group__DMADRV.html#gab4453539f4d22aa650324685a9f197e3">DMADRV_FreeChannel()</a> <br/>
 DMA channel reserve and release functions. It is recommended that application code check that  DMADRV_AllocateChannel()  returns  ECODE_EMDRV_DMADRV_OK  before starting a DMA transfer.</p>
<p><a class="el" href="group__DMADRV.html#gab1506de1a628ac908b2f8fe93e370578">DMADRV_MemoryPeripheral()</a> <br/>
 Start a DMA transfer from memory to a peripheral.</p>
<p><a class="el" href="group__DMADRV.html#gaef226beb40700660728baf2cb509a2c4">DMADRV_PeripheralMemory()</a> <br/>
 Start a DMA transfer from a peripheral to memory.</p>
<p><a class="el" href="group__DMADRV.html#ga887d429df9893aef3b421e2fdd8f8641">DMADRV_MemoryPeripheralPingPong()</a> <br/>
 Start a DMA ping-pong transfer from memory to a peripheral.</p>
<p><a class="el" href="group__DMADRV.html#gafcabf314184e7d8f82d2164365f36bef">DMADRV_PeripheralMemoryPingPong()</a> <br/>
 Start a DMA ping-pong transfer from a peripheral to memory.</p>
<p><a class="el" href="group__DMADRV.html#ga0349951d92b3e6bf87a983f143d7125c">DMADRV_LdmaStartTransfer()</a> <br/>
 Start a DMA transfer on a LDMA controller. This function can only be used when configuration option <a class="el" href="group__DMADRV.html#ga571ae25c6cd18c189db365f43e58fa17">EMDRV_DMADRV_USE_NATIVE_API</a> is defined. It is a wrapper around similar emlib ldma function, but adds support for completion callback and user defined callback function parameter.</p>
<p><a class="el" href="group__DMADRV.html#ga3a04cb3aa30ec2fd955281f55538028d">DMADRV_StopTransfer()</a> <br/>
 Stop an ongoing DMA transfer.</p>
<p><a class="el" href="group__DMADRV.html#ga1a42965073322a9c2b1f8ebb8a67e846">DMADRV_TransferActive()</a> <br/>
 Check if a transfer is ongoing.</p>
<p><a class="el" href="group__DMADRV.html#gae6b5ec49230e4f15b78c31c57bfa3967">DMADRV_TransferCompletePending()</a> <br/>
 Check if a transfer completion is pending.</p>
<p><a class="el" href="group__DMADRV.html#gaa46714c6a19608cff3058c386f1e4c03">DMADRV_TransferDone()</a> <br/>
 Check if a transfer has completed.</p>
<p><a class="el" href="group__DMADRV.html#ga9a253b47872d205a76b6f1b7b486194d">DMADRV_TransferRemainingCount()</a> <br/>
 Get number of items remaining in a transfer.</p>
<p><br/>
 </p>
<h2><a class="anchor" id="dmadrv_example">
Example</a></h2>
<p>Transfer a text string to USART1. </p>
<div class="fragment"><pre class="fragment">
#include "dmadrv.h"

char str[] = "Hello DMA !";
unsigned int channel;

int main( void )
{
  // Initialize DMA.
  DMADRV_Init();

  // Request a DMA channel.
  DMADRV_AllocateChannel( &amp;channel, NULL );

  // Start the DMA transfer.
  DMADRV_MemoryPeripheral( channel,
                           dmadrvPeripheralSignal_USART1_TXBL,
                           (void*)&amp;(USART1-&gt;TXDATA),
                           str,
                           true,
                           sizeof( str ),
                           dmadrvDataSize1,
                           NULL,
                           NULL );

  return 0;
}
  </pre></div> </div>
<div id="footer">
<hr size="1"><address style="text-align: right;"><small>
Generated on Mon Sep 7 08:55:22 2015</small> for Silicon Labs Energy Aware Drivers by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a><small> 1.6.3 </small></address></div>
</body>
</html>
