<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Silicon Labs Energy Aware Drivers: ezradiodrv/plugins/src/ezradio_transmit_plugin.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_efc6e738bf7bfc7d8514c122a6e813ab.html">ezradiodrv</a>&nbsp;&raquo;&nbsp;<a class="el" href="dir_3abb8275d1ea2b916b3ab19720cf2cf4.html">plugins</a>&nbsp;&raquo;&nbsp;<a class="el" href="dir_01b6943f67c511628aea1387de671b45.html">src</a>
  </div>
</div>
<div class="contents">
<h1>ezradio_transmit_plugin.c</h1><a href="ezradio__transmit__plugin_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/***************************************************************************/</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;stddef.h&gt;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &lt;stdbool.h&gt;</span>
<a name="l00035"></a>00035 
<a name="l00036"></a>00036 <span class="preprocessor">#include &quot;em_device.h&quot;</span>
<a name="l00037"></a>00037 
<a name="l00038"></a>00038 <span class="preprocessor">#include &quot;<a class="code" href="si4463_2inc_2ezradio__cmd_8h.html" title="EZRadio Command Header.">ezradio_cmd.h</a>&quot;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &quot;<a class="code" href="si4463_2inc_2ezradio__prop_8h.html" title="EZRadio Property Header.">ezradio_prop.h</a>&quot;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &quot;<a class="code" href="ezradio__api__lib_8h.html" title="This file contains the common API library of the EZRadio and EZRadioPRO families...">ezradio_api_lib.h</a>&quot;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;<a class="code" href="si4x6x_2ezradio__api__lib__add_8h.html" title="This file contains the additional API library for the listed members of the EZRadioPRO...">ezradio_api_lib_add.h</a>&quot;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;<a class="code" href="ezradio__plugin__manager_8h.html" title="This file contains the plug-in manager for the EZRadio and EZRadioPRO chip families...">ezradio_plugin_manager.h</a>&quot;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;<a class="code" href="ezradio__transmit__plugin_8h.html" title="EzRadio transmit plug-in managed by the plug-in manager if enabled.">ezradio_transmit_plugin.h</a>&quot;</span>
<a name="l00044"></a>00044 
<a name="l00045"></a>00045 <span class="preprocessor">#if ( defined EZRADIO_PLUGIN_TRANSMIT )</span>
<a name="l00046"></a>00046 <span class="preprocessor"></span>
<a name="l00048"></a>00048 
<a name="l00049"></a>00049 <span class="keyword">static</span> <a class="code" href="group__EM__Drivers.html#ga7bf5621660c5ba69ac4dd3044173d35c" title="Typedef for API function errorcode return values.">Ecode_t</a> ezradioStartTx(<a class="code" href="group__Plugin__Manager.html#gab85d488ff2d8f62d46adc449bb8a1737" title="EZRadio driver instance handle.">EZRADIODRV_Handle_t</a> radioHandle, <span class="keywordtype">bool</span> updateFields, <a class="code" href="structEZRADIODRV__PacketLengthConfig__t.html" title="EzRadio transmit packet length configuration structure.">EZRADIODRV_PacketLengthConfig_t</a> pktLengthConf, uint8_t *pioRadioPacket);
<a name="l00050"></a>00050 
<a name="l00051"></a>00051 <span class="preprocessor">#if ( ( defined EZRADIO_PLUGIN_AUTO_ACK ) &amp;&amp; ( defined EZRADIO_PLUGIN_RECEIVE ) )</span>
<a name="l00052"></a>00052 <span class="preprocessor"></span><a class="code" href="group__EM__Drivers.html#ga7bf5621660c5ba69ac4dd3044173d35c" title="Typedef for API function errorcode return values.">Ecode_t</a> ezradioHandleAutoAckPlugin( <a class="code" href="group__Plugin__Manager.html#gab85d488ff2d8f62d46adc449bb8a1737" title="EZRadio driver instance handle.">EZRADIODRV_Handle_t</a> radioHandle, <a class="code" href="group__Plugin__Manager.html#gacdae8227af89ed0c8a6a0837332a5c3d" title="EZradio reply union handle.">EZRADIODRV_ReplyHandle_t</a> radioReplyHandle );
<a name="l00053"></a>00053 <span class="preprocessor">#endif</span>
<a name="l00054"></a>00054 <span class="preprocessor"></span>
<a name="l00056"></a>00056 
<a name="l00057"></a>00057 <span class="comment">/**************************************************************************/</span>
<a name="l00070"></a><a class="code" href="group__Transmit__Plugin.html#gaf702a16bfb588bfed9cbc7c639ba650f">00070</a> <a class="code" href="group__EM__Drivers.html#ga7bf5621660c5ba69ac4dd3044173d35c" title="Typedef for API function errorcode return values.">Ecode_t</a> <a class="code" href="group__Transmit__Plugin.html#gaf702a16bfb588bfed9cbc7c639ba650f" title="Start basic transmission.">ezradioStartTransmitBasic</a>(<a class="code" href="group__Plugin__Manager.html#gab85d488ff2d8f62d46adc449bb8a1737" title="EZRadio driver instance handle.">EZRADIODRV_Handle_t</a> radioHandle, uint16_t packetLength, uint8_t *pioRadioPacket)
<a name="l00071"></a>00071 {
<a name="l00072"></a>00072   <span class="comment">/* Set default field configuration from the generated header file */</span>
<a name="l00073"></a>00073   <a class="code" href="structEZRADIODRV__PacketLengthConfig__t.html" title="EzRadio transmit packet length configuration structure.">EZRADIODRV_PacketLengthConfig_t</a> pktLengthConf =
<a name="l00074"></a>00074       { <a class="code" href="group__Transmit__Plugin.html#ggab4ca09475dbd18bf341c418875b29f21a12116b6ff794083649e9b64ee0306d27" title="Transmit packet length is defined by the application for field1 only.">ezradiodrvTransmitLenghtCustomPacketLen</a>, packetLength, { 0 } };
<a name="l00075"></a>00075 
<a name="l00076"></a>00076   <span class="keywordtype">bool</span> updateFields = <span class="keyword">false</span>;
<a name="l00077"></a>00077 
<a name="l00078"></a>00078   <span class="keywordflow">if</span> ( radioHandle == NULL )
<a name="l00079"></a>00079   {
<a name="l00080"></a>00080     <span class="keywordflow">return</span> <a class="code" href="group__Plugin__Manager.html#gad78c95fe2dec2f1bd1660544625ec77c" title="Illegal SPI handle.">ECODE_EMDRV_EZRADIODRV_ILLEGAL_HANDLE</a>;
<a name="l00081"></a>00081   }
<a name="l00082"></a>00082 
<a name="l00083"></a>00083 
<a name="l00084"></a>00084   <span class="comment">/* Radio field condfig has to be updated if the configuration is different from the previous */</span>
<a name="l00085"></a>00085   <span class="keywordflow">if</span> ( (radioHandle-&gt;packetTx.lenConfig.lenMode     != <a class="code" href="group__Transmit__Plugin.html#ggab4ca09475dbd18bf341c418875b29f21a12116b6ff794083649e9b64ee0306d27" title="Transmit packet length is defined by the application for field1 only.">ezradiodrvTransmitLenghtCustomPacketLen</a>) ||
<a name="l00086"></a>00086        (radioHandle-&gt;packetTx.lenConfig.pktLen      != packetLength ) ||
<a name="l00087"></a>00087        (radioHandle-&gt;packetTx.lenConfig.fieldLen.f1 != (uint8_t)packetLength ) )
<a name="l00088"></a>00088   {
<a name="l00089"></a>00089     updateFields = <span class="keyword">true</span>;
<a name="l00090"></a>00090     pktLengthConf.<a class="code" href="structEZRADIODRV__PacketLengthConfig__t.html#a0e717e7538c62fc7d33eb30b032ab3ac" title="Field lengths.">fieldLen</a>.<a class="code" href="structEZRADIODRV__FieldLength__t.html#aa0c8bb40bec2fcadd8b52762fcd6ec86" title="Field 1 length.">f1</a> = (uint8_t)packetLength;
<a name="l00091"></a>00091     pktLengthConf.<a class="code" href="structEZRADIODRV__PacketLengthConfig__t.html#a0e717e7538c62fc7d33eb30b032ab3ac" title="Field lengths.">fieldLen</a>.<a class="code" href="structEZRADIODRV__FieldLength__t.html#ad47920d66e2d04ed9bd9f565d3fe19b4" title="Field 2 length.">f2</a> = 0u;
<a name="l00092"></a>00092     pktLengthConf.<a class="code" href="structEZRADIODRV__PacketLengthConfig__t.html#a0e717e7538c62fc7d33eb30b032ab3ac" title="Field lengths.">fieldLen</a>.<a class="code" href="structEZRADIODRV__FieldLength__t.html#a810d420086e454276200163420a5798b" title="Field 3 length.">f3</a> = 0u;
<a name="l00093"></a>00093     pktLengthConf.<a class="code" href="structEZRADIODRV__PacketLengthConfig__t.html#a0e717e7538c62fc7d33eb30b032ab3ac" title="Field lengths.">fieldLen</a>.<a class="code" href="structEZRADIODRV__FieldLength__t.html#a46bded79d54a39ab70eeb9ed72842e2d" title="Field 4 length.">f4</a> = 0u;
<a name="l00094"></a>00094     pktLengthConf.<a class="code" href="structEZRADIODRV__PacketLengthConfig__t.html#a0e717e7538c62fc7d33eb30b032ab3ac" title="Field lengths.">fieldLen</a>.<a class="code" href="structEZRADIODRV__FieldLength__t.html#af99e9bcbca23837515787fbc22960d02" title="Field 5 length.">f5</a> = 0u;
<a name="l00095"></a>00095   }
<a name="l00096"></a>00096 
<a name="l00097"></a>00097   ezradioStartTx(radioHandle, updateFields, pktLengthConf, pioRadioPacket);
<a name="l00098"></a>00098 
<a name="l00099"></a>00099   <span class="keywordflow">return</span> <a class="code" href="group__Plugin__Manager.html#ga759250e9a6643d32417a6e8a55a55ffa" title="Success return value.">ECODE_EMDRV_EZRADIODRV_OK</a>;
<a name="l00100"></a>00100 }
<a name="l00101"></a>00101 
<a name="l00102"></a>00102 <span class="comment">/**************************************************************************/</span>
<a name="l00114"></a><a class="code" href="group__Transmit__Plugin.html#ga62e3d76389ad50afc7f77002f8750cb8">00114</a> <a class="code" href="group__EM__Drivers.html#ga7bf5621660c5ba69ac4dd3044173d35c" title="Typedef for API function errorcode return values.">Ecode_t</a> <a class="code" href="group__Transmit__Plugin.html#ga62e3d76389ad50afc7f77002f8750cb8" title="Start transmission using the packet parameters from the generated configuration header...">ezradioStartTransmitConfigured</a>(<a class="code" href="group__Plugin__Manager.html#gab85d488ff2d8f62d46adc449bb8a1737" title="EZRadio driver instance handle.">EZRADIODRV_Handle_t</a> radioHandle, uint8_t *pioRadioPacket)
<a name="l00115"></a>00115 {
<a name="l00116"></a>00116   <span class="comment">/* Set default field configuration from the generated header file */</span>
<a name="l00117"></a>00117   <a class="code" href="structEZRADIODRV__PacketLengthConfig__t.html" title="EzRadio transmit packet length configuration structure.">EZRADIODRV_PacketLengthConfig_t</a> pktLengthConf =
<a name="l00118"></a>00118       { <a class="code" href="group__Transmit__Plugin.html#ggab4ca09475dbd18bf341c418875b29f21abb6020cd9c6248c057890f5655b7bbe2" title="Transmit packet length is defined in the generated configuration.">ezradiodrvTransmitLenghtDefault</a>, RADIO_CONFIG_DATA_MAX_PACKET_LENGTH, RADIO_CONFIG_DATA_FIELD_LENGTH };
<a name="l00119"></a>00119 
<a name="l00120"></a>00120   <span class="keywordtype">bool</span> updateFields = <span class="keyword">false</span>;
<a name="l00121"></a>00121 
<a name="l00122"></a>00122   <span class="keywordflow">if</span> ( radioHandle == NULL )
<a name="l00123"></a>00123   {
<a name="l00124"></a>00124     <span class="keywordflow">return</span> <a class="code" href="group__Plugin__Manager.html#gad78c95fe2dec2f1bd1660544625ec77c" title="Illegal SPI handle.">ECODE_EMDRV_EZRADIODRV_ILLEGAL_HANDLE</a>;
<a name="l00125"></a>00125   }
<a name="l00126"></a>00126 
<a name="l00127"></a>00127   <span class="comment">/* Radio field config has to be updated if the configuration is different from the previous */</span>
<a name="l00128"></a>00128   <span class="keywordflow">if</span> ( (radioHandle-&gt;packetTx.lenConfig.lenMode     != <a class="code" href="group__Transmit__Plugin.html#ggab4ca09475dbd18bf341c418875b29f21abb6020cd9c6248c057890f5655b7bbe2" title="Transmit packet length is defined in the generated configuration.">ezradiodrvTransmitLenghtDefault</a>) ||
<a name="l00129"></a>00129        (radioHandle-&gt;packetTx.lenConfig.pktLen      != pktLengthConf.<a class="code" href="structEZRADIODRV__PacketLengthConfig__t.html#ae41a5dd6ea2c9ba2193adbe76c153f81" title="Packet length.">pktLen</a> ) ||
<a name="l00130"></a>00130        (radioHandle-&gt;packetTx.lenConfig.fieldLen.f1 != pktLengthConf.<a class="code" href="structEZRADIODRV__PacketLengthConfig__t.html#a0e717e7538c62fc7d33eb30b032ab3ac" title="Field lengths.">fieldLen</a>.<a class="code" href="structEZRADIODRV__FieldLength__t.html#aa0c8bb40bec2fcadd8b52762fcd6ec86" title="Field 1 length.">f1</a> ) ||
<a name="l00131"></a>00131        (radioHandle-&gt;packetTx.lenConfig.fieldLen.f2 != pktLengthConf.<a class="code" href="structEZRADIODRV__PacketLengthConfig__t.html#a0e717e7538c62fc7d33eb30b032ab3ac" title="Field lengths.">fieldLen</a>.<a class="code" href="structEZRADIODRV__FieldLength__t.html#ad47920d66e2d04ed9bd9f565d3fe19b4" title="Field 2 length.">f2</a> ) ||
<a name="l00132"></a>00132        (radioHandle-&gt;packetTx.lenConfig.fieldLen.f3 != pktLengthConf.<a class="code" href="structEZRADIODRV__PacketLengthConfig__t.html#a0e717e7538c62fc7d33eb30b032ab3ac" title="Field lengths.">fieldLen</a>.<a class="code" href="structEZRADIODRV__FieldLength__t.html#a810d420086e454276200163420a5798b" title="Field 3 length.">f3</a> ) ||
<a name="l00133"></a>00133        (radioHandle-&gt;packetTx.lenConfig.fieldLen.f4 != pktLengthConf.<a class="code" href="structEZRADIODRV__PacketLengthConfig__t.html#a0e717e7538c62fc7d33eb30b032ab3ac" title="Field lengths.">fieldLen</a>.<a class="code" href="structEZRADIODRV__FieldLength__t.html#a46bded79d54a39ab70eeb9ed72842e2d" title="Field 4 length.">f4</a> ) ||
<a name="l00134"></a>00134        (radioHandle-&gt;packetTx.lenConfig.fieldLen.f5 != pktLengthConf.<a class="code" href="structEZRADIODRV__PacketLengthConfig__t.html#a0e717e7538c62fc7d33eb30b032ab3ac" title="Field lengths.">fieldLen</a>.<a class="code" href="structEZRADIODRV__FieldLength__t.html#af99e9bcbca23837515787fbc22960d02" title="Field 5 length.">f5</a> ) )
<a name="l00135"></a>00135   {
<a name="l00136"></a>00136     updateFields = <span class="keyword">true</span>;
<a name="l00137"></a>00137   }
<a name="l00138"></a>00138 
<a name="l00139"></a>00139   ezradioStartTx(radioHandle, updateFields, pktLengthConf, pioRadioPacket);
<a name="l00140"></a>00140 
<a name="l00141"></a>00141   <span class="keywordflow">return</span> <a class="code" href="group__Plugin__Manager.html#ga759250e9a6643d32417a6e8a55a55ffa" title="Success return value.">ECODE_EMDRV_EZRADIODRV_OK</a>;
<a name="l00142"></a>00142 }
<a name="l00143"></a>00143 
<a name="l00144"></a>00144 <span class="comment">/**************************************************************************/</span>
<a name="l00157"></a><a class="code" href="group__Transmit__Plugin.html#ga348cad1485fa0c671d91af6751488ec1">00157</a> <a class="code" href="group__EM__Drivers.html#ga7bf5621660c5ba69ac4dd3044173d35c" title="Typedef for API function errorcode return values.">Ecode_t</a> <a class="code" href="group__Transmit__Plugin.html#ga348cad1485fa0c671d91af6751488ec1" title="Start transmission using the packet parameters from pktLengthConf.">ezradioStartTransmitCustom</a>(<a class="code" href="group__Plugin__Manager.html#gab85d488ff2d8f62d46adc449bb8a1737" title="EZRadio driver instance handle.">EZRADIODRV_Handle_t</a> radioHandle, <a class="code" href="structEZRADIODRV__PacketLengthConfig__t.html" title="EzRadio transmit packet length configuration structure.">EZRADIODRV_PacketLengthConfig_t</a> pktLengthConf, uint8_t *pioRadioPacket)
<a name="l00158"></a>00158 {
<a name="l00159"></a>00159   <span class="keywordtype">bool</span> updateFields = <span class="keyword">false</span>;
<a name="l00160"></a>00160 
<a name="l00161"></a>00161   <span class="keywordflow">if</span> ( radioHandle == NULL )
<a name="l00162"></a>00162   {
<a name="l00163"></a>00163     <span class="keywordflow">return</span> <a class="code" href="group__Plugin__Manager.html#gad78c95fe2dec2f1bd1660544625ec77c" title="Illegal SPI handle.">ECODE_EMDRV_EZRADIODRV_ILLEGAL_HANDLE</a>;
<a name="l00164"></a>00164   }
<a name="l00165"></a>00165 
<a name="l00166"></a>00166   <span class="comment">/* Radio field config has to be updated if the configuration is different from the previous */</span>
<a name="l00167"></a>00167   <span class="keywordflow">if</span> ( (radioHandle-&gt;packetTx.lenConfig.lenMode     != <a class="code" href="group__Transmit__Plugin.html#ggab4ca09475dbd18bf341c418875b29f21a12116b6ff794083649e9b64ee0306d27" title="Transmit packet length is defined by the application for field1 only.">ezradiodrvTransmitLenghtCustomPacketLen</a>) ||
<a name="l00168"></a>00168        (radioHandle-&gt;packetTx.lenConfig.pktLen      != pktLengthConf.<a class="code" href="structEZRADIODRV__PacketLengthConfig__t.html#ae41a5dd6ea2c9ba2193adbe76c153f81" title="Packet length.">pktLen</a> ) ||
<a name="l00169"></a>00169        (radioHandle-&gt;packetTx.lenConfig.fieldLen.f1 != pktLengthConf.<a class="code" href="structEZRADIODRV__PacketLengthConfig__t.html#a0e717e7538c62fc7d33eb30b032ab3ac" title="Field lengths.">fieldLen</a>.<a class="code" href="structEZRADIODRV__FieldLength__t.html#aa0c8bb40bec2fcadd8b52762fcd6ec86" title="Field 1 length.">f1</a> ) ||
<a name="l00170"></a>00170        (radioHandle-&gt;packetTx.lenConfig.fieldLen.f2 != pktLengthConf.<a class="code" href="structEZRADIODRV__PacketLengthConfig__t.html#a0e717e7538c62fc7d33eb30b032ab3ac" title="Field lengths.">fieldLen</a>.<a class="code" href="structEZRADIODRV__FieldLength__t.html#ad47920d66e2d04ed9bd9f565d3fe19b4" title="Field 2 length.">f2</a> ) ||
<a name="l00171"></a>00171        (radioHandle-&gt;packetTx.lenConfig.fieldLen.f3 != pktLengthConf.<a class="code" href="structEZRADIODRV__PacketLengthConfig__t.html#a0e717e7538c62fc7d33eb30b032ab3ac" title="Field lengths.">fieldLen</a>.<a class="code" href="structEZRADIODRV__FieldLength__t.html#a810d420086e454276200163420a5798b" title="Field 3 length.">f3</a> ) ||
<a name="l00172"></a>00172        (radioHandle-&gt;packetTx.lenConfig.fieldLen.f4 != pktLengthConf.<a class="code" href="structEZRADIODRV__PacketLengthConfig__t.html#a0e717e7538c62fc7d33eb30b032ab3ac" title="Field lengths.">fieldLen</a>.<a class="code" href="structEZRADIODRV__FieldLength__t.html#a46bded79d54a39ab70eeb9ed72842e2d" title="Field 4 length.">f4</a> ) ||
<a name="l00173"></a>00173        (radioHandle-&gt;packetTx.lenConfig.fieldLen.f5 != pktLengthConf.<a class="code" href="structEZRADIODRV__PacketLengthConfig__t.html#a0e717e7538c62fc7d33eb30b032ab3ac" title="Field lengths.">fieldLen</a>.<a class="code" href="structEZRADIODRV__FieldLength__t.html#af99e9bcbca23837515787fbc22960d02" title="Field 5 length.">f5</a> ) )
<a name="l00174"></a>00174   {
<a name="l00175"></a>00175     updateFields = <span class="keyword">true</span>;
<a name="l00176"></a>00176   }
<a name="l00177"></a>00177 
<a name="l00178"></a>00178   ezradioStartTx(radioHandle, updateFields, pktLengthConf, pioRadioPacket);
<a name="l00179"></a>00179 
<a name="l00180"></a>00180   <span class="keywordflow">return</span> <a class="code" href="group__Plugin__Manager.html#ga759250e9a6643d32417a6e8a55a55ffa" title="Success return value.">ECODE_EMDRV_EZRADIODRV_OK</a>;
<a name="l00181"></a>00181 }
<a name="l00182"></a>00182 
<a name="l00183"></a>00183 <span class="comment">/**************************************************************************/</span>
<a name="l00198"></a><a class="code" href="group__Transmit__Plugin.html#gaf0c60b70ac28ad2c13779b041b923153">00198</a> <a class="code" href="group__EM__Drivers.html#ga7bf5621660c5ba69ac4dd3044173d35c" title="Typedef for API function errorcode return values.">Ecode_t</a> <a class="code" href="group__Transmit__Plugin.html#gaf0c60b70ac28ad2c13779b041b923153" title="Start a smart transmission.">ezradioStartTransmitSmart</a>(<a class="code" href="group__Plugin__Manager.html#gab85d488ff2d8f62d46adc449bb8a1737" title="EZRadio driver instance handle.">EZRADIODRV_Handle_t</a> radioHandle, <a class="code" href="structEZRADIODRV__PacketLengthConfig__t.html" title="EzRadio transmit packet length configuration structure.">EZRADIODRV_PacketLengthConfig_t</a> pktLengthConf, uint8_t *pioRadioPacket)
<a name="l00199"></a>00199 {
<a name="l00200"></a>00200   <span class="keywordflow">if</span> ( radioHandle == NULL )
<a name="l00201"></a>00201   {
<a name="l00202"></a>00202     <span class="keywordflow">return</span> <a class="code" href="group__Plugin__Manager.html#gad78c95fe2dec2f1bd1660544625ec77c" title="Illegal SPI handle.">ECODE_EMDRV_EZRADIODRV_ILLEGAL_HANDLE</a>;
<a name="l00203"></a>00203   }
<a name="l00204"></a>00204 
<a name="l00205"></a>00205   <span class="keywordflow">if</span> (pktLengthConf.<a class="code" href="structEZRADIODRV__PacketLengthConfig__t.html#a41cd8f9896063aece535e6585edcedff" title="Length mode.">lenMode</a> == <a class="code" href="group__Transmit__Plugin.html#ggab4ca09475dbd18bf341c418875b29f21a12116b6ff794083649e9b64ee0306d27" title="Transmit packet length is defined by the application for field1 only.">ezradiodrvTransmitLenghtCustomPacketLen</a>)
<a name="l00206"></a>00206   {
<a name="l00207"></a>00207     <a class="code" href="group__Transmit__Plugin.html#gaf702a16bfb588bfed9cbc7c639ba650f" title="Start basic transmission.">ezradioStartTransmitBasic</a>(radioHandle, pktLengthConf.<a class="code" href="structEZRADIODRV__PacketLengthConfig__t.html#ae41a5dd6ea2c9ba2193adbe76c153f81" title="Packet length.">pktLen</a>, pioRadioPacket);
<a name="l00208"></a>00208   }
<a name="l00209"></a>00209   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pktLengthConf.<a class="code" href="structEZRADIODRV__PacketLengthConfig__t.html#a41cd8f9896063aece535e6585edcedff" title="Length mode.">lenMode</a> == <a class="code" href="group__Transmit__Plugin.html#ggab4ca09475dbd18bf341c418875b29f21abb6020cd9c6248c057890f5655b7bbe2" title="Transmit packet length is defined in the generated configuration.">ezradiodrvTransmitLenghtDefault</a>)
<a name="l00210"></a>00210   {
<a name="l00211"></a>00211     <a class="code" href="group__Transmit__Plugin.html#ga62e3d76389ad50afc7f77002f8750cb8" title="Start transmission using the packet parameters from the generated configuration header...">ezradioStartTransmitConfigured</a>(radioHandle, pioRadioPacket);
<a name="l00212"></a>00212   }
<a name="l00213"></a>00213   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pktLengthConf.<a class="code" href="structEZRADIODRV__PacketLengthConfig__t.html#a41cd8f9896063aece535e6585edcedff" title="Length mode.">lenMode</a> == <a class="code" href="group__Transmit__Plugin.html#ggab4ca09475dbd18bf341c418875b29f21a1708e41110aba2e5d3c07ebd2843d65c" title="Transmit packet length is defined by the application for multiple fields.">ezradiodrvTransmitLenghtCustomFieldLen</a>)
<a name="l00214"></a>00214   {
<a name="l00215"></a>00215     <a class="code" href="group__Transmit__Plugin.html#ga348cad1485fa0c671d91af6751488ec1" title="Start transmission using the packet parameters from pktLengthConf.">ezradioStartTransmitCustom</a>(radioHandle, pktLengthConf, pioRadioPacket);
<a name="l00216"></a>00216   }
<a name="l00217"></a>00217 
<a name="l00218"></a>00218   <span class="keywordflow">return</span> <a class="code" href="group__Plugin__Manager.html#ga759250e9a6643d32417a6e8a55a55ffa" title="Success return value.">ECODE_EMDRV_EZRADIODRV_OK</a>;
<a name="l00219"></a>00219 }
<a name="l00220"></a>00220 
<a name="l00221"></a>00221 <span class="comment">/**************************************************************************/</span>
<a name="l00234"></a><a class="code" href="group__Transmit__Plugin.html#gade85938593abc8d7c6246eeaa9536a61">00234</a> <a class="code" href="group__EM__Drivers.html#ga7bf5621660c5ba69ac4dd3044173d35c" title="Typedef for API function errorcode return values.">Ecode_t</a> <a class="code" href="group__Transmit__Plugin.html#gade85938593abc8d7c6246eeaa9536a61" title="Start a default transmission using the packet information previously set to radioHandle...">ezradioStartTransmitDefault</a>(<a class="code" href="group__Plugin__Manager.html#gab85d488ff2d8f62d46adc449bb8a1737" title="EZRadio driver instance handle.">EZRADIODRV_Handle_t</a> radioHandle, uint8_t *pioRadioPacket)
<a name="l00235"></a>00235 {
<a name="l00236"></a>00236   <span class="keywordflow">if</span> ( radioHandle == NULL )
<a name="l00237"></a>00237   {
<a name="l00238"></a>00238     <span class="keywordflow">return</span> <a class="code" href="group__Plugin__Manager.html#gad78c95fe2dec2f1bd1660544625ec77c" title="Illegal SPI handle.">ECODE_EMDRV_EZRADIODRV_ILLEGAL_HANDLE</a>;
<a name="l00239"></a>00239   }
<a name="l00240"></a>00240 
<a name="l00241"></a>00241   <a class="code" href="group__Transmit__Plugin.html#gaf0c60b70ac28ad2c13779b041b923153" title="Start a smart transmission.">ezradioStartTransmitSmart</a>(radioHandle, radioHandle-&gt;packetTx.lenConfig, pioRadioPacket);
<a name="l00242"></a>00242 
<a name="l00243"></a>00243   <span class="keywordflow">return</span> <a class="code" href="group__Plugin__Manager.html#ga759250e9a6643d32417a6e8a55a55ffa" title="Success return value.">ECODE_EMDRV_EZRADIODRV_OK</a>;
<a name="l00244"></a>00244 }
<a name="l00245"></a>00245 
<a name="l00247"></a>00247 <span class="comment">//  Note: These are internal routines used by ezradio plugin manager.</span>
<a name="l00248"></a>00248 
<a name="l00249"></a>00249 <span class="comment">/**************************************************************************/</span>
<a name="l00259"></a>00259 <a class="code" href="group__EM__Drivers.html#ga7bf5621660c5ba69ac4dd3044173d35c" title="Typedef for API function errorcode return values.">Ecode_t</a> ezradioHandleTransmitPlugin( <a class="code" href="group__Plugin__Manager.html#gab85d488ff2d8f62d46adc449bb8a1737" title="EZRadio driver instance handle.">EZRADIODRV_Handle_t</a> radioHandle, <a class="code" href="group__Plugin__Manager.html#gacdae8227af89ed0c8a6a0837332a5c3d" title="EZradio reply union handle.">EZRADIODRV_ReplyHandle_t</a> radioReplyHandle )
<a name="l00260"></a>00260 {
<a name="l00261"></a>00261   <span class="keywordflow">if</span> ( radioHandle == NULL )
<a name="l00262"></a>00262   {
<a name="l00263"></a>00263     <span class="keywordflow">return</span> <a class="code" href="group__Plugin__Manager.html#gad78c95fe2dec2f1bd1660544625ec77c" title="Illegal SPI handle.">ECODE_EMDRV_EZRADIODRV_ILLEGAL_HANDLE</a>;
<a name="l00264"></a>00264   }
<a name="l00265"></a>00265 
<a name="l00266"></a>00266   <span class="keywordflow">if</span> ( radioReplyHandle-&gt;GET_INT_STATUS.PH_PEND &amp; EZRADIO_CMD_GET_INT_STATUS_REP_PH_PEND_PACKET_SENT_PEND_BIT )
<a name="l00267"></a>00267   {
<a name="l00268"></a>00268 <span class="preprocessor">#if ( ( defined EZRADIO_PLUGIN_AUTO_ACK ) &amp;&amp; ( defined EZRADIO_PLUGIN_RECEIVE ) )</span>
<a name="l00269"></a>00269 <span class="preprocessor"></span>    <span class="comment">/* Handle auto acknowledge packet if enabled */</span>
<a name="l00270"></a>00270     <span class="keywordflow">if</span> ( (radioHandle-&gt;packetTx.pktType == <a class="code" href="group__Transmit__Plugin.html#gga0209ea2f2c45ad3ecef95661c0df7cdca2c1e1bc6e7566658c5ef3f19ceb094bb" title="Auto acknowledge packet type.">ezradiodrvPacketTypeAutoAck</a>) &amp;&amp;
<a name="l00271"></a>00271          (radioHandle-&gt;autoAck.ackMode  == <a class="code" href="group__Auto__ACK__Plugin.html#gga875a6c5622c39d95eaf99110dbc808b3ac67ce95452162f3862b2aa21ff692d6a" title="Immediate acknowledge transmission.">ezradiodrvAutoAckImmediate</a>) )
<a name="l00272"></a>00272     {
<a name="l00273"></a>00273       ezradioHandleAutoAckPlugin(radioHandle, radioReplyHandle);
<a name="l00274"></a>00274     }
<a name="l00275"></a>00275     <span class="keywordflow">else</span>
<a name="l00276"></a>00276 <span class="preprocessor">#endif //#if ( ( defined EZRADIO_PLUGIN_AUTO_ACK ) &amp;&amp; ( defined EZRADIO_PLUGIN_RECEIVE ) )</span>
<a name="l00277"></a>00277 <span class="preprocessor"></span>    <span class="keywordflow">if</span> ( radioHandle-&gt;packetTx.userCallback != NULL )
<a name="l00278"></a>00278     {
<a name="l00279"></a>00279       radioHandle-&gt;packetTx.userCallback( radioHandle, <a class="code" href="group__Plugin__Manager.html#ga759250e9a6643d32417a6e8a55a55ffa" title="Success return value.">ECODE_EMDRV_EZRADIODRV_OK</a> );
<a name="l00280"></a>00280     }
<a name="l00281"></a>00281 
<a name="l00282"></a>00282   }
<a name="l00283"></a>00283 
<a name="l00284"></a>00284   <span class="keywordflow">return</span> <a class="code" href="group__Plugin__Manager.html#ga759250e9a6643d32417a6e8a55a55ffa" title="Success return value.">ECODE_EMDRV_EZRADIODRV_OK</a>;
<a name="l00285"></a>00285 }
<a name="l00286"></a>00286 
<a name="l00287"></a>00287 <span class="comment">/**************************************************************************/</span>
<a name="l00303"></a>00303 <span class="keyword">static</span> <a class="code" href="group__EM__Drivers.html#ga7bf5621660c5ba69ac4dd3044173d35c" title="Typedef for API function errorcode return values.">Ecode_t</a> ezradioStartTx(<a class="code" href="group__Plugin__Manager.html#gab85d488ff2d8f62d46adc449bb8a1737" title="EZRadio driver instance handle.">EZRADIODRV_Handle_t</a> radioHandle, <span class="keywordtype">bool</span> updateFields, <a class="code" href="structEZRADIODRV__PacketLengthConfig__t.html" title="EzRadio transmit packet length configuration structure.">EZRADIODRV_PacketLengthConfig_t</a> pktLengthConf, uint8_t *pioRadioPacket)
<a name="l00304"></a>00304 {
<a name="l00305"></a>00305   ezradio_cmd_reply_t ezradioReply;
<a name="l00306"></a>00306 
<a name="l00307"></a>00307   <span class="keywordflow">if</span> ( radioHandle == NULL )
<a name="l00308"></a>00308   {
<a name="l00309"></a>00309     <span class="keywordflow">return</span> <a class="code" href="group__Plugin__Manager.html#gad78c95fe2dec2f1bd1660544625ec77c" title="Illegal SPI handle.">ECODE_EMDRV_EZRADIODRV_ILLEGAL_HANDLE</a>;
<a name="l00310"></a>00310   }
<a name="l00311"></a>00311 
<a name="l00312"></a>00312   <span class="comment">/* Request and check radio device state */</span>
<a name="l00313"></a>00313   <a class="code" href="group__API__Layer.html#ga9f990f8ebde64b6ef0c051f397430c53" title="Requests the current state of the device and lists pending TX and RX requests.">ezradio_request_device_state</a>(&amp;ezradioReply);
<a name="l00314"></a>00314 
<a name="l00315"></a>00315   <span class="keywordflow">if</span> (ezradioReply.REQUEST_DEVICE_STATE.CURR_STATE == EZRADIO_CMD_REQUEST_DEVICE_STATE_REP_CURR_STATE_MAIN_STATE_ENUM_TX) {
<a name="l00316"></a>00316     <span class="keywordflow">return</span> <a class="code" href="group__Transmit__Plugin.html#ga0285b16b19fce9947c56e6a585728858" title="Unable to start transmission.">ECODE_EMDRV_EZRADIODRV_TRANSMIT_FAILED</a>;
<a name="l00317"></a>00317   }
<a name="l00318"></a>00318 
<a name="l00319"></a>00319   <span class="comment">/* Update radio packet filed configurations if requested */</span>
<a name="l00320"></a>00320   <span class="keywordflow">if</span> (updateFields)
<a name="l00321"></a>00321   {
<a name="l00322"></a>00322     radioHandle-&gt;packetTx.lenConfig.lenMode = pktLengthConf.<a class="code" href="structEZRADIODRV__PacketLengthConfig__t.html#a41cd8f9896063aece535e6585edcedff" title="Length mode.">lenMode</a>;
<a name="l00323"></a>00323     radioHandle-&gt;packetTx.lenConfig.pktLen  = 0;
<a name="l00324"></a>00324     radioHandle-&gt;packetTx.lenConfig.pktLen  += radioHandle-&gt;packetTx.lenConfig.fieldLen.f1 = pktLengthConf.<a class="code" href="structEZRADIODRV__PacketLengthConfig__t.html#a0e717e7538c62fc7d33eb30b032ab3ac" title="Field lengths.">fieldLen</a>.<a class="code" href="structEZRADIODRV__FieldLength__t.html#aa0c8bb40bec2fcadd8b52762fcd6ec86" title="Field 1 length.">f1</a>;
<a name="l00325"></a>00325     radioHandle-&gt;packetTx.lenConfig.pktLen  += radioHandle-&gt;packetTx.lenConfig.fieldLen.f2 = pktLengthConf.<a class="code" href="structEZRADIODRV__PacketLengthConfig__t.html#a0e717e7538c62fc7d33eb30b032ab3ac" title="Field lengths.">fieldLen</a>.<a class="code" href="structEZRADIODRV__FieldLength__t.html#ad47920d66e2d04ed9bd9f565d3fe19b4" title="Field 2 length.">f2</a>;
<a name="l00326"></a>00326     radioHandle-&gt;packetTx.lenConfig.pktLen  += radioHandle-&gt;packetTx.lenConfig.fieldLen.f3 = pktLengthConf.<a class="code" href="structEZRADIODRV__PacketLengthConfig__t.html#a0e717e7538c62fc7d33eb30b032ab3ac" title="Field lengths.">fieldLen</a>.<a class="code" href="structEZRADIODRV__FieldLength__t.html#a810d420086e454276200163420a5798b" title="Field 3 length.">f3</a>;
<a name="l00327"></a>00327     radioHandle-&gt;packetTx.lenConfig.pktLen  += radioHandle-&gt;packetTx.lenConfig.fieldLen.f4 = pktLengthConf.<a class="code" href="structEZRADIODRV__PacketLengthConfig__t.html#a0e717e7538c62fc7d33eb30b032ab3ac" title="Field lengths.">fieldLen</a>.<a class="code" href="structEZRADIODRV__FieldLength__t.html#a46bded79d54a39ab70eeb9ed72842e2d" title="Field 4 length.">f4</a>;
<a name="l00328"></a>00328     radioHandle-&gt;packetTx.lenConfig.pktLen  += radioHandle-&gt;packetTx.lenConfig.fieldLen.f5 = pktLengthConf.<a class="code" href="structEZRADIODRV__PacketLengthConfig__t.html#a0e717e7538c62fc7d33eb30b032ab3ac" title="Field lengths.">fieldLen</a>.<a class="code" href="structEZRADIODRV__FieldLength__t.html#af99e9bcbca23837515787fbc22960d02" title="Field 5 length.">f5</a>;
<a name="l00329"></a>00329 
<a name="l00330"></a>00330 <span class="preprocessor">#if (RADIO_CONFIGURATION_DATA_RADIO_CHIP_FAMILY == RADIO_CHIP_FAMILY_EZRADIOPRO)</span>
<a name="l00331"></a>00331 <span class="preprocessor"></span>
<a name="l00332"></a>00332     <a class="code" href="group__API__Layer.html#ga5f37f9c7237c880623753bbd9c772876" title="Send SET_PROPERTY command to the radio.">ezradio_set_property</a>(
<a name="l00333"></a>00333         EZRADIO_PROP_GRP_ID_PKT, 2u,
<a name="l00334"></a>00334         EZRADIO_PROP_GRP_INDEX_PKT_FIELD_1_LENGTH,
<a name="l00335"></a>00335         0, pktLengthConf.<a class="code" href="structEZRADIODRV__PacketLengthConfig__t.html#a0e717e7538c62fc7d33eb30b032ab3ac" title="Field lengths.">fieldLen</a>.<a class="code" href="structEZRADIODRV__FieldLength__t.html#aa0c8bb40bec2fcadd8b52762fcd6ec86" title="Field 1 length.">f1</a>
<a name="l00336"></a>00336         );
<a name="l00337"></a>00337 
<a name="l00338"></a>00338     <a class="code" href="group__API__Layer.html#ga5f37f9c7237c880623753bbd9c772876" title="Send SET_PROPERTY command to the radio.">ezradio_set_property</a>(
<a name="l00339"></a>00339         EZRADIO_PROP_GRP_ID_PKT, 2u,
<a name="l00340"></a>00340         EZRADIO_PROP_GRP_INDEX_PKT_FIELD_2_LENGTH,
<a name="l00341"></a>00341         0, pktLengthConf.<a class="code" href="structEZRADIODRV__PacketLengthConfig__t.html#a0e717e7538c62fc7d33eb30b032ab3ac" title="Field lengths.">fieldLen</a>.<a class="code" href="structEZRADIODRV__FieldLength__t.html#ad47920d66e2d04ed9bd9f565d3fe19b4" title="Field 2 length.">f2</a>
<a name="l00342"></a>00342         );
<a name="l00343"></a>00343 
<a name="l00344"></a>00344     <a class="code" href="group__API__Layer.html#ga5f37f9c7237c880623753bbd9c772876" title="Send SET_PROPERTY command to the radio.">ezradio_set_property</a>(
<a name="l00345"></a>00345         EZRADIO_PROP_GRP_ID_PKT, 2u,
<a name="l00346"></a>00346         EZRADIO_PROP_GRP_INDEX_PKT_FIELD_3_LENGTH,
<a name="l00347"></a>00347         0, pktLengthConf.<a class="code" href="structEZRADIODRV__PacketLengthConfig__t.html#a0e717e7538c62fc7d33eb30b032ab3ac" title="Field lengths.">fieldLen</a>.<a class="code" href="structEZRADIODRV__FieldLength__t.html#a810d420086e454276200163420a5798b" title="Field 3 length.">f3</a>
<a name="l00348"></a>00348         );
<a name="l00349"></a>00349 
<a name="l00350"></a>00350     <a class="code" href="group__API__Layer.html#ga5f37f9c7237c880623753bbd9c772876" title="Send SET_PROPERTY command to the radio.">ezradio_set_property</a>(
<a name="l00351"></a>00351         EZRADIO_PROP_GRP_ID_PKT, 2u,
<a name="l00352"></a>00352         EZRADIO_PROP_GRP_INDEX_PKT_FIELD_4_LENGTH,
<a name="l00353"></a>00353         0, pktLengthConf.<a class="code" href="structEZRADIODRV__PacketLengthConfig__t.html#a0e717e7538c62fc7d33eb30b032ab3ac" title="Field lengths.">fieldLen</a>.<a class="code" href="structEZRADIODRV__FieldLength__t.html#a46bded79d54a39ab70eeb9ed72842e2d" title="Field 4 length.">f4</a>
<a name="l00354"></a>00354         );
<a name="l00355"></a>00355 
<a name="l00356"></a>00356     <a class="code" href="group__API__Layer.html#ga5f37f9c7237c880623753bbd9c772876" title="Send SET_PROPERTY command to the radio.">ezradio_set_property</a>(
<a name="l00357"></a>00357         EZRADIO_PROP_GRP_ID_PKT, 2u,
<a name="l00358"></a>00358         EZRADIO_PROP_GRP_INDEX_PKT_FIELD_5_LENGTH,
<a name="l00359"></a>00359         0, pktLengthConf.<a class="code" href="structEZRADIODRV__PacketLengthConfig__t.html#a0e717e7538c62fc7d33eb30b032ab3ac" title="Field lengths.">fieldLen</a>.<a class="code" href="structEZRADIODRV__FieldLength__t.html#af99e9bcbca23837515787fbc22960d02" title="Field 5 length.">f5</a>
<a name="l00360"></a>00360         );
<a name="l00361"></a>00361 <span class="preprocessor">#endif //#if !(RADIO_CONFIG_DATA_RADIO_TYPE == 4455)</span>
<a name="l00362"></a>00362 <span class="preprocessor"></span>  }
<a name="l00363"></a>00363 
<a name="l00364"></a>00364   <span class="comment">/* Fill the TX fifo with datas */</span>
<a name="l00365"></a>00365   <a class="code" href="group__API__Layer.html#ga352edd05911a66d9fe2b2e7c11d2df22" title="The function can be used to load data into TX FIFO.">ezradio_write_tx_fifo</a>(radioHandle-&gt;packetTx.lenConfig.pktLen, pioRadioPacket);
<a name="l00366"></a>00366 
<a name="l00367"></a>00367   <span class="comment">/* Start sending packet, channel 0, START immediately, Packet n bytes long, go READY when done */</span>
<a name="l00368"></a>00368   <a class="code" href="group__API__Layer.html#ga95ec30d47eea9860cccae2c5bb3fc878" title="Sends START_TX command to the radio.">ezradio_start_tx</a>(radioHandle-&gt;packetTx.channel, 0x30,  0u);
<a name="l00369"></a>00369 
<a name="l00370"></a>00370   <span class="keywordflow">return</span> <a class="code" href="group__Plugin__Manager.html#ga759250e9a6643d32417a6e8a55a55ffa" title="Success return value.">ECODE_EMDRV_EZRADIODRV_OK</a>;
<a name="l00371"></a>00371 }
<a name="l00372"></a>00372 
<a name="l00374"></a>00374 
<a name="l00375"></a>00375 <span class="preprocessor">#endif //#if ( defined EZRADIO_PLUGIN_TRANSMIT )</span>
</pre></div></div>
<div id="footer">
<hr size="1"><address style="text-align: right;"><small>
Generated on Mon Sep 7 08:55:11 2015</small> for Silicon Labs Energy Aware Drivers by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a><small> 1.6.3 </small></address></div>
</body>
</html>
